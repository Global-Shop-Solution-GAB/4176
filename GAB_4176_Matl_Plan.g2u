Program.Sub.ScreenSU.Start
Gui.frmPO..Create
Gui.frmPO..Caption("Purchasing Dashboard")
Gui.frmPO..Size(16245,12825)
Gui.frmPO..MinX(16350)
Gui.frmPO..MinY(12825)
Gui.frmPO..Position(0,0)
Gui.frmPO..BackColor(-2147483633)
Gui.frmPO..MousePointer(0)
Gui.frmPO..Event(UnLoad,frmPO_UnLoad)
Gui.frmPO..Event(Resize,frmPO_Resize)
Gui.frmPO.picGSSLogo.Create(PictureBox)
Gui.frmPO.picGSSLogo.Size(4125,960)
Gui.frmPO.picGSSLogo.Position(6090,45)
Gui.frmPO.picGSSLogo.Anchor(1)
Gui.frmPO.picGSSLogo.Event(Click,picGSSLogo_Click)
Gui.frmPO.lblStatus.Create(Label,"Loading PO Data....",False,2895,255,0,75,135,True,0,"Arial",8,-2147483633,0)
Gui.frmPO.progBarStatus.Create(ProgressBar)
Gui.frmPO.progBarStatus.Visible(False)
Gui.frmPO.progBarStatus.Size(2895,255)
Gui.frmPO.progBarStatus.Position(75,345)
Gui.frmPO.GsGCDemand.Create(GsGridControl)
Gui.frmPO.GsGCDemand.Size(5190,3765)
Gui.frmPO.GsGCDemand.Position(30,8715)
Gui.frmPO.GsGCDemand.Event(RowCellClick,Hyperlinks)
Gui.frmPO.lblSupply.Create(Label,"Supply",True,1935,255,0,10635,8475,True,0,"Arial",8,-2147483633,0)
Gui.frmPO.lblSupply.FontStyle(True,False,False,False,False)
Gui.frmPO.GsGCSupply.Create(GsGridControl)
Gui.frmPO.GsGCSupply.Size(5325,3765)
Gui.frmPO.GsGCSupply.Position(10590,8715)
Gui.frmPO.GsGCSupply.Event(RowCellClick,Hyperlinks)
Gui.frmPO.lblDemand.Create(Label,"Demand",True,1935,255,0,30,8475,True,0,"Arial",8,-2147483633,0)
Gui.frmPO.lblDemand.FontStyle(True,False,False,False,False)
Gui.frmPO.GsGCVendQte.Create(GsGridControl)
Gui.frmPO.GsGCVendQte.Size(5220,3765)
Gui.frmPO.GsGCVendQte.Position(5280,8715)
Gui.frmPO.GsGCVendQte.Event(RowCellClick,GsGCVendQte_RowCellClick)
Gui.frmPO.lblVendQte.Create(Label,"Vendor Quote",True,1290,255,0,5445,8475,True,0,"Arial",8,-2147483633,0)
Gui.frmPO.lblVendQte.FontStyle(True,False,False,False,False)
Gui.frmPO.cmdNewVendQte.Create(Button)
Gui.frmPO.cmdNewVendQte.Size(600,300)
Gui.frmPO.cmdNewVendQte.Position(7395,8385)
Gui.frmPO.cmdNewVendQte.Caption("New")
Gui.frmPO.cmdNewVendQte.Event(Click,cmdNewVendQte_Click)
Gui.frmPO.cmdViewVendQte.Create(Button)
Gui.frmPO.cmdViewVendQte.Size(615,300)
Gui.frmPO.cmdViewVendQte.Position(6750,8385)
Gui.frmPO.cmdViewVendQte.Caption("View")
Gui.frmPO.cmdViewVendQte.Event(Click,cmdViewVendQte_Click)
Gui.frmPO.dtpCutoff.Create(DatePicker)
Gui.frmPO.dtpCutoff.Size(1425,285)
Gui.frmPO.dtpCutoff.Position(1305,720)
Gui.frmPO.dtpCutoff.Enabled(False)
Gui.frmPO.cmdRefresh.Create(Button)
Gui.frmPO.cmdRefresh.Size(390,330)
Gui.frmPO.cmdRefresh.Position(2760,705)
Gui.frmPO.cmdRefresh.Caption("REFRESH")
Gui.frmPO.cmdRefresh.Event(Click,cmdRefresh_Click)
Gui.frmPO.chkCutoff.Create(CheckBox)
Gui.frmPO.chkCutoff.Size(1260,255)
Gui.frmPO.chkCutoff.Position(30,780)
Gui.frmPO.chkCutoff.Caption("Cutoff Date:")
Gui.frmPO.chkCutoff.Event(Click,chkCutoff_Click)
Gui.frmPO.tabPO.Create(Tab)
Gui.frmPO.tabPO.Size(15990,6810)
Gui.frmPO.tabPO.Position(30,1560)
Gui.frmPO.tabPO.Anchor(15)
Gui.frmPO.tabPO.Event(Click,tabPO_Click)
Gui.frmPO.tabPO.Tabs(3)
Gui.frmPO.tabPO.SetTab(0)
Gui.frmPO.tabPO.Caption("Purchase Orders")
Gui.frmPO.tabPO.SetTab(1)
Gui.frmPO.tabPO.Caption("By Sales Order")
Gui.frmPO.tabPO.SetTab(2)
Gui.frmPO.tabPO.Caption("Drop Ship POs")
Gui.frmPO.GsGCPO.Create(GsGridControl)
Gui.frmPO.GsGCPO.Size(15825,6915)
Gui.frmPO.GsGCPO.Position(0,0)
Gui.frmPO.GsGCPO.Event(RowCellClick,GsGCPO_RowCellClick)
Gui.frmPO.GsGCPO.Parent("tabPO",0)
Gui.frmPO.GsGCPO.Event(CellValueChanged,GsGCPO_MouseCellEnter)
Gui.frmPO.GsGCPO.Event(RowClick,GsGCPO_RowClick)
Gui.frmPO.GsGCPOSO.Create(GsGridControl)
Gui.frmPO.GsGCPOSO.Size(16005,6915)
Gui.frmPO.GsGCPOSO.Position(0,0)
Gui.frmPO.GsGCPOSO.Parent("tabPO",1)
Gui.frmPO.GsGCPOSO.Event(RowCellClick,GsGCPO_RowCellClick)
Gui.frmPO.GsGCPODrop.Create(GsGridControl)
Gui.frmPO.GsGCPODrop.Size(15990,6405)
Gui.frmPO.GsGCPODrop.Position(0,0)
Gui.frmPO.GsGCPODrop.Parent("tabPO",2)
Gui.frmPO.GsGCPODrop.Event(RowCellClick,GsGCPO_RowCellClick)
Gui.frmPO.frameOptions.Create(Frame)
Gui.frmPO.frameOptions.Size(2025,1665)
Gui.frmPO.frameOptions.Position(13905,30)
Gui.frmPO.frameOptions.Caption("Options")
Gui.frmPO.frameOptions.Anchor(9)
Gui.frmPO.ddlEmail.Create(DropDownList)
Gui.frmPO.ddlEmail.Size(1935,330)
Gui.frmPO.ddlEmail.Position(45,930)
Gui.frmPO.ddlEmail.Parent("frameOptions")
Gui.frmPO.ddlEmail.Event(Click,SaveEmailOpt)
Gui.frmPO.ddlPOs.Create(DropDownList)
Gui.frmPO.ddlPOs.Size(1935,330)
Gui.frmPO.ddlPOs.Position(45,570)
Gui.frmPO.ddlPOs.Parent("frameOptions")
Gui.frmPO.ddlPOs.Event(Click,SavePOOpt)
Gui.frmPO.ddlCost.Create(DropDownList)
Gui.frmPO.ddlCost.Size(1935,330)
Gui.frmPO.ddlCost.Position(45,210)
Gui.frmPO.ddlCost.Parent("frameOptions")
Gui.frmPO.ddlCost.Event(Click,SaveCostOpt)
Gui.frmPO.ddlBuyer.Create(DropDownList)
Gui.frmPO.ddlBuyer.Size(1935,330)
Gui.frmPO.ddlBuyer.Position(45,1290)
Gui.frmPO.ddlBuyer.Parent("frameOptions")
Gui.frmPO.ddlBuyer.Event(Click,ddlBuyer_Click)
Gui.frmPO.chkBrwVends.Create(CheckBox)
Gui.frmPO.chkBrwVends.Size(1650,270)
Gui.frmPO.chkBrwVends.Position(8850,8430)
Gui.frmPO.chkBrwVends.Caption("Browse Vendors")
Gui.frmPO.chkBrwVends.Event(Click,chkBrwVends_Click)
Gui.frmMRP..Create
Gui.frmMRP..Caption("MRP")
Gui.frmMRP..Size(11715,8760)
Gui.frmMRP..MinX(0)
Gui.frmMRP..MinY(0)
Gui.frmMRP..Position(0,0)
Gui.frmMRP..BackColor(-2147483633)
Gui.frmMRP..MousePointer(0)
Gui.frmMRP..Event(UnLoad,frmMRP_UnLoad)
Gui.frmMRP.GsGCMRP.Create(GsGridControl)
Gui.frmMRP.GsGCMRP.Size(11460,6960)
Gui.frmMRP.GsGCMRP.Position(60,1455)
Gui.frmMRP.GsGCMRP.Anchor(15)
Gui.frmMRP.lblPart.Create(Label,"Part: ",True,2760,255,0,150,135,True,0,"Arial",8,-2147483633,0)
Gui.frmMRP.lblLoc.Create(Label,"Loc:",True,2760,255,0,150,405,True,0,"Arial",8,-2147483633,0)
Gui.frmMRP.lblCurOnHand.Create(Label,"Initial On Hand Qty:",True,2760,255,0,150,1215,True,0,"Arial",8,-2147483633,0)
Gui.frmMRP.lblOrderQty.Create(Label,"Order Qty:",True,2760,255,0,150,675,True,0,"Arial",8,-2147483633,0)
Gui.frmMRP.lblROP.Create(Label,"Reorder Point :",True,2760,255,0,150,945,True,0,"Arial",8,-2147483633,0)
Gui.frmHistory..Create
Gui.frmHistory..Caption("PO History")
Gui.frmHistory..Size(15405,7395)
Gui.frmHistory..MinX(0)
Gui.frmHistory..MinY(0)
Gui.frmHistory..Position(0,0)
Gui.frmHistory..BackColor(-2147483633)
Gui.frmHistory..MousePointer(0)
Gui.frmHistory..Event(UnLoad,frmHistory_UnLoad)
Gui.frmHistory.GsGCHistory.Create(GsGridControl)
Gui.frmHistory.GsGCHistory.Size(15270,7080)
Gui.frmHistory.GsGCHistory.Position(15,15)
Gui.frmHistory.GsGCHistory.Event(RowCellClick,GsGCHistory_RowCellClick)
Gui.frmHistory.GsGCHistory.Anchor(15)
Gui.frmPrevEmail..Create
Gui.frmPrevEmail..Caption("PO - Preview Emails")
Gui.frmPrevEmail..Size(14820,5625)
Gui.frmPrevEmail..MinX(14820)
Gui.frmPrevEmail..MinY(5625)
Gui.frmPrevEmail..Position(0,0)
Gui.frmPrevEmail..BackColor(-2147483633)
Gui.frmPrevEmail..MousePointer(0)
Gui.frmPrevEmail..Event(UnLoad,frmPrevEmail_UnLoad)
Gui.frmPrevEmail..MaxButton(False)
Gui.frmPrevEmail..MinButton(False)
Gui.frmPrevEmail.GsGCPrevEml.Create(GsGridControl)
Gui.frmPrevEmail.GsGCPrevEml.Size(14655,4905)
Gui.frmPrevEmail.GsGCPrevEml.Position(15,15)
Gui.frmPrevEmail.GsGCPrevEml.Event(RowCellClick,GsGCPrevEml_RowCellClick)
Gui.frmPrevEmail.cmdSend.Create(Button)
Gui.frmPrevEmail.cmdSend.Size(1125,375)
Gui.frmPrevEmail.cmdSend.Position(13545,4935)
Gui.frmPrevEmail.cmdSend.Caption("Send Emails")
Gui.frmPrevEmail.cmdSend.Event(Click,cmdSend_Click)
Gui.frmPrevEmail.lblStatus.Create(Label,"Sending Emails....",False,1635,255,0,15,5010,True,0,"Arial",8,-2147483633,0)
Gui.frmPrevEmail.pbStatus.Create(ProgressBar)
Gui.frmPrevEmail.pbStatus.Size(2475,255)
Gui.frmPrevEmail.pbStatus.Position(1665,4950)
Gui.frmPrevEmail.pbStatus.Visible(False)
Gui.frmEmail..Create
Gui.frmEmail..Size(7140,8475)
Gui.frmEmail..MinX(7260)
Gui.frmEmail..MinY(7005)
Gui.frmEmail..Position(0,0)
Gui.frmEmail..BackColor(-2147483633)
Gui.frmEmail..MousePointer(0)
Gui.frmEmail..Event(UnLoad,frmEmail_UnLoad)
Gui.frmEmail..Caption("Edit Email")
Gui.frmEmail..MaxButton(False)
Gui.frmEmail..Sizeable(False)
Gui.frmEmail.txtBody.Create(TextboxM)
Gui.frmEmail.txtBody.Size(6915,3810)
Gui.frmEmail.txtBody.Position(75,2310)
Gui.frmEmail.txtSubject.Create(TextboxM)
Gui.frmEmail.txtSubject.Size(6915,300)
Gui.frmEmail.txtSubject.Position(75,1665)
Gui.frmEmail.lblBody.Create(Label,"Body:",True,660,255,0,75,2085,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.lblSubject.Create(Label,"Subject:",True,765,255,0,75,1440,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.txtSName.Create(TextBox,"",True,3375,300,0,75,360,True,0,"Arial",8,-2147483643,1)
Gui.frmEmail.txtSName.MaxLength(30)
Gui.frmEmail.txtRName.Create(TextBox,"",True,3375,300,0,75,975,True,0,"Arial",8,-2147483643,1)
Gui.frmEmail.txtRName.MaxLength(30)
Gui.frmEmail.txtSEmail.Create(TextBox,"",True,3375,300,0,3570,360,True,0,"Arial",8,-2147483643,1)
Gui.frmEmail.txtSEmail.MaxLength(100)
Gui.frmEmail.txtREmail.Create(TextBox,"",True,3375,300,0,3570,975,True,0,"Arial",8,-2147483643,1)
Gui.frmEmail.txtREmail.MaxLength(100)
Gui.frmEmail.lblSName.Create(Label,"Sender Name:",True,1200,210,0,45,135,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.lblSEmail.Create(Label,"Sender Email:",True,1200,210,0,3540,135,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.lblREmail.Create(Label,"Recipient Email:",True,1305,210,0,3540,750,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.lblRName.Create(Label,"Recipient Name:",True,1350,210,0,45,750,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.cmdSave.Create(Button)
Gui.frmEmail.cmdSave.Size(855,330)
Gui.frmEmail.cmdSave.Position(75,7800)
Gui.frmEmail.cmdSave.Caption("Save")
Gui.frmEmail.cmdSave.Event(Click,cmdSavePreview_Click)
Gui.frmEmail.txtRow.Create(TextBox,"",False,330,300,0,6660,7815,True,0,"Arial",8,-2147483643,1)
Gui.frmEmail.txtAttach.Create(TextboxM)
Gui.frmEmail.txtAttach.Size(6915,1290)
Gui.frmEmail.txtAttach.Position(75,6465)
Gui.frmEmail.lblActtach.Create(Label,"Attachment(s):",True,1185,255,0,75,6240,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.txtDropFiles.Create(TextBox,"Drop Files Here",True,1425,300,0,1275,6150,True,2,"Arial",8,11119017,1)
Gui.frmEmail.txtDropFiles.FontStyle(True,False,False,False,False)
Gui.frmEmail.txtDropFiles.Locked(True)
Program.Sub.ScreenSU.End

Program.Sub.Preflight.Start
	V.Global.sPart.Declare
	V.Global.sLoc.Declare
	V.Global.fQty.Declare
	V.Global.sDt.Declare
	V.Global.iRowIndex.Declare
	V.Global.bVendQte.Declare
	V.Global.bVendQte.Set(True)
	v.Global.bMrp.Declare(Boolean, True)
	v.Global.iLoop.Declare
	v.Global.ProjectDir.Declare(String)
	v.Global.bCustom.Declare(Boolean,False)
	Program.External.Include.Library("175100.lib")
	Program.External.Include.Library("175200.lib")
	'Program.External.Include.Library("GRIDFORMATTING.lib")
Program.Sub.Preflight.End

Program.Sub.Main.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sIcon.Declare
	V.Local.sGssLogo.Declare
	v.Local.bRet.Declare

	F.Intrinsic.Control.CallSub(load_mrp_dictionary)
	
	'set globals for custom table
	f.Intrinsic.Control.CallSub(custom_globals)
	
	Gui.frmPO.cmdViewVendQte.Visible(False)
	Gui.frmPO.cmdNewVendQte.Visible(False)
	
	F.Intrinsic.Control.SelectCase(V.Caller.Hook)
		F.Intrinsic.Control.Case(12990)
			V.Passed.000203.Set("Pref Vendor")
			
		F.Intrinsic.Control.Case(13040)
			F.ODBC.Connection!con.OpenCompanyConnection(500)
			F.Intrinsic.Control.CallSub(SetPrefVendor)
			F.ODBC.Connection!con.Close

		F.Intrinsic.Control.CaseElse
			F.Intrinsic.String.Build("{0}\ART\gss2.ico",v.dictionary.mrpsettings!PROGRAMDIR,v.Local.sIcon)
			F.Intrinsic.String.Build("{0}\ART\GAB_GSS_Logo_Green_Dash.png",v.dictionary.mrpsettings!PROGRAMDIR,V.Local.sGssLogo)
			Gui.frmMRP..Icon(V.Local.sIcon)
			Gui.frmPO..Icon(V.Local.sIcon)
			Gui.frmHistory..Icon(V.Local.sIcon)
			Gui.frmPrevEmail..Icon(V.Local.sIcon)
			Gui.frmEmail..Icon(V.Local.sIcon)
			Gui.frmPO.picGSSLogo.Picture(V.Local.sGssLogo)
			Gui.frmEmail.txtDropFiles.Event("DRAGDROPFILE",Dragdrop)
			
			F.ODBC.Connection!con.OpenCompanyConnection(500)
			
			F.Intrinsic.Control.CallSub(LoadDropDowns)
			F.Intrinsic.Control.CallSub(SetContextMenus)
			F.Intrinsic.Control.CallSub(CheckCostOpt)
			F.Intrinsic.Control.CallSub(CheckPOOpt)
			F.Intrinsic.Control.CallSub(GetCompanyShipTo)
			F.Intrinsic.Control.CallSub(GetVendors)
			
			Gui.frmPO.tabPO.TabVisible(1,False)
			Gui.frmPO.tabPO.SetTab(0)
			
			Gui.frmPO..Show
			F.Intrinsic.Control.CallSub(SetTabAnchors)
			

	F.Intrinsic.Control.EndSelect
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.Main.End

Program.Sub.frmPO_UnLoad.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.ODBC.Connection!con.Close
	F.Intrinsic.Control.End
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.frmPO_UnLoad.End

Program.Sub.SetTabAnchors.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	Gui.frmPO.GsGCPO.Position(0,0)
	Gui.frmPO.GsGCPO.Anchor(15)
	Gui.frmPO.GsGCPOSO.Anchor(15)
	Gui.frmPO.GsGCPODrop.Anchor(15)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.SetTabAnchors.End

Program.Sub.frmPO_Resize.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.iGsGCHt.Declare
	V.Local.iGsGCWt.Declare
	V.Local.iWidth.Declare
	V.Local.iX1.Declare
	V.Local.iX2.Declare
	V.Local.iY1.Declare
	V.Local.iY2.Declare
	
	F.Intrinsic.Math.Div(V.Screen.frmPO!tabPO.Width,3,V.Local.iWidth)
	F.Intrinsic.Math.Sub(V.Local.iWidth,15,V.Local.iWidth)
	Gui.frmPO.GsGCDemand.Size(V.Local.iWidth,3875)
	Gui.frmPO.GsGCVendQte.Size(V.Local.iWidth,3875)
	Gui.frmPO.GsGCSupply.Size(V.Local.iWidth,3875)
	'Demand
	F.Intrinsic.Math.Add(V.Screen.frmPO!tabPO.Top,V.Screen.frmPO!tabPO.Height,80,V.Local.iY1)
	Gui.frmPO.lblDemand.Position(V.Screen.frmPO!tabPO.Left,V.Local.iY1)
	F.Intrinsic.Math.Add(V.Screen.frmPO!lblDemand.Top,V.Screen.frmPO!lblDemand.Height,V.Local.iY2)
	Gui.frmPO.GsGCDemand.Position(V.Screen.frmPO!tabPO.Left,V.Local.iY2)
	'Vendor Quote
	F.Intrinsic.Math.Add(V.Screen.frmPO!GsGCDemand.Left,V.Screen.frmPO!GsGCDemand.Width,15,V.Local.iX1)
	Gui.frmPO.lblVendQte.Position(V.Local.iX1,V.Local.iY1)
	Gui.frmPO.GsGCVendQte.Position(V.Local.iX1,V.Local.iY2)
	'Supply
	F.Intrinsic.Math.Add(V.Screen.frmPO!GsGCVendQte.Left,V.Screen.frmPO!GsGCVendQte.Width,15,V.Local.iX2)
	Gui.frmPO.lblSupply.Position(V.Local.iX2,V.Local.iY1)
	Gui.frmPO.GsGCSupply.Position(V.Local.iX2,V.Local.iY2)
	'New Button
	F.Intrinsic.Math.Add(V.Screen.frmPO!lblVendQte.Left,V.Screen.frmPO!lblVendQte.Width,700,V.Local.iX1)
	F.Intrinsic.Math.Add(V.Screen.frmPO!tabPO.Top,V.Screen.frmPO!tabPO.Height,-25,V.Local.iY1)
	Gui.frmPO.cmdNewVendQte.Position(V.Local.iX1,V.Local.iY1)
	'View Button
	F.Intrinsic.Math.Add(V.Local.iX1,-650,V.Local.iX2)
	Gui.frmPO.cmdViewVendQte.Position(V.Local.iX2,V.Local.iY1)
	'Check Browse Vendors
	F.Intrinsic.Math.Add(V.Screen.frmPO!GsGCVendQte.Left,V.Screen.frmPO!GsGCVendQte.Width,-1650,V.Local.iX1)
	F.Intrinsic.Math.Add(V.Screen.frmPO!tabPO.Top,V.Screen.frmPO!tabPO.Height,-5,V.Local.iY1)
	
	Gui.frmPO.chkBrwVends.Position(V.Local.iX1,V.Local.iY1)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.frmPO_Resize.End

Program.Sub.LoadDropDowns.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	F.Intrinsic.Control.BlockEvents

	'Cost
	Gui.frmPO.ddlCost.AddItem("PO History Cost",0)
	Gui.frmPO.ddlCost.AddItem("Vendor Quote Cost",1)
	Gui.frmPO.ddlCost.Text("PO History Cost")
	'POs
	Gui.frmPO.ddlPOs.AddItem("Individual POs",0)
	Gui.frmPO.ddlPOs.AddItem("Group POs by Vendor",1)
	Gui.frmPO.ddlPOs.Text("Individual POs")
	'Email
	Gui.frmPO.ddlEmail.AddItem("Do Not Email",0)
	Gui.frmPO.ddlEmail.AddItem("Auto Email",1)
	Gui.frmPO.ddlEmail.AddItem("Preview Email",2)
	Gui.frmPO.ddlEmail.Text("Do Not Email")
	
	F.Intrinsic.Control.UnBlockEvents

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadDropDowns.End

Program.Sub.SetContextMenus.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	Gui.frmPO..ContextMenuCreate("ctxPO")
	Gui.frmPO.GsGCPO.ContextMenuAttach("ctxPO")
	Gui.frmPO..ContextMenuAddItem("ctxPO","Refresh",0,"Refresh")
	Gui.frmPO..ContextMenuAddItem("ctxPO","Export",0,"Export")
	Gui.frmPO..ContextMenuAddItem("ctxPO","Exp",3)
	Gui.frmPO..ContextMenuAddItem("ctxPO","New",0,"Create PO (Manual)")
	Gui.frmPO..ContextMenuAddItem("ctxPO","NewAuto",0,"Create PO (Auto)")
	Gui.frmPO..ContextMenuSetItemEventHandler("ctxPO","Refresh","cmdRefresh_Click")
	Gui.frmPO..ContextMenuSetItemEventHandler("ctxPO","Export","MenuClickExport")
	Gui.frmPO..ContextMenuSetItemEventHandler("ctxPO","New","MenuClickNew")
	Gui.frmPO..ContextMenuSetItemEventHandler("ctxPO","NewAuto","MenuClickNewAuto")
	
	Gui.frmPO..ContextMenuCreate("ctxPODrop")
	Gui.frmPO.GsGCPODrop.ContextMenuAttach("ctxPODrop")
	Gui.frmPO..ContextMenuAddItem("ctxPODrop","Refresh",0,"Refresh")
	Gui.frmPO..ContextMenuAddItem("ctxPODrop","Export",0,"Export")
'	Gui.frmPO..ContextMenuAddItem("ctxPODrop","New",0,"Create PO (Manual)")
'	Gui.frmPO..ContextMenuAddItem("ctxPODrop","NewAuto",0,"Create PO (Auto)")
	Gui.frmPO..ContextMenuSetItemEventHandler("ctxPODrop","Refresh","cmdRefresh_Click")
	Gui.frmPO..ContextMenuSetItemEventHandler("ctxPODrop","Export","MenuClickExport")
'	Gui.frmPO..ContextMenuSetItemEventHandler("ctxPODrop","New","MenuClickNew")
'	Gui.frmPO..ContextMenuSetItemEventHandler("ctxPODrop","NewAuto","MenuClickNewAuto")
	
	Gui.frmPO..ContextMenuCreate("ctxDemand")
	Gui.frmPO.GsGCDemand.ContextMenuAttach("ctxDemand")
	Gui.frmPO..ContextMenuAddItem("ctxDemand","Export",0,"Export")
	Gui.frmPO..ContextMenuSetItemEventHandler("ctxDemand","Export","MenuClickExport")
	
	Gui.frmPO..ContextMenuCreate("ctxVendQte")
'	Gui.frmPO.GsGCVendQte.ContextMenuAttach("ctxVendQte")
	Gui.frmPO..ContextMenuAddItem("ctxVendQte","View",0,"View")
	Gui.frmPO..ContextMenuAddItem("ctxVendQte","New",0,"New")
	Gui.frmPO..ContextMenuAddItem("ctxVendQte","Exp",3)
	Gui.frmPO..ContextMenuAddItem("ctxVendQte","Export",0,"Export")
	Gui.frmPO..ContextMenuSetItemEventHandler("ctxVendQte","View","MenuClick")
	Gui.frmPO..ContextMenuSetItemEventHandler("ctxVendQte","New","MenuClick")
	Gui.frmPO..ContextMenuSetItemEventHandler("ctxVendQte","Export","MenuClickExport")
	
	Gui.frmPO..ContextMenuCreate("ctxVendor")
'	Gui.frmPO.GsGCVendQte.ContextMenuAttach("ctxVendor")
	Gui.frmPO..ContextMenuAddItem("ctxVendor","Export",0,"Export")
	Gui.frmPO..ContextMenuSetItemEventHandler("ctxVendor","Export","MenuClickExport")
	
	Gui.frmPO..ContextMenuCreate("ctxSupply")
	Gui.frmPO.GsGCSupply.ContextMenuAttach("ctxSupply")
	Gui.frmPO..ContextMenuAddItem("ctxSupply","Export",0,"Export")
	Gui.frmPO..ContextMenuSetItemEventHandler("ctxSupply","Export","MenuClickExport")
	
	Gui.frmMRP..ContextMenuCreate("ctxMRP")
	Gui.frmMRP.GsGCMRP.ContextMenuAttach("ctxMRP")
	Gui.frmMRP..ContextMenuAddItem("ctxMRP","Export",0,"Export")
	Gui.frmMRP..ContextMenuSetItemEventHandler("ctxMRP","Export","MenuClickExport")
	
	Gui.frmHistory..ContextMenuCreate("ctxHIST")
	Gui.frmHistory.GsGCHistory.ContextMenuAttach("ctxHIST")
	Gui.frmHistory..ContextMenuAddItem("ctxHIST","Export",0,"Export")
	Gui.frmHistory..ContextMenuAddItem("ctxHIST","ResetColumns",0,"Reset Columns")
	Gui.frmHistory..ContextMenuSetItemEventHandler("ctxHIST","Export","MenuClickExport")
	Gui.frmHistory..ContextMenuSetItemEventHandler("ctxHIST","ResetColumns","MenuClickResetColumns")
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.SetContextMenus.End

Program.Sub.MenuClickExport.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sFileExport.Declare
	V.Local.bExcel.Declare
	V.Local.bFileLocked.Declare
	V.Local.sMsg.Declare
	V.Local.sForm.Declare
	V.Local.sControl.Declare
	
	F.Intrinsic.Control.SelectCase(V.Args.MenuName)
		F.Intrinsic.Control.Case("CTXPO")
			V.Local.sForm.Set("frmPO")
			V.Local.sControl.Set("GsGCPO")
		F.Intrinsic.Control.Case("CTXPODROP")
			V.Local.sForm.Set("frmPO")
			V.Local.sControl.Set("GsGCPODrop")
		F.Intrinsic.Control.Case("CTXDEMAND")
			V.Local.sForm.Set("frmPO")
			V.Local.sControl.Set("GsGCDemand")
		F.Intrinsic.Control.CaseAny("CTXVENDQTE","CTXVENDOR")
			V.Local.sForm.Set("frmPO")
			V.Local.sControl.Set("GsGCVendQte")
		F.Intrinsic.Control.Case("CTXSUPPLY")
			V.Local.sForm.Set("frmPO")
			V.Local.sControl.Set("GsGCSupply")
		F.Intrinsic.Control.Case("CTXMRP")
			V.Local.sForm.Set("frmMRP")
			V.Local.sControl.Set("GsGCMRP")
		F.Intrinsic.Control.Case("CTXHIST")
			V.Local.sForm.Set("frmHistory")
			V.Local.sControl.Set("GsGCHistory")
	F.Intrinsic.Control.EndSelect

	F.Automation.MSExcel.CheckPresence(V.Local.bExcel)
	F.Intrinsic.Control.If(V.Local.bExcel)
		F.Intrinsic.String.Build("{0}\GCG_4176_{1}_Export.xlsx",V.Caller.LocalGssTempDir,V.Local.sControl,V.Local.sFileExport)
		F.Intrinsic.File.IsFileLocked(V.Local.sFileExport,V.Local.bFileLocked)
		F.Intrinsic.Control.If(V.Local.bFileLocked)
			F.Intrinsic.String.Build("File is already open. Please close and export again.{0}File: {1}",V.Ambient.NewLine,V.Local.sFileExport,V.Local.sMsg)
			F.Intrinsic.UI.Msgbox(V.Local.sMsg,"File In Use")
		F.Intrinsic.Control.Else
			Gui.[V.Local.sForm].[V.Local.sControl].Export(V.Local.sFileExport,"xlsx")
			F.Intrinsic.Task.ShellExec(0,"",V.Local.sFileExport,"","",1)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Build("{0}\GCG_4176_{1}_Export.csv",V.Caller.LocalGssTempDir,V.Local.sControl,V.Local.sFileExport)
		F.Intrinsic.File.IsFileLocked(V.Local.sFileExport,V.Local.bFileLocked)
		F.Intrinsic.Control.If(V.Local.bFileLocked)
			F.Intrinsic.String.Build("File is already open. Please close and export again.{0}File: {1}",V.Ambient.NewLine,V.Local.sFileExport,V.Local.sMsg)
			F.Intrinsic.UI.Msgbox(V.Local.sMsg,"File In Use")
		F.Intrinsic.Control.Else
			Gui.[V.Local.sForm].[V.Local.sControl].Export(V.Local.sFileExport,"csv")
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Task.ShellExec(0,"",V.Local.sFileExport,"","",1)
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.CatchWhen(5700)
		F.Intrinsic.UI.Msgbox("No Data to Export","Export")
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.MenuClickExport.End

Program.Sub.MenuClickResetColumns.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	F.Intrinsic.Control.SelectCase(V.Args.MenuName)
		F.Intrinsic.Control.Case("CTXHIST")
			F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"GVHIST",4936,1000,False,"Serialize",False,0,-999.0,1/1/1980,12:00:00 AM,"")
			Gui.frmHistory..Visible(False)
	F.Intrinsic.Control.EndSelect
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.MenuClickResetColumns.End

Program.Sub.MenuClickNew.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.iRowCnt.Declare
	V.Local.iRowCnt2.Declare
	V.Local.iRow.Declare
	V.Local.sVendorNo.Declare
	V.Local.sParams.Declare
	V.Local.sDT.Declare
	V.Local.sGV.Declare
	
	F.Intrinsic.Control.SelectCase(V.Args.MenuName)
		F.Intrinsic.Control.Case("CTXPO")
			Gui.frmPO.GsGCPO.GetSelectedRows("gvPO",V.Local.iRow)
			Gui.frmPO.GsGCPO.GetCellValueByColumnName("gvPO","Vendor",V.Local.iRow,V.Local.sVendorNo)
			V.Local.sDT.Set("dtPO")
			
		F.Intrinsic.Control.Case("CTXPODROP")
			Gui.frmPO.GsGCPODrop.GetSelectedRows("gvPODrop",V.Local.iRow)
			Gui.frmPO.GsGCPODrop.GetCellValueByColumnName("gvPODrop","Vendor",V.Local.iRow,V.Local.sVendorNo)
			V.Local.sDT.Set("dtPODrop")
			
	F.Intrinsic.Control.EndSelect

	F.ODBC.Connection!con.ExecuteAndReturn("SELECT COUNT(*) FROM V_PO_HEADER;",V.Local.iRowCnt)
	F.Intrinsic.String.ConcatCallWrapperArgs("N","",V.Local.sVendorNo,V.Local.sParams)
	F.Global.General.CallWrapperSync(175200,V.Local.sParams)
	F.ODBC.Connection!con.ExecuteAndReturn("SELECT COUNT(*) FROM V_PO_HEADER;",V.Local.iRowCnt2)
	F.Intrinsic.Control.If(V.Local.iRowCnt,<>,V.Local.iRowCnt2)
		'Remove/Hide line from the PO Screen
		F.Data.DataTable.DeleteRow(V.Local.sDT,V.Local.iRow)
		F.Data.DataTable.AcceptChanges(V.Local.sDT)
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.MenuClickNew.End

Program.Sub.MenuClickNewAuto.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.iCnt.Declare
	V.Local.dDueDate.Declare
	V.Local.fExtension.Declare
	V.Local.sSelect.Declare
	
	F.Intrinsic.Control.SelectCase(V.Args.MenuName)
		F.Intrinsic.Control.Case("CTXPO")
			
			Gui.frmPO.lblStatus.Caption("Generating POs....")
			Gui.frmPO.lblStatus.Visible(True)
			
			F.Intrinsic.Control.If(V.Screen.frmPO!ddlPOs.Text,=,"Individual POs")
				f.Intrinsic.Control.CallSub(MenuClickCreateAutoPOs)

			F.Intrinsic.Control.Else
				f.Intrinsic.Control.CallSub(MenuClickCreateAutoPOs)				
			f.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndSelect
	
	
	Gui.frmPO.lblStatus.Visible(False)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.MenuClickNewAuto.End

Program.Sub.MenuClickCreateAutoPOs.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.iCnt.Declare
	V.Local.iCnt2.Declare
	v.Local.iCnt3.Declare
	V.Local.dDueDate.Declare
	v.Local.fQty.Declare
	V.Local.fExtension.Declare
	V.Local.sSelect.Declare
	V.Local.iPO.Declare
	V.Local.sPO.Declare
	V.Local.iPOLine.Declare
	V.Local.sPOLine.Declare
	V.Local.sFilter.Declare
	V.Local.sFilter2.Declare
	V.Local.sStatus.Declare
	V.Local.sReturnFileName.Declare
	V.Local.sSQL.Declare
	V.Local.sFileName.Declare
	V.Local.sPURORDER.Declare
	V.Local.sEmailList.Declare
	V.Local.sName.Declare
	V.Local.sNameSplit.Declare
	V.Local.sBuyerCode.Declare
	V.Local.sGV.Declare
	V.Local.sDT.Declare	

	F.Intrinsic.Control.SelectCase(V.Screen.frmPO!tabPO.Tab)
		F.Intrinsic.Control.Case(0)
			V.Local.sGV.Set("gvPO")
			V.Local.sDT.Set("dtPO")
		F.Intrinsic.Control.Case(1)
			V.Local.sGV.Set("gvPOSO")
			V.Local.sDT.Set("dtPOSO")
		F.Intrinsic.Control.Case(2)
			V.Local.sGV.Set("gvPODrop")
			V.Local.sDT.Set("dtPODrop")
		F.Intrinsic.Control.Case(3)
			V.Local.sGV.Set("gvReqs")
			V.Local.sDT.Set("dtReqs")
	F.Intrinsic.Control.EndSelect
	
	V.Local.sEmailList.Set("***EMPTY***")
	
	'Get Buyer Code
	F.Global.Security.GetFullName(V.Caller.User,V.Local.sName)
	F.Intrinsic.String.Split(V.Local.sName," ",V.Local.sNameSplit)
	F.Intrinsic.Control.If(V.Local.sNameSplit.UBound,=,2)
		F.Intrinsic.String.Build("{0} {1}",V.Local.sNameSplit(0),V.Local.sNameSplit(2),V.Local.sName)
	F.Intrinsic.Control.EndIf
	F.Intrinsic.String.Build("Select Buyer_Code From V_Buyers Where Upper(Buyer) = Upper('{0}');",V.Local.sName,V.Local.sSQL)
	F.ODBC.Connection!con.ExecuteAndReturn(V.Local.sSQL,V.Local.sBuyerCode)
	'Create Grouped POs
	F.Data.DataView.Create(V.Local.sDT,"dvPOVends",22,"Select = True And VendorName <> ''","")
	F.Data.DataView.ToDataTableDistinct(V.Local.sDT,"dvPOVends","dtPOVends","Vendor*!*VendorName",True)
	F.Data.DataView.Close(V.Local.sDT,"dvPOVends")
	F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtPOVends.RowCount--,1)
		F.Intrinsic.String.Build("Select = True And Vendor = '{0}'",V.DataTable.dtPOVends(V.Local.iCnt).Vendor!FieldValTrim,V.Local.sFilter)
		F.Data.DataTable.Select(V.Local.sDT,V.Local.sFilter,V.Local.sSelect)
		
		'Set PO Number - the po number is by vendor
		F.ODBC.Connection!con.ExecuteAndReturn("Select Last_PO_Num From Last_PO Where Ass_Sys = 'PUR' And Ass_Sub_Sys = 'CTL';",V.Local.iPO)
		F.Intrinsic.String.LPad(V.Local.iPO.++,"0",7,V.Local.sPO)
		v.Local.iPOLine.Set(0)
		F.Intrinsic.Control.If(V.Local.sSelect,<>,"***NORETURN***")
			F.Intrinsic.String.Split(V.Local.sSelect,"*!*",V.Local.sSelect)
			F.Intrinsic.Control.For(V.Local.iCnt2,0,V.Local.sSelect.UBound,1)

'*****				'get the MRP lines here, group by date, sum quantity, get a distinct count and loop within the loop
				f.Intrinsic.String.Build("KEEP = True and part = '{0}'",v.DataTable.dtPO(v.Local.sSelect(v.Local.iCnt2)).part!fieldvalSTRING,v.Local.sFilter)
				'filter the MRP lines
				f.Data.DataView.Create("dtPO$dtMRP","dvPurchase",22,v.Local.sFilter,"")
				F.Intrinsic.Control.If(V.DataView.dtPO!dvPurchase.RowCount,>,0)
					f.Data.DataView.ToDatatableDistinct("dtPO","dvPurchase","POLines","part*!*date_due",True)
					f.Data.DataView.ToDataTableDistinct("dtPO","dvPurchase","FIDLines","FID*!*PART*!*DATE_DUE",True)
					f.Data.DataTable.AddColumn("POLines","PONumber","STRING")
					F.Data.DataTable.AddColumn("POLines","LineNumber","STRING")
					
					
					'for each MRP date
					f.Intrinsic.Control.For(v.Local.iCnt3,0,v.DataTable.POLines.RowCount--,1)
						f.Intrinsic.String.Build("{0} and DATE_DUE = #{1}#",v.Local.sFilter,V.DataTable.POLines(v.Local.iCnt3).DATE_DUE!FIELDVALSTRING,V.Local.sFilter2)
						F.Data.DataTable.Compute("dtPO$dtMRP","sum(QUANTITY)",v.Local.sFilter2,v.Local.fQty)
						v.Local.dDueDate.Set(v.DataTable.POLines(v.Local.iCnt3).DATE_DUE!FIELDVALSTRING)

						'Set PO Line
						F.Intrinsic.Math.Add(V.Local.iCnt2,1,V.Local.iPOLine)
						F.Intrinsic.String.LPad(V.Local.iPOLine,"0",3,V.Local.sPOLine)
						F.Data.DataTable.SetValue("POLines",V.Local.iCnt3,"PONumber",V.Local.sPO,"LineNumber",V.Local.sPOLine)
						'Create Upload File: PURORDER.txt
						F.Intrinsic.Control.CallSub("GenerateGroupedPOs","PO",V.Local.sPO,"POLine",V.Local.sPOLine,"Vendor",V.DataTable.dtPOVends(V.Local.iCnt).Vendor!FieldValTrim,"DueDate",v.Local.dDueDate,"Part",V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt2)).Part!FieldValTrim,"Loc",V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt2)).Location!FieldValTrim,"Description",V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt2)).Description!FieldValTrim,"UM",V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt2)).UM!FieldValTrim,"PL",V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt2)).PL!FieldValTrim,"Cost",V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt2)).Cost!FieldValTrim,"Qty",v.Local.fQty,"BuyerCode",V.Local.sBuyerCode,"GLAccount",V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt2)).GLAcct!FieldValTrim,"ReqNo",V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt2)).PO_Req_Number!FieldVal,"ReqLine",V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt2)).PO_Req_Line!FieldVal)
						'Set data to text file variable
						F.Intrinsic.Control.If(V.Local.sPURORDER,=,"")
							V.Local.sPURORDER.Set(v.Args.POTEXT)
						F.Intrinsic.Control.Else
							F.Intrinsic.String.Build("{0}{1}",V.Local.sPURORDER,V.Args.POTEXT,V.Local.sPURORDER)
						F.Intrinsic.Control.EndIf
						'Update On Order PO in Invenoty_Mstr (I1MST)
						F.Intrinsic.String.Build("Update Inventory_Mstr Set Qty_OnOrder_PO = Qty_OnOrder_PO + {0} Where Part = '{1}' And Location = '{2}';",V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt2)).Purchase!FieldValTrim,V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt2)).Part!FieldValTrim,V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt2)).Location!FieldValTrim,V.Local.sSQL)
						F.ODBC.Connection!con.Execute(V.Local.sSQL)
					f.Intrinsic.Control.Next(v.Local.iCnt3)
					
					
					f.Intrinsic.Control.If(v.DataTable.MRPUpdate.Exists,=,False)
						f.Data.DataTable.Clone("POLines","MRPUpdate",True)
						f.Data.DataTable.Merge("POLines","MRPUpdate",True,2)
						F.Data.DataTable.Clone("FIDLines","UpdateLines",True)
						f.Data.DataTable.Merge("FIDLines","UpdateLines",True,2)
					f.Intrinsic.Control.Else
						f.Data.DataTable.Merge("POLines","MRPUpdate",True,2)
						f.Data.DataTable.Merge("FIDLines","UpdateLines",True,2)
					f.Intrinsic.Control.EndIf
					F.Data.DataTable.Close("POLines")
					f.Data.DataTable.Close("FIDLines")
					F.Data.DataView.Close("dtPO$dtMRP","dvPurchase")
				f.Intrinsic.Control.Else
					'Set PO Line
					F.Intrinsic.Math.Add(V.Local.iPOLine,1,V.Local.iPOLine)
					F.Intrinsic.String.LPad(V.Local.iPOLine,"0",3,V.Local.sPOLine)
					'Create Upload File: PURORDER.txt

					
					F.Intrinsic.Control.CallSub("GenerateGroupedPOs","PO",V.Local.sPO,"POLine",V.Local.sPOLine,"Vendor",V.DataTable.dtPOVends(V.Local.iCnt).Vendor!FieldValTrim,"DueDate",V.DataTable.dtPO(V.Local.sSelect(V.Local.iCnt2)).DATE_DUE!FieldValTrim,"Part",V.DataTable.dtPO(V.Local.sSelect(V.Local.iCnt2)).Part!FieldValTrim,"Loc",V.DataTable.dtPO(V.Local.sSelect(V.Local.iCnt2)).Location!FieldValTrim,"Description",V.DataTable.dtPO(V.Local.sSelect(V.Local.iCnt2)).Description!FieldValTrim,"UM",V.DataTable.dtPO(V.Local.sSelect(V.Local.iCnt2)).UM!FieldValTrim,"PL",V.DataTable.dtPO(V.Local.sSelect(V.Local.iCnt2)).PL!FieldValTrim,"Cost",V.DataTable.dtPO(V.Local.sSelect(V.Local.iCnt2)).Cost!FieldValTrim,"Qty",V.DataTable.dtPO(V.Local.sSelect(V.Local.iCnt2)).Purchase!FieldValTrim,"BuyerCode",V.Local.sBuyerCode)
					'Set data to text file variable
					F.Intrinsic.Control.If(V.Local.sPURORDER,=,"")
						V.Local.sPURORDER.Set(v.Args.POTEXT)
					F.Intrinsic.Control.Else
						F.Intrinsic.String.Build("{0}{1}",V.Local.sPURORDER,V.Args.POTEXT,V.Local.sPURORDER)
					F.Intrinsic.Control.EndIf
					'Update On Order PO in Invenoty_Mstr (I1MST)
					F.Intrinsic.String.Build("Update Inventory_Mstr Set Qty_OnOrder_PO = Qty_OnOrder_PO + {0} Where Part = '{1}' And Location = '{2}';",V.DataTable.dtPO(V.Local.sSelect(V.Local.iCnt2)).Purchase!FieldValTrim,V.DataTable.dtPO(V.Local.sSelect(V.Local.iCnt2)).Part!FieldValTrim,V.DataTable.dtPO(V.Local.sSelect(V.Local.iCnt2)).Location!FieldValTrim,V.Local.sSQL)
					F.ODBC.Connection!con.Execute(V.Local.sSQL)
				f.Intrinsic.Control.EndIf
						
			F.Intrinsic.Control.Next(V.Local.iCnt2)

			
			'Write PO info to PURORDER.txt
			F.Intrinsic.String.Build("{0}\PURORDER.txt",V.Caller.FilesDir,V.Local.sFileName)
			F.Intrinsic.File.String2File(V.Local.sFileName,V.Local.sPURORDER)
			'Upload PO File
			F.Global.Callwrapper.New("POUpload","Purchasing.PurchaseOrderUpload")
			F.Global.Callwrapper.SetProperty("POUpload","Mode",0)
			F.Global.Callwrapper.SetProperty("POUpload","FileName","PURORDER")
			F.Global.CallWrapper.Run("POUpload")
			F.Global.CallWrapper.GetProperty("POUpload","Status",V.Local.sStatus)
			F.Global.CallWrapper.GetProperty("POUpload","ReturnFileName",V.Local.sReturnFileName)
			'Update Last PO Number
			F.Intrinsic.String.Build("Update Last_PO Set Last_PO_Num = '{0}' Where Ass_Sys = 'PUR' And Ass_Sub_Sys = 'CTL';",V.Local.sPO,V.Local.sSQL)
			F.ODBC.Connection!Con.Execute(V.Local.sSQL)
			F.Intrinsic.Control.If(V.Local.sEmailList.IsNullOrWhiteSpace)
				F.Intrinsic.String.Build("'{0}'",V.Local.sPO,V.Local.sEmailList)
			F.Intrinsic.Control.Else
				F.Intrinsic.String.Build("{0},'{1}'",V.Local.sEmailList,V.Local.sPO,V.Local.sEmailList)
			F.Intrinsic.Control.EndIf
			'Delete PURORDER.txt
			F.Intrinsic.File.DeleteFile(V.Local.sFileName)
			V.Local.sPURORDER.Set("")
				
		F.Intrinsic.Control.EndIf
		f.Data.DataTable.AddRow("175200","MODE","O","PONUM",V.Local.sPO,"VENDNUM",V.DataTable.dtPOVends(V.Local.iCnt).Vendor!FieldValTrim)
	F.Intrinsic.Control.Next(V.Local.iCnt)
	F.Data.DataTable.Close("dtPOVends")
	
	'update mrp_planning table with po numbers and lines
	F.Intrinsic.Control.If(V.DataTable.MRPUPDATE.RowCount,>,0)
		f.Intrinsic.Control.CallSub(update_mrp_planning)
	F.Intrinsic.Control.EndIf
	
	'Remove Lines from DataTable
	F.Data.DataTable.Select(V.Local.sDT,"Select = True And VendorName <> ''",V.Local.sSelect)
	F.Intrinsic.Control.If(V.Local.sSelect,<>,"***NORETURN***")
		F.Intrinsic.String.Split(V.Local.sSelect,"*!*",V.Local.sSelect)
		F.Intrinsic.Control.For(V.Local.iCnt,V.Local.sSelect.UBound,0,-1)
			'Move Purchase Requisition to History
			F.Intrinsic.Control.If(V.Local.sDT,=,"dtReqs")
				F.Intrinsic.Control.CallSub(MovePurchReqToHist,"POReqNum",V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt)).PO_Req_Number!FieldValTrim,"POReqLine",V.DataTable.[V.Local.sDT](V.Local.sSelect(V.Local.iCnt)).PO_Req_Line!FieldValTrim)
			F.Intrinsic.Control.EndIf
			'Delete Rows
			F.Data.DataTable.DeleteRow(V.Local.sDT,V.Local.sSelect(V.Local.iCnt))
			F.Data.DataTable.AcceptChanges(V.Local.sDT)
		F.Intrinsic.Control.Next(V.Local.iCnt)
		F.Data.DataTable.SetValue(V.Local.sDT,-1,"Select",False)
	F.Intrinsic.Control.EndIf

	'Launch the PO's to edit and email.
	f.Intrinsic.Control.CallSub(175200Sync)

	'Emails
	F.Intrinsic.Control.If(v.Screen.frmPO!ddlEmail.text,<>,"Do Not Email",AND,V.Local.sEmailList.IsNotNullOrWhiteSpace)
		F.Intrinsic.Control.CallSub(GenerateEmail,"EmailList",V.Local.sEmailList)
	F.Intrinsic.Control.EndIf

Program.Sub.MenuClickCreateAutoPOs.End

Program.Sub.MenuClick.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.iRet.Declare

	F.Intrinsic.Control.SelectCase(V.Args.ItemName)
		F.Intrinsic.Control.Case("VIEW")
			F.Global.General.LaunchMenuTask(271,2,V.Local.iRet)

		F.Intrinsic.Control.Case("NEW")
			F.Intrinsic.Control.If(V.Global.sPart,<>,"")
				F.Global.General.CallWrapperAsync(175000,V.Global.sPart)
			F.Intrinsic.Control.EndIf
			
	F.Intrinsic.Control.EndSelect

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.MenuClick.End

Program.Sub.GenerateGroupedPOs.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sSQL.Declare
	V.Local.sVenName.Declare
	V.Local.sVenAdd1.Declare
	V.Local.sVenAdd2.Declare
	V.Local.sVenState.Declare
	V.Local.sVenZip.Declare
	V.Local.sVenCity.Declare
	V.Local.sVenAttn.Declare
	V.Local.sVenGL.Declare
	V.Local.sGL.Declare
	V.Local.sCurrency.Declare
	V.local.sPODate.Declare
	V.local.sPODueDate.Declare
	V.Local.sRet.Declare
	V.Local.sTemp.Declare
	V.Local.sTempFull.Declare

	F.Intrinsic.Control.If(V.Args.POLine,=,001)
	'------------------------------------------------------------# Header #-------------------------------------------------------------
		F.Intrinsic.String.Build("Select A.Vendor,A.Name_Vendor,A.Address1,A.Address2,A.City,A.Rec,A.State,A.Code_Zip,A.Country,A.Attention,A.Normal_GL_Account,B.Default_Currency As CurrencyCode From V_Vendor_Master A Left Join V_Vendor_Intl As B on A.Vendor = B.Vendor Where A.Vendor = '{0}';",V.Args.Vendor,V.Local.sSQL)
		F.ODBC.Connection!Con.OpenLocalRecordsetRO("rstVend",V.Local.sSQL)
		F.Intrinsic.Control.If(V.ODBC.Con!rstVend.EOF,=,False)
			V.Local.sVenName.set(V.ODBC.Con!rstVend.FieldVal!Name_Vendor)
			V.Local.sVenAdd1.set(V.ODBC.Con!rstVend.FieldVal!Address1)
			V.Local.sVenAdd2.set(V.ODBC.Con!rstVend.FieldVal!Address2)
			V.Local.sVenState.set(V.ODBC.Con!rstVend.FieldVal!State)
			V.Local.sVenZip.set(V.ODBC.Con!rstVend.FieldVal!Code_Zip)
			V.Local.sVenCity.set(V.ODBC.Con!rstVend.FieldVal!City)
			V.Local.sVenAttn.set(V.ODBC.Con!rstVend.FieldVal!Attention)
			V.Local.sVenGL.set(V.ODBC.Con!rstVend.FieldVal!Normal_GL_Account)
			V.Local.sCurrency.set(V.ODBC.Con!rstVend.FieldVal!CurrencyCode)
		F.Intrinsic.Control.EndIf
		F.ODBC.Con!rstVend.Close
		'PO Date
		F.Intrinsic.String.Format(V.Ambient.Date,"MMDDYY",V.local.sPODate)
		'RequiredDate,DueDate
		F.Intrinsic.String.Format(V.Args.DueDate,"MMDDYY",V.local.sPODueDate)
	'A Record
		'PO,Rec Type  7 + 3 + 2
		F.Intrinsic.String.Concat(V.Args.PO,"  A",V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",12,V.Local.sTemp)
		'Buyer 12 + 7
		V.Local.sRet.Set("")
		F.Intrinsic.String.RPad(V.Args.BuyerCode," ",7,V.Local.sRet)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Local.sRet,V.Local.sTemp)
		'Ship Via 19 + 15
		V.Local.sRet.Set("")
		F.Intrinsic.String.RPad(V.Local.sRet," ",15,V.Local.sRet)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Local.sRet,V.Local.sTemp)
		'FOB  44 + 15
		V.Local.sRet.Set("")
		F.Intrinsic.String.RPad(V.Local.sRet," ",15,V.Local.sRet)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Local.sRet,V.Local.sTemp)
		'Terms 59 + 12
		V.Local.sRet.Set("")
		F.Intrinsic.String.RPad(V.Local.sRet," ",12,V.Local.sRet)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Local.sRet,V.Local.sTemp)
		'PO Date 71 + 6
		F.Intrinsic.String.Rpad(V.Local.sTemp," ",195,V.Local.sTemp)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.local.sPODate,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",207,V.Local.sTemp)
		'Date Due
		F.Intrinsic.String.Concat(V.Local.sTemp,V.local.sPODueDate,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",229,V.Local.sTemp)
		'GL Account
		V.Local.sGL.Set(V.Args.GLAccount)
		F.Intrinsic.Control.If(V.Local.sGL.Trim,=,"")
			V.Local.sGL.Set(V.Local.sVenGL)
		F.Intrinsic.Control.EndIf
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Local.sGL,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",267,V.Local.sTemp)
		'Vendor #
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Args.Vendor,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",298,V.Local.sTemp)
		'User 1
		F.Intrinsic.String.Concat(V.Local.sTemp,"",V.Local.sTemp)
		'New Line
		F.Intrinsic.String.Concat(V.Local.sTempFull,V.Local.sTemp,V.Ambient.NewLine,V.Local.sTempFull)
	'B Record
		'PO,Rec Type,Name Vendor
		F.Intrinsic.String.Concat(V.Args.PO,"  B",V.Local.sVenName,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",40,V.Local.sTemp)
		'Vendor Address
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Local.sVenAdd1,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",70,V.Local.sTemp)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Local.sVenAdd2,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",190,V.Local.sTemp)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Local.sVenCity,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",210,V.Local.sTemp)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Local.sVenState,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",212,V.Local.sTemp)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Local.sVenZip,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",237,V.Local.sTemp)
		'Attention
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Local.sVenAttn,V.Local.sTemp)
		'New Line
		F.Intrinsic.String.Concat(V.Local.sTempFull,V.Local.sTemp,V.Ambient.NewLine,V.Local.sTempFull)
	'C Record
		F.Intrinsic.String.Concat(V.Args.PO,"  C",V.DataTable.dtCompany(0).NAME_COMPANY!FieldValTrim,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",40,V.Local.sTemp)
		'Vendor Address
		F.Intrinsic.String.Concat(V.Local.sTemp,V.DataTable.dtCompany(0).ADDRESS1!FieldValTrim,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",70,V.Local.sTemp)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.DataTable.dtCompany(0).ADDRESS2!FieldValTrim,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",190,V.Local.sTemp)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.DataTable.dtCompany(0).CITY!FieldValTrim,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",210,V.Local.sTemp)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.DataTable.dtCompany(0).STATE!FieldValTrim,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",212,V.Local.sTemp)
		F.Intrinsic.String.Concat(V.Local.sTemp,V.DataTable.dtCompany(0).CODE_ZIP!FieldValTrim,V.Local.sTemp)
		F.Intrinsic.String.RPad(V.Local.sTemp," ",237,V.Local.sTemp)
		'Attention
		F.Intrinsic.String.Concat(V.Local.sTemp,V.DataTable.dtCompany(0).ATTENTION!FieldValTrim,V.Local.sTemp)
		'New Line
		F.Intrinsic.String.Concat(V.Local.sTempFull,V.Local.sTemp,V.Ambient.NewLine,V.Local.sTempFull)
	F.Intrinsic.Control.EndIf
	
	'--------------------------------------------------------------# Line #----------------------------------------------------------------
	'PO, Line,Part
	F.Intrinsic.String.Concat(V.Args.PO,V.Args.POLine,V.Args.Part,V.Local.sTemp)
	F.Intrinsic.String.RPad(V.Local.sTemp," ",30,V.Local.sTemp)
	'Loc
	F.Intrinsic.String.Concat(V.Local.sTemp,V.Args.Loc,V.Local.sTemp)
	F.Intrinsic.String.RPad(V.Local.sTemp," ",32,V.Local.sTemp)
	'Description
	F.Intrinsic.String.Concat(V.Local.sTemp,V.Args.Description.Trim,V.Local.sTemp)
	F.Intrinsic.String.RPad(V.Local.sTemp," ",62,V.Local.sTemp)
	'UM
	F.Intrinsic.String.Concat(V.Local.sTemp,V.Args.UM.Trim,V.Local.sTemp)
	F.Intrinsic.String.Rpad(V.Local.sTemp," ",65,V.Local.sTemp)
	'Work Order Number
	F.Intrinsic.String.Concat(V.Local.sTemp,"",V.Local.sTemp)
	F.Intrinsic.String.Rpad(V.Local.sTemp," ",71,V.Local.sTemp)
	'Work Order Sequence
	F.Intrinsic.String.Concat(V.Local.sTemp,"",V.Local.sTemp)
	F.Intrinsic.String.Rpad(V.Local.sTemp," ",77,V.Local.sTemp)
	'Requisition Number
	F.Intrinsic.Control.If(V.Args.ReqNo.Trim,=,"")
		F.Intrinsic.String.Concat(V.Local.sTemp,"      ",V.Local.sTemp)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Args.ReqNo,V.Local.sTemp)
	F.Intrinsic.Control.EndIf
	F.Intrinsic.String.Rpad(V.Local.sTemp," ",87,V.Local.sTemp)
	'Taxable
	F.Intrinsic.String.Concat(V.Local.sTemp,"",V.Local.sTemp)
	F.Intrinsic.String.RPad(V.Local.sTemp," ",100,V.Local.sTemp)
	'GL Account
	F.Intrinsic.String.Concat(V.Local.sTemp,"",V.Local.sTemp)
	F.Intrinsic.String.RPad(V.Local.sTemp," ",121,V.Local.sTemp)
	'PL
	F.Intrinsic.String.Concat(V.Local.sTemp,V.Args.PL.Trim,V.Local.sTemp)
	F.Intrinsic.String.RPad(V.Local.sTemp," ",124,V.Local.sTemp)
	'Required Date Line DueDate
	F.Intrinsic.String.Format(V.Args.DueDate,"MMDDYY",V.local.sPODueDate)
	F.Intrinsic.String.Concat(V.Local.sTemp,V.local.sPODueDate,V.Local.sTemp)
	F.Intrinsic.String.RPad(V.Local.sTemp," ",136,V.Local.sTemp)
	'Cost
	F.Intrinsic.String.Concat(V.Local.sTemp,V.Args.Cost,V.Local.sTemp)
	F.Intrinsic.String.RPad(V.Local.sTemp," ",168,V.Local.sTemp)
	'Qty
	F.Intrinsic.String.Concat(V.Local.sTemp,V.Args.Qty,V.Local.sTemp)
	F.Intrinsic.String.RPad(V.Local.sTemp," ",266,V.Local.sTemp)
	'Work Order Sequence
	F.Intrinsic.String.Concat(V.Local.sTemp,"",V.Local.sTemp)
	F.Intrinsic.String.Rpad(V.Local.sTemp," ",339,V.Local.sTemp)
	'Currency
	F.Intrinsic.String.Concat(V.Local.sTemp,V.Local.sCurrency,V.Local.sTemp)
	F.Intrinsic.String.RPad(V.Local.sTemp," ",548,V.Local.sTemp)
	'Requisition Line
	F.Intrinsic.Control.If(V.Args.ReqLine.Trim,=,"")
		F.Intrinsic.String.Concat(V.Local.sTemp,"   ",V.Local.sTemp)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat(V.Local.sTemp,V.Args.ReqLine,V.Local.sTemp)
	F.Intrinsic.Control.EndIf
	F.Intrinsic.String.Rpad(V.Local.sTemp," ",551,V.Local.sTemp)
	'Add line to variable that will be written to PURORDER.txt
	F.Intrinsic.String.Concat(V.Local.sTempFull,V.Local.sTemp,V.Ambient.NewLine,V.Local.sTempFull)
	
	'Return upload text
	F.Intrinsic.Variable.AddRV("POTEXT",V.Local.sTempFull)


	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GenerateGroupedPOs.End

Program.Sub.CheckCostOpt.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sRet.Declare
	
	F.Intrinsic.Control.BlockEvents
	F.Global.Registry.ReadValue(V.Caller.User,V.Caller.CompanyCode,"OCTSRS.NET.EXE",4936,2000,5,"",V.Local.sRet)
	Gui.frmPO.ddlCost.Text(V.Local.sRet)
	F.Intrinsic.Control.UnBlockEvents

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.CheckCostOpt.End

Program.Sub.SaveCostOpt.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"OCTSRS.NET.EXE",4936,2000,False,V.Screen.frmPO!ddlCost.Text,False,0,-999.0,1/1/1980,12:00:00 AM)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.SaveCostOpt.End

Program.Sub.CheckPOOpt.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sRet.Declare
	
	F.Intrinsic.Control.BlockEvents
	F.Global.Registry.ReadValue(V.Caller.User,V.Caller.CompanyCode,"OCTSRS.NET.EXE",4936,3000,5,"",V.Local.sRet)
	Gui.frmPO.ddlPOs.Text(V.Local.sRet)
	
	F.Intrinsic.Control.If(V.Local.sRet,=,"Individual POs")
		Gui.frmPO.ddlEmail.Enabled(False)
		Gui.frmPO.ddlEmail.Text("Do Not Email")
	F.Intrinsic.Control.Else
		Gui.frmPO.ddlEmail.Enabled(True)
		F.Intrinsic.Control.CallSub(CheckEmailOpt)
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.UnBlockEvents

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.CheckPOOpt.End

Program.Sub.SavePOOpt.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"OCTSRS.NET.EXE",4936,3000,False,V.Screen.frmPO!ddlPOs.Text,False,0,-999.0,1/1/1980,12:00:00 AM)
	F.Intrinsic.Control.CallSub(CheckPOOpt)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.SavePOOpt.End

Program.Sub.CheckEmailOpt.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sRet.Declare
	
	F.Intrinsic.Control.BlockEvents
	F.Global.Registry.ReadValue(V.Caller.User,V.Caller.CompanyCode,"OCTSRS.NET.EXE",4936,4000,5,"",V.Local.sRet)
	Gui.frmPO.ddlEmail.Text(V.Local.sRet)
	F.Intrinsic.Control.UnBlockEvents
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.CheckEmailOpt.End

Program.Sub.SaveEmailOpt.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"OCTSRS.NET.EXE",4936,4000,False,V.Screen.frmPO!ddlEmail.Text,False,0,-999.0,1/1/1980,12:00:00 AM)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.SaveEmailOpt.End

Program.Sub.GetVendors.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	v.Local.bVend.Declare(boolean,False)
	
	'Name_Vendor
	F.Data.Dictionary.CreateFromSQL("dVendorName","con","Select LTRIM(RTRIM(VENDOR)) AS VENDOR,RTrim(Name_Vendor) From V_Vendor_Master Where Vendor <> '' Order By Vendor;",20)
	F.Data.Dictionary.SetDefaultReturn("dVendorName","")
	
	'GL Acct
	F.Data.Dictionary.CreateFromSQL("dGLAcct","con","Select Product_Line,Purchasing_Account From V_Product_Line Where Product_Line <> '' Order by 1;")
	F.Data.Dictionary.SetDefaultReturn("dGLAcct","")
	
	f.Global.General.ReadOption("70000",0,v.Local.bVend,"0000",v.Local.bVend)
	'Vendors and cost
	F.Data.DataTable.CreateFromSQL("dtVendStat","con","Select Part+Location As PartLoc,Vendor,Date_Received,2 As Status From V_PO_History Where Part <> '' Union Select A.Part+A.Location As PartLoc,RTrim(B.Name_Vendor) As Vendor,Cast(DateAdd(Day,1,CurDate()) As Date) As Date_Received,1 As Status From Inventory_Mstr A Join Inventory_Mst2 B On A.Part = B.Part And A.Location = B.Location Where B.Name_Vendor <> '' Order By Status,PartLoc,Date_Received Desc;",True)
	 'changed this dictionary to pull part and name vendor from inventory master instead of history.
	F.Data.Dictionary.CreateFromSQL("dVendor","con","select part, LTRIM(RTRIM(name_vendor)) AS NAME_VENDOR from inventory_mst2 ORDER BY PART ASC",16)
	F.Data.Dictionary.SetDefaultReturn("dVendor","")
	
	'Status
	F.Data.Dictionary.CreateFromDataTable("dStatus","dtVendStat","PartLoc","Status")
	F.Data.Dictionary.SetDefaultReturn("dStatus",0)
	

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GetVendors.End

Program.Sub.SetPrefVendor.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.iRet.Declare
	V.Local.sGssPart.Declare
	V.Local.sMsg.Declare
	V.Local.sSQL.Declare
	
	F.Intrinsic.String.GSSPartString(V.Passed.000019,V.Passed.000020,V.Local.sGssPart)
	F.Intrinsic.String.Build("Set {0} ({1}) as the Preferred Vendor for {2}?",V.Passed.000012,V.Passed.000011,V.Local.sGssPart.Trim,V.Local.sMsg)
	F.Intrinsic.UI.Msgbox(V.Local.sMsg,"Set Preferred Vendor",4,V.Local.iRet)
	F.Intrinsic.Control.If(V.Local.iRet,=,6)
		'Save Preferred Vendor to Inventory_Mst2
		F.Intrinsic.String.Build("Update Inventory_Mst2 Set Name_Vendor = '{0}' Where Part = '{1}' And Location = '';",V.Passed.000011,V.Local.sGssPart,V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
		F.Intrinsic.UI.Msgbox("Preferred Vendor Updated","Set Preferred Vendor")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.SetPrefVendor.End

Program.Sub.cmdRefresh_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	F.Intrinsic.Control.CallSub(InvCheck)
	F.Intrinsic.Control.CallSub(InvCheckDrop)
	
	
	F.Intrinsic.Control.ExitSub
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.cmdRefresh_Click.End

Program.Sub.tabPO_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	Gui.frmPO.lblDemand.Caption("Demand")
	Gui.frmPO.lblVendQte.Caption("Vendor Quote")
	Gui.frmPO.lblSupply.Caption("Supply")
	
	F.Intrinsic.Control.If(V.DataTable.dtDemand.Exists)
		Gui.frmPO.GsGCDemand.ClearRows("gvDemand")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.If(V.DataTable.dtVendQteLines.Exists)
		Gui.frmPO.GsGCVendQte.ClearRows("gvVendQte")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.If(V.DataTable.dtGetVendQtes.Exists)
		F.Data.DataTable.DeleteRow("dtGetVendQtes")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.If(V.DataTable.dtSupply.Exists)
		Gui.frmPO.GsGCSupply.ClearRows("gvSupply")
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.ExitSub
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.tabPO_Click.End

Program.Sub.InvCheck.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sSQL.Declare
	V.Local.iCnt.Declare
	V.Local.fSum1.Declare
	V.Local.fSum2.Declare
	V.Local.fCurOnHand.Declare
	V.Local.fBalance.Declare
	V.Local.bDic.Declare
	V.Local.dCutoff.Declare
	v.Local.sDate.Declare

	F.Intrinsic.Control.If(V.DataTable.dtInvCheck.Exists)
		F.Data.DataTable.Close("dtInvCheck")
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.If(V.DataTable.dtDemand.Exists)
		Gui.frmPO.lblDemand.Caption("Demand")
		Gui.frmPO.GsGCDemand.ClearRows("gvDemand")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.If(V.DataTable.dtVendQteLines.Exists)
		Gui.frmPO.lblVendQte.Caption("Vendor Quote")
		Gui.frmPO.GsGCVendQte.ClearRows("gvVendQte")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.If(V.DataTable.dtSupply.Exists)
		Gui.frmPO.lblSupply.Caption("Supply")
		Gui.frmPO.GsGCSupply.ClearRows("gvSupply")
	F.Intrinsic.Control.EndIf
	
	Gui.frmPO.lblStatus.Caption("Loading Purchasing Plan ....")
	Gui.frmPO.lblStatus.Visible(True)
	Gui.frmPO.progBarStatus.Visible(True)
	V.Global.sPart.Set("")
	
	V.Local.dCutoff.Set(V.Screen.frmPO!dtpCutoff.Value)

	F.Data.DataTable.CreateFromSQL("dtInvCheck","con","SELECT A.PART+A.LOCATION AS PMAST,A.PART,A.LOCATION,A.DESCRIPTION,A.PRODUCT_LINE AS PL,A.CODE_SORT as SortCode,A.TIME_MATERIAL_LEAD AS LEADTIME,QTY_ORDER AS OrderQty,QTY_ONHAND as OnHandQty,QTY_ONORDER_PO as OnOrder, QTY_REORDER as ReOrderPt, UM_INVENTORY as UM, UM_PURCHASING as UMPurch, FACTOR_CONVERSION as Conversion, NAME_VENDOR as VendorName FROM V_INVENTORY_MSTR A JOIN V_INVENTORY_MST2 B ON A.PART = B.PART AND A.LOCATION = B.LOCATION WHERE B.CODE_SOURCE IN ('P') UNION SELECT A.PART+A.LOCATION AS PMAST,A.PART,A.LOCATION,A.DESCRIPTION,A.PRODUCT_LINE AS PL, A.CODE_SORT AS SortCode, A.TIME_MATERIAL_LEAD AS LEADTIME, A.QTY_ORDER as OrderQty,A.QTY_ONHAND as OnHandQty, A.QTY_ONORDER_PO as OnOrder,A.QTY_REORDER as ReOrderPt, A.UM_INVENTORY as UM,A.UM_PURCHASING as UMPurch, A.FACTOR_CONVERSION as Conversion, B.NAME_VENDOR as VendorName FROM V_INVENTORY_MSTR A JOIN V_INVENTORY_MST2 B ON A.PART = B.PART AND A.LOCATION = B.LOCATION JOIN V_INVENTORY_MST3 C ON A.PART = C.PART AND A.LOCATION = C.LOCATION WHERE C.TEMP_PURCH = 'Y' ORDER BY PMAST;",True)
	F.Data.DataTable.AddColumn("dtInvCheck","QTY_COMMITTED_WO",Float,0.0000)
	F.Data.DataTable.AddColumn("dtInvCheck","QTY_COMMITTED_SO",Float,0.0000)
	F.Data.DataTable.AddColumn("dtInvCheck","QTY_REQUIRED_MRP",Float,0.0000)
	f.Data.DataTable.AddColumn("dtInvCheck","Category","Boolean",True)

	'F.Data.DataTable.AddColumn("dtInvCheck","BALANCE",Float,0.0000)
	F.Data.DataTable.AddExpressionColumn("dtInvCheck","QTY_REQUIRED",Float,"QTY_COMMITTED_WO+QTY_COMMITTED_SO")
	
	F.Intrinsic.Control.If(V.Screen.frmPO!chkCutoff.Value,=,0)
		F.Data.Dictionary.CreateFromSQL("dicJobCom","con","SELECT PART+LOCATION AS PMAST,SUM(QTY_COMMITTED-QTY_ISSUED) AS QTY_COMMITTED FROM V_JOB_COMMITMENTS GROUP BY PMAST;")
		F.Data.Dictionary.SetDefaultReturn("dicJobCom",0.0000)
		F.Data.DataTable.FillFromDictionary("dtInvCheck","dicJobCom","PMAST","QTY_COMMITTED_WO")
		F.Data.Dictionary.Close("dicJobCom")
		
		F.Data.Dictionary.CreateFromSQL("dicSOCom","con","SELECT PART+LOCATION AS PMAST,SUM(QTY_BO) AS QTY_COMMITTED FROM V_ORDER_LINES GROUP BY PMAST;")
		F.Data.Dictionary.SetDefaultReturn("dicSOCom",0.0000)
		F.Data.DataTable.FillFromDictionary("dtInvCheck","dicSOCom","PMAST","QTY_COMMITTED_SO")
		F.Data.Dictionary.Close("dicSOCom")
		
		F.Data.Dictionary.CreateFromSQL("dicMrp","con","SELECT PART+LOCATION AS PMAST, SUM(Supply) AS QTY_REQ FROM MRP_PLANNING WHERE JOB IS NULL AND PURCHASE_ORDER IS NULL AND ENTRYTYPE IN ('P') GROUP BY PMAST;")
		F.Data.Dictionary.SetDefaultReturn("dicMrp",0.0000)
		f.Data.DataTable.FillFromDictionary("dtInvCheck","dicMrp","PMAST","QTY_REQUIRED_MRP")
		F.Data.Dictionary.Close("dicMrp")
		
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Build("SELECT A.PART+A.LOCATION AS PMAST,SUM(QTY_COMMITTED-QTY_ISSUED) AS QTY_COMMITTED FROM V_JOB_COMMITMENTS A JOIN V_INVENTORY_MSTR B ON A.PART = B.PART AND A.LOCATION = B.LOCATION WHERE DATEADD(DAY,-TIME_MATERIAL_LEAD,A.DATE_DUE) <= '{0}' GROUP BY PMAST;",V.Local.dCutoff.PervasiveDate,V.Local.sSQL)
		F.Data.Dictionary.CreateFromSQL("dicJobCom","con",V.Local.sSQL)
		F.Data.Dictionary.SetDefaultReturn("dicJobCom",0.0000)
		F.Data.DataTable.FillFromDictionary("dtInvCheck","dicJobCom","PMAST","QTY_COMMITTED_WO")
		F.Data.Dictionary.Close("dicJobCom")
		
		F.Intrinsic.String.Build("SELECT A.PART+A.LOCATION AS PMAST,SUM(QTY_BO) AS QTY_COMMITTED FROM V_ORDER_LINES A JOIN V_INVENTORY_MSTR B ON A.PART = B.PART AND A.LOCATION = B.LOCATION WHERE DATEADD(DAY,-TIME_MATERIAL_LEAD,A.DATE_ITEM_PROM) <= '{0}' GROUP BY PMAST;",V.Local.dCutoff.PervasiveDate,V.Local.sSQL)
		F.Data.Dictionary.CreateFromSQL("dicSOCom","con",V.Local.sSQL)
		F.Data.Dictionary.SetDefaultReturn("dicSOCom",0.0000)
		F.Data.DataTable.FillFromDictionary("dtInvCheck","dicSOCom","PMAST","QTY_COMMITTED_SO")
		F.Data.Dictionary.Close("dicSOCom")
		'CONCAT(RTRIM(LTRIM(PART)),LOCATION) AS PMAST,
		f.Intrinsic.String.Build("SELECT DISTINCT PART+LOCATION AS PMAST, SUM(Supply) AS QTY_REQ FROM MRP_PLANNING WHERE JOB IS NULL AND PURCHASE_ORDER IS NULL AND ENTRYTYPE IN ('P') AND DateStart <= '{0}' GROUP BY PMAST;",v.Local.dCutoff.PervasiveDate,v.local.sSQL)

		
		f.Data.Dictionary.CreateFromSQL("dicMrp","con",v.Local.sSQL)
		F.Data.Dictionary.SetDefaultReturn("dicMrp",0.0000)
		f.Data.DataTable.FillFromDictionary("dtInvCheck","dicMrp","PMAST","QTY_REQUIRED_MRP")
		F.Data.Dictionary.Close("dicMrp")
		
	F.Intrinsic.Control.EndIf

	
	'Use a dictionary to flag everything that is not a phantom part
	F.Data.Dictionary.CreateFromSQL("dicCategory","con","SELECT DISTINCT PART+LOCATION AS PMAST, CAST(0 AS BIT) AS KEEP FROM MRP_PLANNING WHERE CATEGORY = 'P'")
	F.Data.Dictionary.SetDefaultReturn("dicCategory",True)
	f.Data.DataTable.FillFromDictionary("dtInvCheck","dicCategory","PMAST","Category")
	F.Data.Dictionary.Close("dicCategory")
	
	f.Data.DataTable.AddExpressionColumn("dtInvCheck","CurOnHand","FLOAT","OnHandQty + OnOrder")
	f.Data.DataTable.AddExpressionColumn("dtInvCheck","BALANCE","Float","CurOnHand - (QTY_COMMITTED_WO + OrderQty + IIF(QTY_COMMITTED_SO > QTY_REQUIRED_MRP,QTY_COMMITTED_SO,QTY_REQUIRED_MRP))")
	'"CurOnHand - (QTY_COMMITTED_WO + QTY_COMMITTED_SO + QTY_REORDER + QTY_REQUIRED_MRP)"

	'this is the list of parts to loop through
	'F.Data.DataView.Create("dtInvCheck","dvInvCheck",22,"CATEGORY = TRUE AND (BALANCE < 0 OR (QTY_REQUIRED_MRP > 0 AND BALANCE = 0))","")
	F.Data.DataView.Create("dtInvCheck","dvInvCheck",22,"CATEGORY = TRUE AND QTY_REQUIRED_MRP > 0","")

	f.Intrinsic.Control.CallSub(LoadMRP_New)
	F.Intrinsic.Control.CallSub(LoadPOs)

	F.Intrinsic.Control.ExitSub
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.InvCheck.End

Program.Sub.LoadMRP_New.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	'dtWO0
	f.Data.DataTable.AddExpressionColumn("dtInvCheck","Purchase","Float","QTY_REQUIRED_MRP")
		'Add Columns
	'Add Columns
	F.Data.DataTable.AddColumn("dtInvCheck","BIN",String)
	F.Data.DataTable.AddColumn("dtInvCheck","PurchaseDate",Date)
	F.Data.DataTable.AddColumn("dtInvCheck","DATE_DUE",Date)
	F.Data.DataTable.AddColumn("dtInvCheck","POHistory",String,"History")
	F.Data.DataTable.AddColumn("dtInvCheck","Select",Boolean,False)
	F.Data.DataTable.AddColumn("dtInvCheck","Cost",Float,0)
	
	F.Intrinsic.Control.If(V.DataTable.dtPO0.Exists)
		F.Data.DataTable.Close("dtPO0")
	F.Intrinsic.Control.EndIf
	
	f.Data.DataView.ToDataTable("dtInvCheck","dvInvCheck","dtPO0",True)
	
	F.Intrinsic.Control.ExitSub
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadMRP_New.End

Program.Sub.LoadPOs.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.iCnt.Declare
	V.Local.fLeadTime.Declare
	V.Local.dDateDue.Declare
	V.Local.dDatePurch.Declare
	V.Local.sDatePurch.Declare
	V.Local.fQtyPurch.Declare
	V.Local.iCnt2.Declare
	V.Local.sSelect.Declare
	V.Local.sFilter.Declare
	V.Local.sPart.Declare
	v.Local.sSql.Declare
	v.Local.sSql2.Declare
	v.Local.sRet.Declare
	v.Local.dCutoff.Declare
	v.Local.sFields.Declare
	v.Local.sTypes.Declare

	F.Intrinsic.Control.If(V.DataTable.dtPO.Exists)
		F.Data.DataTable.Close("dtPO")
	F.Intrinsic.Control.EndIf

	'Create a Key Column
	F.Data.DataTable.AddExpressionColumn("dtPO0","PartLoc",String,"[PART]+[LOCATION]")
	'Load Vendors
	F.Data.DataTable.AddColumn("dtPO0","Vendor",String,"")
	F.Data.DataTable.FillFromDictionary("dtPO0","dVendor","Part","Vendor")
	'Preferred Vendor Names
	F.Data.DataTable.FillFromDictionary("dtPO0","dVendorName","Vendor","VendorName")
	'GL Account
	F.Data.DataTable.AddColumn("dtPO0","GLAcct",String,"")
	F.Data.DataTable.FillFromDictionary("dtPO0","dGLAcct","PL","GLAcct")
	'Status
	F.Data.DataTable.AddColumn("dtPO0","Status",Long,0)
	F.Data.DataTable.FillFromDictionary("dtPO0","dStatus","PartLoc","Status")

	f.Data.DataTable.CreateFromSQL("DATES","CON","SELECT PART+LOCATION AS PMAST, DATESTART, DATEDUE FROM MRP_PLANNING WHERE ENTRYTYPE IN ('P') AND SUPPLY > 0 AND PURCHASE_ORDER IS NULL ORDER BY DATESTART ASC",True)
	
	F.Data.Dictionary.CreateFromDatatable("startdate","dates","PMAST","DATESTART",4)
	F.Data.Dictionary.SetDefaultReturn("STARTDATE",V.Ambient.Date)
	F.Data.Dictionary.CreateFromDatatable("duedate","dates","PMAST","DATEDUE")
	F.Data.Dictionary.SetDefaultReturn("duedate",v.Ambient.Date)
	
	'set the values in the dtPO table
	f.Data.DataTable.FillFromDictionary("dtPO0","startdate","PartLoc","PurchaseDate")
	f.Data.DataTable.FillFromDictionary("dtPO0","duedate","PartLoc","DATE_DUE")
	f.Data.Dictionary.Close("startdate")
	f.Data.Dictionary.Close("duedate")



	'Group Parts together
	F.Data.DataView.Create("dtPO0","dvGroup")
	F.Data.DataView.ToDataTableDistinct("dtPO0","dvGroup","dtPO","Select*!*PARTLOC*!*PART*!*LOCATION*!*DESCRIPTION*!*BIN*!*Vendor*!*VendorName*!*PL*!*SortCode*!*LEADTIME*!*PurchaseDate*!*DATE_DUE*!*OrderQty*!*CurOnHand*!*OnHandQty*!*OnOrder*!*ReOrderPt*!*Purchase*!*UM*!*UMPurch*!*Conversion*!*Cost*!*POHistory*!*GLAcct*!*Status",True)

	'set earliest start date
	Gui.frmPO.progBarStatus.Min(0)
	F.Intrinsic.Control.If(v.DataTable.dtPO.RowCount,<>,0)
		f.Intrinsic.Math.Mult(v.DataTable.dtPO.RowCount,2,v.Global.iLoop)
		Gui.frmPO.progBarStatus.Max(v.Global.iLoop)
	F.Intrinsic.Control.Else
		Gui.frmPO.progBarStatus.Max(100)
	F.Intrinsic.Control.EndIf

	f.Intrinsic.Math.Mult(v.Global.iLoop,.2,v.Local.iCnt)
	gui.frmPO.progBarStatus.value(v.Local.iCnt)
	
'	f.Data.DataTable.CreateFromSQL("DATES","CON","SELECT PART+LOCATION AS PMAST, DATESTART, DATEDUE FROM MRP_PLANNING WHERE ENTRYTYPE IN ('P') AND SUPPLY > 0 AND PURCHASE_ORDER IS NULL ORDER BY DATESTART ASC",True)
'	
'	F.Data.Dictionary.CreateFromDatatable("startdate","dates","PMAST","DATESTART",4)
'	F.Data.Dictionary.SetDefaultReturn("STARTDATE",V.Ambient.Date)
'	F.Data.Dictionary.CreateFromDatatable("duedate","dates","PMAST","DATEDUE")
'	F.Data.Dictionary.SetDefaultReturn("duedate",v.Ambient.Date)
'	
'	'set the values in the dtPO table
'	f.Data.DataTable.FillFromDictionary("dtPO","startdate","PartLoc","PurchaseDate")
'	f.Data.DataTable.FillFromDictionary("dtPO","duedate","PartLoc","DATE_DUE")
'	f.Data.Dictionary.Close("startdate")
'	f.Data.Dictionary.Close("duedate")
	
'	'Set Purchase Date
'	f.Intrinsic.Control.For(v.Local.iCnt,0,v.DataTable.dtPO.RowCount--,1)
'		Gui.frmPO.progBarStatus.Value(V.Local.iCnt)
'		F.Intrinsic.String.Build("SELECT TOP 1 DateStart, DateDue from MRP_Planning where part = '{0}' AND ENTRYTYPE IN ('P') AND SUPPLY > 0 AND PURCHASE_ORDER IS NULL ORDER BY DATESTART ASC",v.DataTable.dtPO(V.Local.iCnt).PART!FIELDVALTRIM,V.Local.sSql)
'		F.ODBC.Connection!con.executeandreturn(v.Local.sSql,v.Local.sRet)
'		f.Intrinsic.Control.If(v.Local.sRet.IsNotNullOrWhiteSpace)
'			f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
'			f.Intrinsic.String.Format(v.Local.sRet(0),"MM/DD/YYYY",V.Local.dDatePurch)
'			f.Intrinsic.String.Format(v.Local.sRet(1),"MM/DD/YYYY",v.Local.dDateDue)
'			f.Data.DataTable.SetValue("dtPO",v.Local.iCnt,"PurchaseDate",v.Local.dDatePurch,"DATE_DUE",V.Local.dDateDue)
'		f.Intrinsic.Control.Else
'			f.Data.DataTable.SetValue("dtPO",v.local.iCnt,"PurchaseDate",v.Ambient.Date,"DATE_DUE",V.Ambient.Date)
'		f.Intrinsic.Control.EndIf
'	f.Intrinsic.Control.Next(v.Local.iCnt)
'	v.Global.iLoop.Set(v.Local.iCnt)
	
	F.Intrinsic.Control.If(V.Screen.frmPO!chkCutoff.Value,=,0)
		v.Local.sSql.set("SELECT PART, LOCATION, FID, CAST(0 AS BIT) AS KEEP, TypeDesc, SUPPLY as QUANTITY, DateStart, DateDue as DATE_DUE, PID, CAST(0 AS DOUBLE) AS RUNQTY from MRP_PLANNING where EntryType = 'P' and SUPPLY > 0 and (category <> 'P' or category is null) and purchase_order is null")
		v.Local.sSql2.Set("select PART, LOCATION, FID, DEMAND AS QUANTITY, DATESTART, ENTRYTYPE, TYPEDESC, substring(REFERENCE,3,20) as reference, PID from mrp_planning where demand > 0 and entrytype = '9'  AND (category <> 'P' or category is null) and purchase_order is nullORDER BY DATESTART ASC")
	F.Intrinsic.Control.Else
		V.Local.dCutoff.Set(V.Screen.frmPO!dtpCutoff.Value)
		F.Intrinsic.String.Build("SELECT PART, LOCATION, FID, CAST(0 AS BIT) AS KEEP, TypeDesc, SUPPLY as QUANTITY, DateStart, DateDue as DATE_DUE, PID, CAST(0 AS DOUBLE) AS RUNQTY from MRP_PLANNING WHERE DateStart <= '{0}' AND EntryType = 'P' and SUPPLY > 0 and (category <> 'P' or category is null) and purchase_order is null",v.Local.dCutoff.PervasiveDate,v.Local.sSql)
		F.Intrinsic.String.Build("select PART, LOCATION, FID, DEMAND AS QUANTITY, DATESTART, ENTRYTYPE, TYPEDESC, substring(REFERENCE,3,20) as reference, PID from mrp_planning where DateStart <= '{0}' AND demand > 0 and entrytype = '9'  AND (category <> 'P' or category is null) and purchase_order is nullORDER BY DATESTART ASC",V.Local.dCutoff.PervasiveDate,v.Local.sSql2)
	F.Intrinsic.Control.EndIf
	
	
	F.Data.DataTable.CreateFromSQL("dtMRPTemp","con",V.Local.sSQL,True)
	'F.Data.DataTable.CreateFromSQL("dtDemand","con",v.Local.sSql2,True)
			'---------------------------add default BIN dictionary
	'Inventory master default BIN
	f.Data.Dictionary.CreateFromSQL("dBin","con","select part+location as PartLoc, bin from v_inventory_mstr",16)
	f.Data.Dictionary.SetDefaultReturn("dBin","")
	F.Data.DataTable.FillFromDictionary("dtPO","dBin","PARTLOC","BIN")
	F.Data.Dictionary.Close("dBin")
	
	'rebuild the table from a string because some columns are read only (expression columns) and we will need to edit them later.
	f.Data.DataView.Create("dtPO","dvPO",22)
	V.Local.sFields.Set(V.DataTable.dtPO.FieldNames)
	

	V.Local.sTypes.Set("BOOLEAN*!*STRING*!*STRING*!*STRING*!*STRING*!*STRING*!*STRING*!*STRING*!*STRING*!*STRING*!*LONG*!*DATE*!*DATE*!*FLOAT*!*FLOAT*!*FLOAT*!*FLOAT*!*FLOAT*!*FLOAT*!*STRING*!*STRING*!*STRING*!*FLOAT*!*STRING*!*STRING*!*LONG")
	f.Data.DataView.ToString("dtPO","dvPO",v.Local.sFields,"*!*","@!@",v.Local.sSelect)
	f.Data.DataTable.Close("dtPO")
	f.Data.DataTable.CreateFromString("dtPO",v.Local.sSelect,v.Local.sFields,v.Local.sTypes,"*!*","@!@",True)	
	
	'Create a dictionary of the parent rows so we can filter the child rows ..... this will ensure the relationship can be created.
	f.Data.Dictionary.createfromdatatable("dicParents","dtPO","PART","Purchase",20)
	F.Data.Dictionary.SetDefaultReturn("dicParents",-1)
	f.Data.DataTable.FillFromDictionary("dtMRPTemp","dicParents","PART","RUNQTY")
	f.Data.Dictionary.Close("dicParents")
	f.Data.DataView.Create("dtMRPTemp","dvMRPTemp",22,"RUNQTY > -1","")
	F.Data.DataView.ToDataTable("dtMRPTemp","dvMRPTemp","dtPO$dtMRP",True)
	f.Data.DataTable.RemoveColumn("dtPO$dtMRP","RUNQTY")
	f.Data.DataTable.Close("dtMRPTemp")
	
		'Remove Key Column
	F.Data.DataTable.RemoveColumn("dtPO","PartLoc")
	
	f.Intrinsic.Math.Mult(v.Global.iLoop,.4,v.Local.iCnt)
	gui.frmPO.progBarStatus.Value(v.Local.iCnt)
	
	F.Intrinsic.Control.CallSub(LoadGVPO)
	
	F.Intrinsic.Control.ExitSub
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadPOs.End

Program.Sub.LoadGVPO.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.iCnt.Declare
	V.Local.iNext.Declare
	V.Local.sPart.Declare
	V.Local.sLoc.Declare
	V.Local.sNextPart.Declare
	V.Local.sNextLoc.Declare
	V.Local.sColor.Declare
	V.Local.sValues.Declare
	V.Local.sFilter.Declare
	
	F.Intrinsic.Control.If(V.Global.bCustom)
		f.Data.DataTable.AddColumn("dtPO","BUYERID","STRING")
		F.Data.DataTable.FillFromDictionary("dtPO","BUYERID","PART","BUYERID")
	F.Intrinsic.Control.EndIf
	
	f.Data.DataView.Create("dtPO","dvPO",22)
	Gui.frmPO.GsGCPO.AddGridViewFromDataView("gvPO","dtPO","dvPO")
	Gui.frmPO.GsGCPO.SuspendLayout()
	Gui.frmPO.GsGCPO.SetGridViewProperty("gvPO","MultiSelect",True)
	Gui.frmPO.GsGCPO.SetGridViewProperty("gvPO","AllowSort",True)
	Gui.frmPO.GsGCPO.SetGridViewProperty("gvPO","AllowFilter",True)
	Gui.frmPO.GsGCPO.SetGridViewProperty("gvPO","ShowGroupPanel",True)
	Gui.frmPO.GsGCPO.SetGridViewProperty("gvPO","Enableappearanceoddrow",True)
	'Gui.frmPO.GsGCPO.SetGridViewProperty("gvPO","Enableappearanceevenrow",True)
	
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Vendor","Visible",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","GLAcct","Visible",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Status","Visible",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","CurOnHand","Visible",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","BUYERID","Visible",False)
	
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","POHistory","ShowCaption",False)
	
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Select","VisibleIndex","0")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PART","VisibleIndex","1")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LOCATION","VisibleIndex","2")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DESCRIPTION","VisibleIndex","3")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","BIN","VisibleIndex","4")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","VendorName","VisibleIndex","5")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PL","VisibleIndex","6")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","SortCode","VisibleIndex","7")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LEADTIME","VisibleIndex","8")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OrderQty","VisibleIndex","9")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnHandQty","VisibleIndex","10")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnOrder","VisibleIndex","11")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","ReOrderPt","VisibleIndex","12")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UM","VisibleIndex","13")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UMPurch","VisibleIndex","14")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Conversion","VisibleIndex","15")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PURCHASEDATE","VisibleIndex","16")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DATE_DUE","VisibleIndex","17")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Cost","VisibleIndex","18")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Purchase","VisibleIndex","19")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","POHistory","VisibleIndex","20")

	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Select","Caption","Select")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PART","Caption","Part")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LOCATION","Caption","Loc")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DESCRIPTION","Caption","Description")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","VendorName","Caption","Preferred Vendor")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PL","Caption","PL")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","BIN","Caption","BIN")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","SortCode","Caption","Sort Code")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LEADTIME","Caption","Lead Time")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OrderQty","Caption","Order Qty")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnHandQty","Caption","On Hand Qty")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnOrder","Caption","On Order")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","ReOrderPt","Caption","Safety Stock")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UM","Caption","UM")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UMPurch","Caption","UM Purch")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Conversion","Caption","Conversion")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PURCHASEDATE","Caption","Purch. Date")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DATE_DUE","Caption","Due Date")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Cost","Caption","Cost")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Purchase","Caption","PO Quantity")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","POHistory","Caption","PO History")

	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Select","MinWidth","50")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PART","MinWidth","140")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LOCATION","MinWidth","40")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DESCRIPTION","MinWidth","200")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","VendorName","MinWidth","200")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PL","MinWidth","35")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","BIN","MinWidth","45")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","SortCode","MinWidth","90")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LEADTIME","MinWidth","65")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OrderQty","MinWidth","85")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnHandQty","MinWidth","85")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnOrder","MinWidth","85")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","ReOrderPt","MinWidth","85")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UM","MinWidth","55")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UMPurch","MinWidth","70")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Conversion","MinWidth","85")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PURCHASEDATE","MinWidth","85")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DATE_DUE","MinWidth","85")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Cost","MinWidth","85")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Purchase","MinWidth","85")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","POHistory","MinWidth","60")
	
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Select","AllowEdit",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PART","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LOCATION","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DESCRIPTION","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Vendor","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","VendorName","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PL","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","BIN","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","SortCode","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LEADTIME","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OrderQty","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnHandQty","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnOrder","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","ReOrderPt","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UM","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UMPurch","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Conversion","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PURCHASEDATE","AllowEdit",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DATE_DUE","AllowEdit",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Cost","AllowEdit",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Purchase","AllowEdit",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","POHistory","AllowEdit",False)

	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Select","ReadOnly",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DATE_DUE","ReadOnly",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Cost","ReadOnly",False)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Purchase","ReadOnly",False)

	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Select","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PART","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LOCATION","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DESCRIPTION","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","VendorName","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PL","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","BIN","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","SortCode","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LEADTIME","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OrderQty","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnHandQty","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnOrder","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","ReOrderPt","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UM","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UMPurch","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Conversion","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PURCHASEDATE","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DATE_DUE","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Cost","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Purchase","HeaderFontBold",True)
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","POHistory","HeaderFontBold",True)
	
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Select","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PART","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LOCATION","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DESCRIPTION","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","VendorName","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PL","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","BIN","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","SortCode","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LEADTIME","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OrderQty","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnHandQty","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnOrder","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","ReOrderPt","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UM","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UMPurch","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Conversion","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PURCHASEDATE","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DATE_DUE","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Cost","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Purchase","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","POHistory","HeaderHAlignment","Center")
	
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Select","CellHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LOCATION","CellHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","VendorName","CellHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PL","CellHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","SortCode","CellHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LEADTIME","CellHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UM","CellHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","UMPurch","CellHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Conversion","CellHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PURCHASEDATE","CellHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DATE_DUE","CellHAlignment","Center")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","POHistory","CellHAlignment","Center")
	
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PART","CellForeColor","Blue")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","LOCATION","CellForeColor","Blue")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DESCRIPTION","CellForeColor","Blue")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","VendorName","CellForeColor","Blue")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","POHistory","CellForeColor","White")

	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DATE_DUE","CellBackColor","LightYellow")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Cost","CellBackColor","LightYellow")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Purchase","CellBackColor","LightYellow")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","POHistory","CellBackColor","Gray")

	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OrderQty","DisplayCustomNumeric","#,###,###,##0.00##")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnHandQty","DisplayCustomNumeric","#,###,###,##0.00##")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","OnOrder","DisplayCustomNumeric","#,###,###,##0.00##")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","ReOrderPt","DisplayCustomNumeric","#,###,###,##0.00##")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Conversion","DisplayCustomNumeric","#,###,###,##0.00##")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Cost","DisplayCustomNumeric","#,###,###,##0.00##")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","Purchase","DisplayCustomNumeric","#,###,###,##0.00##")

	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","PURCHASEDATE","DisplayCustomDatetime","d")
	Gui.frmPO.GsGCPO.SetColumnProperty("gvPO","DATE_DUE","DisplayCustomDatetime","d")
	
	Gui.frmPO.GsGCPO.AddSummaryItem("gvPO","PART","PART","Count","","",n)

'	f.Data.DataTable.Clone("dtMRP","dtPO$dtMRP",True)
'	f.Data.DataTable.Merge("dtMRP","dtPO$dtMRP",True,2)

	F.Data.DataView.Create("dtPO$dtMRP","dvPO$dvMRP",22,"","DATESTART ASC")
	'F.Data.DataView.ToDataTable("dtPO$dtMRP","dvPO$dvMRP","dtSupply")
	
	
	f.Intrinsic.Math.Mult(v.Global.iLoop,.5,v.Local.iCnt)
	gui.frmPO.progBarStatus.Value(v.Local.iCnt)
	
	'F.Intrinsic.Control.CallSub(LoadCost)

	f.Data.DataTable.AddRelation("dtPO","PART*!*LOCATION","dtPO$dtMRP","PART*!*LOCATION","dtPO$dtMRP")
	
	gui.frmPO.GsGCPO.AddGridviewFromDataView("gvMRPChild","dtPO","dvPO$dvMRP")
	
	f.Intrinsic.Control.CallSub(format_MRPChild_grid)
	
	
	f.Intrinsic.Control.If(v.Global.bCustom)
		F.Data.Dictionary.ReturnKeyFromValue("BUYER",V.Screen.frmPO!ddlBuyer.TEXT,V.Local.sFilter)
		F.Intrinsic.String.Build("BUYERID = '{0}'",v.Local.sFilter,v.Local.sFilter)
		f.Data.DataView.SetFilter("dtPO","dvPO",v.Local.sFilter)
			f.Intrinsic.Control.If(v.DataView.dtPO!dvPO.RowCount,=,0)
				f.Intrinsic.UI.Msgbox("No action items for current user","Auto Work Order")
			f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf

	
	Gui.frmPO.GsGCPO.MainView("gvPO")
	Gui.frmPO.GsGCPO.ResumeLayout()
	
	Gui.frmPO.lblStatus.Visible(False)
	Gui.frmPO.progBarStatus.Visible(False)
	
	F.Intrinsic.Control.ExitSub
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadGVPO.End

Program.Sub.InvCheckDrop.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sSQL.Declare
	V.Local.iCnt.Declare
	V.Local.fSum1.Declare
	V.Local.fSum2.Declare
	V.Local.fCurOnHand.Declare
	V.Local.fBalance.Declare
	V.Local.bDic.Declare
	V.Local.dCutoff.Declare

	F.Intrinsic.Control.If(V.DataTable.dtPODrop.Exists)
		F.Data.DataTable.Close("dtPODrop")
	F.Intrinsic.Control.EndIf

	Gui.frmPO.lblStatus.Caption("Loading Drop Ship POs....")
	Gui.frmPO.lblStatus.Visible(True)
	Gui.frmPO.progBarStatus.Visible(True)
	V.Global.sPart.Set("")
	
	V.Local.dCutoff.Set(V.Screen.frmPO!dtpCutoff.Value)
	
	F.Intrinsic.Control.If(V.Screen.frmPO!chkCutoff.Value,=,0)
		F.Data.DataTable.CreateFromSQL("dtPODrop","con","SELECT B.PART,B.LOCATION,B.DESCRIPTION,RTRIM(C.NAME_VENDOR) AS VENDOR,B.PRODUCT_LINE AS PL,B.CODE_SORT AS SORTCODE,B.TIME_MATERIAL_LEAD AS LEADTIME,B.QTY_ORDER AS ORDERQTY,B.QTY_ONHAND AS ONHANDQTY,B.QTY_ONORDER_PO AS ONORDER,B.QTY_REORDER AS REORDERPT,B.UM_INVENTORY AS UM,B.UM_PURCHASING AS UMPURCH,B.FACTOR_CONVERSION AS CONVERSION,A.ORDER_NO,LEFT(A.RECORD_NO,3) AS RECORD_NO,A.DATE_ITEM_PROM AS DATE_DUE,DATEADD(DAY,(B.TIME_MATERIAL_LEAD*-1),A.DATE_ITEM_PROM) AS PURCHASEDATE,A.QTY_BO AS PURCHASE FROM V_ORDER_LINES A JOIN V_INVENTORY_MSTR B ON A.PART = B.PART AND A.LOCATION = B.LOCATION JOIN V_INVENTORY_MST2 C ON A.PART = C.PART AND A.LOCATION = C.LOCATION LEFT JOIN V_PO_DROP_SHIP D ON A.ORDER_NO = D.ORDER_NO AND A.RECORD_NO = D.ORDER_LINE WHERE A.LINE_TYPE = 'D' AND D.PO IS NULL AND C.CODE_SOURCE IN ('P','J');",True)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Build("SELECT B.PART,B.LOCATION,B.DESCRIPTION,RTRIM(C.NAME_VENDOR) AS VENDOR,B.PRODUCT_LINE AS PL,B.CODE_SORT AS SORTCODE,B.TIME_MATERIAL_LEAD AS LEADTIME,B.QTY_ORDER AS ORDERQTY,B.QTY_ONHAND AS ONHANDQTY,B.QTY_ONORDER_PO AS ONORDER,B.QTY_REORDER AS REORDERPT,B.UM_INVENTORY AS UM,B.UM_PURCHASING AS UMPURCH,B.FACTOR_CONVERSION AS CONVERSION,A.ORDER_NO,LEFT(A.RECORD_NO,3) AS RECORD_NO,A.DATE_ITEM_PROM AS DATE_DUE,DATEADD(DAY,(B.TIME_MATERIAL_LEAD*-1),A.DATE_ITEM_PROM) AS PURCHASEDATE,A.QTY_BO AS PURCHASE FROM V_ORDER_LINES A JOIN V_INVENTORY_MSTR B ON A.PART = B.PART AND A.LOCATION = B.LOCATION JOIN V_INVENTORY_MST2 C ON A.PART = C.PART AND A.LOCATION = C.LOCATION LEFT JOIN V_PO_DROP_SHIP D ON A.ORDER_NO = D.ORDER_NO AND A.RECORD_NO = D.ORDER_LINE WHERE A.LINE_TYPE = 'D' AND D.PO IS NULL AND C.CODE_SOURCE IN ('P','J') AND A.DATE_ITEM_PROM <= '{0}';",V.Local.dCutoff.PervasiveDate,V.Local.sSQL)
		F.Data.DataTable.CreateFromSQL("dtPODrop","con",V.Local.sSQL,True)
	F.Intrinsic.Control.EndIf
	
	F.Data.DataTable.AddColumn("dtPODrop","Select",Boolean,False)
	F.Data.DataTable.AddColumn("dtPODrop","VendorName",String,"")
	F.Data.DataTable.AddColumn("dtPODrop","Cost",Float,0)
	F.Data.DataTable.AddColumn("dtPODrop","POHistory",String,"History")
	F.Data.DataTable.AddColumn("dtPODrop","GLAcct",String,"")
	
	F.Data.DataTable.FillFromDictionary("dtPODrop","dVendorName","Vendor","VendorName")
	F.Data.DataTable.FillFromDictionary("dtPODrop","dGLAcct","PL","GLAcct")

	F.Intrinsic.Control.CallSub(LoadGvPODrop)
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.InvCheckDrop.End

Program.Sub.LoadGvPODrop.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.iCnt.Declare
	V.Local.iNext.Declare
	V.Local.sPart.Declare
	V.Local.sLoc.Declare
	V.Local.sNextPart.Declare
	V.Local.sNextLoc.Declare
	V.Local.sColor.Declare
	V.Local.sValues.Declare

	Gui.frmPO.GsGCPODrop.AddGridViewFromDataTable("gvPODrop","dtPODrop")
	Gui.frmPO.GsGCPODrop.SuspendLayout()
	Gui.frmPO.GsGCPODrop.SetGridViewProperty("gvPODrop","MultiSelect",True)
	Gui.frmPO.GsGCPODrop.SetGridViewProperty("gvPODrop","AllowSort",True)
	Gui.frmPO.GsGCPODrop.SetGridViewProperty("gvPODrop","AllowFilter",True)
	Gui.frmPO.GsGCPODrop.SetGridViewProperty("gvPODrop","ShowGroupPanel",True)
	Gui.frmPO.GsGCPODrop.SetGridViewProperty("gvPODrop","Enableappearanceoddrow",True)
	
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Select","Visible",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Vendor","Visible",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","GLAcct","Visible",False)
	
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","POHistory","ShowCaption",False)
	
'	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Select","VisibleIndex","0")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PART","VisibleIndex","1")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LOCATION","VisibleIndex","2")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DESCRIPTION","VisibleIndex","3")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ORDER_NO","VisibleIndex","4")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","RECORD_NO","VisibleIndex","5")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","VendorName","VisibleIndex","6")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PL","VisibleIndex","7")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","SortCode","VisibleIndex","8")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LEADTIME","VisibleIndex","9")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OrderQty","VisibleIndex","10")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnHandQty","VisibleIndex","11")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnOrder","VisibleIndex","13")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ReOrderPt","VisibleIndex","14")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UM","VisibleIndex","15")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UMPurch","VisibleIndex","16")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Conversion","VisibleIndex","17")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PURCHASEDATE","VisibleIndex","18")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DATE_DUE","VisibleIndex","19")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Cost","VisibleIndex","20")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Purchase","VisibleIndex","21")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","POHistory","VisibleIndex","22")

	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Select","Caption","Select")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PART","Caption","Part")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LOCATION","Caption","Loc")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DESCRIPTION","Caption","Description")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","VendorName","Caption","Preferred Vendor")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PL","Caption","PL")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","SortCode","Caption","Sort Code")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LEADTIME","Caption","Lead Time")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OrderQty","Caption","Order Qty")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnHandQty","Caption","On Hand Qty")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnOrder","Caption","On Order")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ReOrderPt","Caption","ReOrder Pt")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UM","Caption","UM")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UMPurch","Caption","UM Purch")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Conversion","Caption","Conversion")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PURCHASEDATE","Caption","Purch. Date")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DATE_DUE","Caption","Due Date")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Cost","Caption","Cost")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Purchase","Caption","PO Quantity")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ORDER_NO","Caption","SO")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","RECORD_NO","Caption","SO Line")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","POHistory","Caption","PO History")

	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Select","MinWidth","50")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PART","MinWidth","140")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LOCATION","MinWidth","40")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DESCRIPTION","MinWidth","200")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","VendorName","MinWidth","200")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PL","MinWidth","35")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","SortCode","MinWidth","90")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LEADTIME","MinWidth","65")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OrderQty","MinWidth","85")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnHandQty","MinWidth","85")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnOrder","MinWidth","85")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ReOrderPt","MinWidth","85")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UM","MinWidth","55")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UMPurch","MinWidth","70")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Conversion","MinWidth","85")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PURCHASEDATE","MinWidth","85")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DATE_DUE","MinWidth","85")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Cost","MinWidth","85")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Purchase","MinWidth","85")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ORDER_NO","MinWidth","60")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","RECORD_NO","MinWidth","60")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","POHistory","MinWidth","60")
	
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Select","AllowEdit",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PART","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LOCATION","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DESCRIPTION","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Vendor","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","VendorName","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PL","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","SortCode","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LEADTIME","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OrderQty","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnHandQty","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnOrder","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ReOrderPt","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UM","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UMPurch","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Conversion","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PURCHASEDATE","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DATE_DUE","AllowEdit",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Cost","AllowEdit",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Purchase","AllowEdit",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ORDER_NO","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","RECORD_NO","AllowEdit",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","POHistory","AllowEdit",False)

	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Select","ReadOnly",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DATE_DUE","ReadOnly",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Cost","ReadOnly",False)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Purchase","ReadOnly",False)

	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Select","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PART","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LOCATION","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DESCRIPTION","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","VendorName","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PL","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","SortCode","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LEADTIME","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OrderQty","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnHandQty","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnOrder","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ReOrderPt","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UM","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UMPurch","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Conversion","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PURCHASEDATE","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DATE_DUE","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Cost","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Purchase","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ORDER_NO","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","RECORD_NO","HeaderFontBold",True)
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","POHistory","HeaderFontBold",True)
	
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Select","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PART","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LOCATION","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DESCRIPTION","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","VendorName","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PL","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","SortCode","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LEADTIME","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OrderQty","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnHandQty","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnOrder","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ReOrderPt","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UM","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UMPurch","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Conversion","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PURCHASEDATE","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DATE_DUE","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Cost","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Purchase","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ORDER_NO","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","RECORD_NO","HeaderHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","POHistory","HeaderHAlignment","Center")
	
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Select","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LOCATION","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","VendorName","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PL","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","SortCode","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LEADTIME","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UM","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","UMPurch","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Conversion","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PURCHASEDATE","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DATE_DUE","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ORDER_NO","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","RECORD_NO","CellHAlignment","Center")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","POHistory","CellHAlignment","Center")
	
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PART","CellForeColor","Blue")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","LOCATION","CellForeColor","Blue")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DESCRIPTION","CellForeColor","Blue")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","VendorName","CellForeColor","Blue")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ORDER_NO","CellForeColor","Blue")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","RECORD_NO","CellForeColor","Blue")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","POHistory","CellForeColor","White")

	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DATE_DUE","CellBackColor","LightYellow")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Cost","CellBackColor","LightYellow")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Purchase","CellBackColor","LightYellow")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","POHistory","CellBackColor","Gray")

	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OrderQty","DisplayCustomNumeric","#,###,###,##0.00##")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnHandQty","DisplayCustomNumeric","#,###,###,##0.00##")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","OnOrder","DisplayCustomNumeric","#,###,###,##0.00##")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","ReOrderPt","DisplayCustomNumeric","#,###,###,##0.00##")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Conversion","DisplayCustomNumeric","#,###,###,##0.00##")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Cost","DisplayCustomNumeric","#,###,###,##0.00##")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","Purchase","DisplayCustomNumeric","#,###,###,##0.00##")

	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","PURCHASEDATE","DisplayCustomDatetime","d")
	Gui.frmPO.GsGCPODrop.SetColumnProperty("gvPODrop","DATE_DUE","DisplayCustomDatetime","d")

	Gui.frmPO.GsGCPODrop.ResumeLayout()
	Gui.frmPO.GsGCPODrop.MainView("gvPODrop")
	
	Gui.frmPO.lblStatus.Visible(False)
	Gui.frmPO.progBarStatus.Visible(False)
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadGvPODrop.End

Program.Sub.GsGCPO_RowCellClick.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sPart.Declare
	V.Local.sLoc.Declare
	V.Local.fQty.Declare
	V.Local.sFilter.Declare
	V.Local.sParams.Declare
	V.Local.sCaption.Declare
	V.Local.sGV.Declare
	V.Local.sDT.Declare
	V.Local.sSO.Declare
	V.Local.sVendor.Declare
	
	F.Intrinsic.Control.BlockEvents

	
	
	F.Intrinsic.Control.SelectCase(V.Screen.frmPO!tabPO.Tab)
		F.Intrinsic.Control.Case(0)
			V.Local.sGV.Set("gvPO")
			V.Local.sDT.Set("dtPO")
		F.Intrinsic.Control.Case(1)
			V.Local.sGV.Set("gvPOSO")
			V.Local.sDT.Set("dtPOSO")
		F.Intrinsic.Control.Case(2)
			V.Local.sGV.Set("gvPODrop")
			V.Local.sDT.Set("dtPODrop")
	F.Intrinsic.Control.EndSelect

	V.Global.sPart.Set("")
	F.Intrinsic.Control.SelectCase(V.Args.Column)
		F.Intrinsic.Control.CaseAny("PART","LOCATION","Part","Location")
			Gui.FrmPO.GsGCPO.GetCellValueByColumnName("gvPO","PART",V.Args.RowIndex,V.Local.sPart)
			Gui.FrmPO.GsGCPO.GetCellValueByColumnName("gvPO","LOCATION",V.Args.RowIndex,V.Local.sLoc)
			Gui.frmPO.GsGCPO.Enabled(False)
			F.Intrinsic.String.Replace(V.Local.sPart,"'","''",V.Local.sPart)
			F.Intrinsic.String.Replace(V.Local.sLoc,"'","''",V.Local.sLoc)
			F.Intrinsic.String.Build("PART = '{0}' AND LOCATION = '{1}'",V.Local.sPart,V.Local.sLoc,V.Local.sFilter)
			'F.Data.DataView.Create("dtPO$dtMRP","dvMRP",22,V.Local.sFilter,"DATE_DUE ASC")
			'Function.Intrinsic.Control.CallSub(loadgvmrp,"Part",V.Local.sPart,"Loc",V.Local.sLoc)
			Gui.frmPO.GsGCPO.Enabled(True)
			
			'Fill Demand, Supply and RFQ
			V.Global.sPart.Set(V.DataTable.[V.Local.sDT](V.Args.RowIndex).Part!FieldValTrim)
			F.Intrinsic.Control.If(V.DataTable.[V.Local.sDT](V.Args.RowIndex).Location!FieldValTrim,=,"")
				F.Intrinsic.String.Build("Demand || Part: {0}",V.DataTable.[V.Local.sDT](V.Args.RowIndex).Part!FieldValTrim,V.Local.sCaption)
			F.Intrinsic.Control.Else
				F.Intrinsic.String.Build("Demand || Part: {0}	Loc: {1}",V.DataTable.[V.Local.sDT](V.Args.RowIndex).Part!FieldValTrim,V.DataTable.[V.Local.sDT](V.Args.RowIndex).Location!FieldValTrim,V.Local.sCaption)
			F.Intrinsic.Control.EndIf
			Gui.frmPO.lblDemand.Caption(V.Local.sCaption)
			F.Intrinsic.Control.If(V.Screen.frmPO!tabPO.Tab,=,0)
				F.Intrinsic.Control.CallSub(LoadDemand,"Part",V.DataTable.[V.Local.sDT](V.Args.RowIndex).Part!FieldValTrim,"Loc",V.DataTable.[V.Local.sDT](V.Args.RowIndex).Location!FieldValTrim)
			F.Intrinsic.Control.Else
				F.Intrinsic.Control.CallSub(LoadDemandSO,"Part",V.DataTable.[V.Local.sDT](V.Args.RowIndex).Part!FieldValTrim,"Loc",V.DataTable.[V.Local.sDT](V.Args.RowIndex).Location!FieldValTrim)
			F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.CallSub(LoadVendorQuote,"Part",V.DataTable.[V.Local.sDT](V.Args.RowIndex).Part!FieldValTrim,"Vendor",V.DataTable.[V.Local.sDT](V.Args.RowIndex).Vendor!FieldValTrim)
			F.Intrinsic.Control.CallSub(LoadSupply,"Part",V.DataTable.[V.Local.sDT](V.Args.RowIndex).Part!FieldValTrim,"Loc",V.DataTable.[V.Local.sDT](V.Args.RowIndex).Location!FieldValTrim)
		
		F.Intrinsic.Control.CaseAny("Description","DESCRIPTION")
			Gui.FrmPO.[V.Args.ControlName].GetCellValueByColumnName(V.Local.sGV,"PART",V.Args.RowIndex,V.Local.sPart)
			Gui.FrmPO.[V.Args.ControlName].GetCellValueByColumnName(V.Local.sGV,"LOCATION",V.Args.RowIndex,V.Local.sLoc)
			F.Intrinsic.String.Build("{0}!*!{1}!*!MR",V.Local.sPart,V.Local.sLoc,V.Local.sParams)
			F.Global.General.CallWrapperASync(7200,V.Local.sParams)
			
		F.Intrinsic.Control.CaseAny("ORDER_NO","RECORD_NO")
			Gui.frmPO.[V.Args.ControlName].GetCellValueByColumnName(V.Local.sGV,"ORDER_NO",V.Args.RowIndex,V.Local.sSO)
			F.Intrinsic.String.ConcatCallWrapperArgs(V.Local.sSO,"O","*!*ZDR*!*",V.Local.sParams)
			F.Global.General.CallWrapperAsync(200000,V.Local.sParams)
		
		F.Intrinsic.Control.CaseAny("POHistory","POHISTORY")
			Gui.frmPO.[V.Args.ControlName].GetCellValueByColumnName(V.Local.sGV,"PART",V.Args.RowIndex,V.Local.sPart)
			Gui.frmPO.[V.Args.ControlName].GetCellValueByColumnName(V.Local.sGV,"LOCATION",V.Args.RowIndex,V.Local.sLoc)
			F.Intrinsic.String.Build("PO History (Part: {0} Loc: {1})",V.Local.sPart.Trim,V.Local.sLoc.Trim,V.Local.sCaption)
			Gui.frmHistory..Caption(V.Local.sCaption)
			F.Intrinsic.Control.CallSub(LoadPOHistory,"Part",V.Local.sPart,"Loc",V.Local.sLoc)
			
		F.Intrinsic.Control.CaseAny("VendorName","VENDORNAME")
			Gui.frmPO.[V.Args.ControlName].GetCellValueByColumnName(V.Local.sGV,"PART",V.Args.RowIndex,V.Local.sPart)
			Gui.frmPO.[V.Args.ControlName].GetCellValueByColumnName(V.Local.sGV,"LOCATION",V.Args.RowIndex,V.Local.sLoc)
			Gui.frmPO.[V.Args.ControlName].GetCellValueByColumnName(V.Local.sGV,"Purchase",V.Args.RowIndex,V.Local.sLoc)
			Gui.frmPO.[V.Args.ControlName].GetCellValueByColumnName(V.Local.sGV,"Vendor",V.Args.RowIndex,V.Local.sVendor)
			V.Global.sPart.Set(V.Local.sPart)
			V.Global.sLoc.Set(V.Local.sLoc)
			V.Global.fQty.Set(V.Local.fQty)
			V.Global.sDt.Set(V.Local.sDT)
			V.Global.iRowIndex.Set(V.Args.RowIndex)
			F.Intrinsic.Control.If(V.Screen.frmPO!chkBrwVends.Value,=,0)
				Gui.frmPO.chkBrwVends.Value(0)
				Gui.frmPO.GsGCVendQte.ContextMenuAttach("ctxVendQte")
				F.Intrinsic.Control.CallSub(GetVendorQuotes,"Part",V.Local.sPart,"Loc",V.Local.sLoc)
			F.Intrinsic.Control.Else
				Gui.frmPO.chkBrwVends.Value(1)
				F.Intrinsic.Control.CallSub(chkBrwVends_Click)
			F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.EndSelect
	
	F.Intrinsic.Control.UnBlockEvents
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GsGCPO_RowCellClick.End

Program.Sub.chkBrwVends_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	F.Intrinsic.Control.If(V.Screen.frmPO!chkBrwVends.Value,=,0)
		V.Global.bVendQte.Set(True)
		Gui.frmPO.GsGCVendQte.ContextMenuAttach("ctxVendQte")
		Gui.frmPO.lblVendQte.Caption("Vendor Quotes")
		F.Intrinsic.Control.If(V.DataTable.dtGetVendQtes.Exists)
			Gui.frmPO.GsGCVendQte.ClearRows("gvVendors")
			F.Data.DataTable.Close("dtGetVendQtes")
		F.Intrinsic.Control.EndIf
		
	F.Intrinsic.Control.Else
		V.Global.bVendQte.Set(False)
		Gui.frmPO.GsGCVendQte.ContextMenuAttach("ctxVendor")
		Gui.frmPO.lblVendQte.Caption("Vendors")
		
		F.Intrinsic.Control.If(V.DataTable.dtGetVendQtes.Exists)
			F.Data.DataTable.Close("dtGetVendQtes")
		F.Intrinsic.Control.EndIf
	
		F.Data.DataTable.CreateFromSQL("dtGetVendQtes","con","Select Vendor,RTrim(Name_Vendor) As Name_Vendor From V_Vendor_Master Where Vendor <> '' Order By Name_Vendor;",True)
		
		Gui.frmPO.GsGCVendQte.AddGridviewFromDatatable("gvVendors","dtGetVendQtes")
		Gui.frmPO.GsGCVendQte.ResumeLayout()
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendors","MultiSelect",True)
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendors","Editable",False)
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendors","ReadOnly",True)
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendors","AllowSort",True)
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendors","AllowFilter",True)
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendors","ShowGroupPanel",False)
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendors","OptionsSelectionEnableAppearanceFocusedRow",False)
		
		'VENDOR
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendors","VENDOR","Caption","Vendor No")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendors","VENDOR","MinWidth","75")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendors","VENDOR","MaxWidth","75")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendors","VENDOR","HeaderFontBold",True)
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendors","VENDOR","HeaderHAlignment","Center")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendors","VENDOR","CellHAlignment","Center")
		
		'NAME_VENDOR
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendors","NAME_VENDOR","Caption","Vendor Name")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendors","NAME_VENDOR","MinWidth","125")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendors","NAME_VENDOR","HeaderFontBold",True)
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendors","NAME_VENDOR","HeaderHAlignment","Left")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendors","NAME_VENDOR","CellHAlignment","Left")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendors","NAME_VENDOR","CellForeColor","Blue")
	
		Gui.frmPO.GsGCVendQte.ResumeLayout()
		Gui.frmPO.GsGCVendQte.MainView("gvVendors")
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.chkBrwVends_Click.End

Program.Sub.LoadDemand.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSQL.Declare
	V.Local.sPart.Declare
	
	F.Intrinsic.Control.If(V.DataTable.dtDemand.Exists)
		F.Data.DataTable.Close("dtDemand")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.String.Replace(V.Args.Part,"'","''",V.Local.sPart)
	'F.Intrinsic.String.Build("Select 'Work Order' As Source,Job+'-'+Suffix As Record,Date_Due,Qty_Committed-Qty_Issued As Qty_Rem From V_Job_Commitments Where Part = '{0}' And Location = '{1}' UNION Select 'Sales Order' AS Source,Order_No+'-'+Left(Record_No,3) As Record,Date_Item_Prom As Date_Due,Qty_BO As Qty_Rem From V_Order_Lines Where Part = '{0}' And Location = '{1}' Order By Date_Due ASC;",V.Local.sPart,V.Args.Loc,V.Local.sSQL)
	
	f.Intrinsic.String.Build("SELECT REFERENCE AS SOURCE, JOB+'-'+SUFFIX AS RECORD, DATEDUE AS DATE_DUE, DEMAND AS QTY_REM FROM MRP_Planning where part = '{0}' and location = '{1}' AND ENTRYTYPE IN ('8','9','F','S') and job is null AND PURCHASE_ORDER IS NULL UNION ALL Select 'Work Order' As Source,Job+'-'+Suffix As Record,Date_Due,Qty_Committed-Qty_Issued As Qty_Rem From V_Job_Commitments Where Part = '{0}' And Location = '{1}' UNION ALL Select 'Sales Order' AS Source,Order_No+'-'+Left(Record_No,3) As Record,Date_Item_Prom As Date_Due,Qty_BO As Qty_Rem From V_Order_Lines Where Part = '{0}' And Location = '{1}' Order By Date_Due ASC",v.Local.sPart,v.Args.loc,v.Local.sSQL)
	
	F.Data.DataTable.CreateFromSQL("dtDemand","con",V.Local.sSQL,True)
	
	Gui.frmPO.GsGCDemand.AddGridViewFromDataTable("gvDemand","dtDemand")
	
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","MultiSelect",True)
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","Editable",False)
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","ReadOnly",True)
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","AllowSort",True)
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","AllowFilter",True)
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","ShowGroupPanel",True)
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","OptionsSelectionEnableAppearanceFocusedRow",False)
	
	'Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Record","ShowCaption",False)
	
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Source","Caption","Source")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Record","Caption","Reference")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Date_Due","Caption","Due Date")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Qty_Rem","Caption","Req Qty")

	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Source","MinWidth","65")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Record","MinWidth","65")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Date_Due","MinWidth","85")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Qty_Rem","MinWidth","85")

	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Source","HeaderFontBold",True)
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Record","HeaderFontBold",True)
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Date_Due","HeaderFontBold",True)
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Qty_Rem","HeaderFontBold",True)

	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Source","HeaderHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Record","HeaderHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Date_Due","HeaderHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Qty_Rem","HeaderHAlignment","Center")

	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Source","CellHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Record","CellHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Date_Due","CellHAlignment","Center")
	
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Record","CellForeColor","Blue")

	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Qty_Rem","DisplayCustomNumeric","#,###,###,##0.00##")

	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Date_Due","DisplayCustomDatetime","d")

	Gui.frmPO.GsGCDemand.ResumeLayout()
	Gui.frmPO.GsGCDemand.MainView("gvDemand")

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadDemand.End

Program.Sub.LoadDemandSO.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSQL.Declare
	V.Local.sSQL2.Declare
	
	F.Intrinsic.Control.If(V.DataTable.dtDemand.Exists)
		F.Data.DataTable.Close("dtDemand")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.If(V.Screen.frmPO!tabPO.Tab,=,1)
		F.Intrinsic.String.Build("Select '' As Plus,A.Order_No,Left(A.Record_No,3) As SOLine,Record_No As Record_No2,A.Qty_BO,A.Date_Item_Prom From V_Order_Lines A Left Join V_Sales_Ord_Com B On A.Order_No = B.Order_No And A.Record_No = B.Order_Line And B.Seq <> '000' Where A.Line_Type <> 'D' And A.Part = '{0}' And A.Location = '{1}';",V.Args.Part,V.Args.Loc,V.Local.sSQL)
		F.Intrinsic.String.Build("Select PO,PO_Line,A.Order_No,A.Order_Line From V_Sales_Ord_Com A Join V_Order_Lines B On A.Order_No = B.Order_No And A.Order_Line = B.Record_No Where A.Part = '{0}' And A.Loc = '{1}';",V.Args.Part,V.Args.Loc,V.Local.sSQL2)
	F.Intrinsic.Control.ElseIf(V.Screen.frmPO!tabPO.Tab,=,2)
		F.Intrinsic.String.Build("Select '' As Plus,A.Order_No,Left(A.Record_No,3) As SOLine,Record_No As Record_No2,A.Qty_BO,A.Date_Item_Prom From V_Order_Lines A Left Join V_PO_Drop_Ship B On A.Order_No = B.Order_No And A.Record_No = B.Order_Line Where A.Line_Type = 'D' And A.Part = '{0}' And A.Location = '{1}';",V.Args.Part,V.Args.Loc,V.Local.sSQL)
		F.Intrinsic.String.Build("Select PO,PO_Line,A.Order_No,A.Order_Line From V_PO_Drop_Ship A Join V_Order_Lines B On A.Order_No = B.Order_No And A.Order_Line = B.Record_No Where A.Part = '{0}' And A.Loc = '{1}';",V.Args.Part,V.Args.Loc,V.Local.sSQL2)
	F.Intrinsic.Control.EndIf
	F.Data.DataTable.CreateFromSQL("dtDemand","con",V.Local.sSQL,True)
	F.Data.DataView.Create("dtDemand","dvDemand")
	F.Data.DataTable.CreateFromSQL("dtDemand$dtPO","con",V.Local.sSQL2,True)
	F.Data.DataTable.AddRelation("dtDemand","Order_No*!*Record_No2","dtDemand$dtPO","Order_No*!*Order_Line")
	
	Gui.frmPO.GsGCDemand.AddGridviewFromDataview("gvDemand","dtDemand","dvDemand")
	Gui.frmPO.GsGCDemand.ResumeLayout()
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","MultiSelect",True)
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","Editable",False)
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","ReadOnly",True)
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","AllowSort",True)
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","AllowFilter",True)
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","ShowGroupPanel",True)
	Gui.frmPO.GsGCDemand.SetGridViewProperty("gvDemand","OptionsSelectionEnableAppearanceFocusedRow",False)
	
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Record_No2","Visible",False)
	
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Plus","ShowCaption",False)
	
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Order_No","Caption","SO")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","SOLine","Caption","Line")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Date_Item_Prom","Caption","Due Date")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Qty_BO","Caption","Rem Qty")

	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Plus","MinWidth","1")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Order_No","MinWidth","65")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","SOLine","MinWidth","35")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Date_Item_Prom","MinWidth","85")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Qty_BO","MinWidth","85")

	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Order_No","HeaderFontBold",True)
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","SOLine","HeaderFontBold",True)
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Date_Item_Prom","HeaderFontBold",True)
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Qty_BO","HeaderFontBold",True)

	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Order_No","HeaderHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","SOLine","HeaderHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Date_Item_Prom","HeaderHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Qty_BO","HeaderHAlignment","Center")

	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Order_No","CellHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","SOLine","CellHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Date_Item_Prom","CellHAlignment","Center")
	
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Order_No","CellForeColor","Blue")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","SOLine","CellForeColor","Blue")

	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Qty_BO","DisplayCustomNumeric","#,###,###,##0.00##")

	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Date_Item_Prom","DisplayCustomDatetime","d")

	Gui.frmPO.GsGCDemand.ResumeLayout()
	Gui.frmPO.GsGCDemand.MainView("gvDemand")
	
	'SubTable
	F.Data.DataView.Create("dtDemand$dtPO","dvPO")
	Gui.frmPO.GsGCDemand.AddGridviewFromDataview("gvDemand","dtDemand","dvPO")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Order_No","Visible",False)
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","Order_Line","Visible",False)
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","PO","Caption","PO")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","PO_Line","Caption","Line")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","PO","MinWidth","85")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","PO_Line","MinWidth","85")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","PO","HeaderFontBold",True)
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","PO_Line","HeaderFontBold",True)	
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","PO","HeaderHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","PO_Line","HeaderHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","PO","CellHAlignment","Center")
	Gui.frmPO.GsGCDemand.SetColumnProperty("gvDemand","PO_Line","CellHAlignment","Center")

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadDemandSO.End

Program.Sub.LoadVendorQuote.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSQL.Declare
	V.Local.sCaption.Declare
	V.Local.sPart.Declare
	
	F.Intrinsic.Control.If(V.DataTable.dtVendQte.Exists)
		F.Data.DataTable.Close("dtVendQte")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.If(V.DataTable.dtVendQteLines.Exists)
		F.Data.DataTable.Close("dtVendQteLines")
'		Gui.frmPO.GsGCVendQte.ClearRows("gvVendQte")
		Gui.frmPO.lblVendQte.Caption("Vendor Quotes")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.String.Replace(V.Args.Part,"'","''",V.Local.sPart)
	F.Intrinsic.String.Build("Select Top 1 Part, Seq, A.Vendor, B.Name_Vendor, Quote_Date, Expiration_Date, RFQ_Received, Add_Date, Add_By From V_Vend_Qte_Header A Left Join V_Vendor_Master B On A.Vendor = B.Vendor Where Part = '{0}' And Expiration_Date >= CurDate() And A.Vendor = '{1}' Order By Expiration_Date Desc;",V.Local.sPart,V.Args.Vendor,V.Local.sSQL)
	F.Data.DataTable.CreateFromSQL("dtVendQte","con",V.Local.sSQL,True)
	
	F.Intrinsic.Control.If(V.DataTable.dtVendQte.RowCount,<>,0)
		F.Intrinsic.String.Build("Vendor Quotes || {0}({1}) || Exp Date:{2}",V.DataTable.dtVendQte(0).Name_Vendor!FieldValTrim,V.DataTable.dtVendQte(0).Vendor!FieldValTrim,V.DataTable.dtVendQte(0).Expiration_Date!FieldVal,V.Local.sCaption)
		Gui.frmPO.lblVendQte.Caption(V.Local.sCaption)
		
		F.Intrinsic.String.Build("Select Line,Quantity,Unit_Price From Vend_Qte_Lines Where Part = '{0}' And Seq = '{1}' Order By Line;",V.Local.sPart,V.DataTable.dtVendQte(0).Seq!FieldVal,V.Local.sSQL)
		F.Data.DataTable.CreateFromSQL("dtVendQteLines","con",V.Local.sSQL,True)
		
		Gui.frmPO.GsGCVendQte.AddGridViewFromDataTable("gvVendQte","dtVendQteLines")
		Gui.frmPO.GsGCVendQte.ResumeLayout()
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","MultiSelect",True)
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","Editable",False)
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","ReadOnly",True)
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","AllowSort",True)
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","AllowFilter",True)
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","ShowGroupPanel",True)
		Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","OptionsSelectionEnableAppearanceFocusedRow",False)
		
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Line","Caption","Line")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Quantity","Caption","Quantity")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Unit_Price","Caption","Unit Price")
	
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Line","MinWidth","65")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Quantity","MinWidth","35")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Unit_Price","MinWidth","85")
	
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Line","HeaderFontBold",True)
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Quantity","HeaderFontBold",True)
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Unit_Price","HeaderFontBold",True)
	
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Line","HeaderHAlignment","Center")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Quantity","HeaderHAlignment","Center")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Unit_Price","HeaderHAlignment","Center")
	
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Line","CellHAlignment","Center")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Quantity","CellHAlignment","Center")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Unit_Price","CellHAlignment","Center")
	
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Quantity","DisplayCustomNumeric","#,###,###,##0.00##")
		Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Unit_Price","DisplayCustomNumeric","#,###,###,##0.00##")
	
		Gui.frmPO.GsGCVendQte.ResumeLayout()
		Gui.frmPO.GsGCVendQte.MainView("gvVendQte")
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadVendorQuote.End

Program.Sub.LoadSupply.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSQL.Declare
	V.Local.sSQL2.Declare
	V.Local.sPart.Declare
	
	F.Intrinsic.Control.If(V.DataTable.dtSupply.Exists)
		F.Data.DataTable.Close("dtSupply")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.String.Replace(V.Args.Part,"'","''",V.Local.sPart)
	'F.Intrinsic.String.Build("Select Purchase_Order+'-'+Left(Record_No,3) As PO,Date_Due_Line As Date_Due,Qty_Order-Qty_Received As Qty_Rem From V_PO_Lines Where Part = '{0}' And Location = '{1}' And Flag_Recv_Close <> 'Y' Order By Date_Due_Line Asc;",V.Local.sPart,V.Args.Loc,V.Local.sSQL)
	
	F.Intrinsic.String.Build("SELECT EntryType+'-'+TypeDesc as PO, DateDue as Date_Due, Supply as Qty_Rem from MRP_Planning where Part = '{0}' And Location = '{1}' And entrytype = 'P' and purchase_order is null UNION Select Purchase_Order+'-'+Left(Record_No,3) As PO, V_PO_LINES.DATE_DUE_LINE As Date_Due, Qty_Order-Qty_Received As Qty_Rem From V_PO_Lines Where Part = '{0}' And Location = '{1}' And Flag_Recv_Close <> 'Y' Order By Date_Due Asc;",V.Local.sPart,V.Args.Loc,v.Local.sSQL)
	
	F.Data.DataTable.CreateFromSQL("dtSupply","con",V.Local.sSQL,True)
	F.Data.DataView.Create("dtSupply","dvSupply")
	
	Gui.frmPO.GsGCSupply.AddGridviewFromDataview("gvSupply","dtSupply","dvSupply")
	Gui.frmPO.GsGCSupply.ResumeLayout()
	Gui.frmPO.GsGCSupply.SetGridViewProperty("gvSupply","MultiSelect",True)
	Gui.frmPO.GsGCSupply.SetGridViewProperty("gvSupply","Editable",False)
	Gui.frmPO.GsGCSupply.SetGridViewProperty("gvSupply","ReadOnly",True)
	Gui.frmPO.GsGCSupply.SetGridViewProperty("gvSupply","AllowSort",True)
	Gui.frmPO.GsGCSupply.SetGridViewProperty("gvSupply","AllowFilter",True)
	Gui.frmPO.GsGCSupply.SetGridViewProperty("gvSupply","ShowGroupPanel",True)
	Gui.frmPO.GsGCSupply.SetGridViewProperty("gvSupply","OptionsSelectionEnableAppearanceFocusedRow",False)
	
	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","PO","Caption","PO")
	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","Date_Due","Caption","Due Date")
	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","Qty_Rem","Caption","Rem Qty")

	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","PO","MinWidth","65")
	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","Date_Due","MinWidth","85")
	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","Qty_Rem","MinWidth","85")

	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","PO","HeaderFontBold",True)
	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","Date_Due","HeaderFontBold",True)
	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","Qty_Rem","HeaderFontBold",True)

	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","PO","HeaderHAlignment","Center")
	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","Date_Due","HeaderHAlignment","Center")
	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","Qty_Rem","HeaderHAlignment","Center")

	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","PO","CellHAlignment","Center")
	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","Date_Due","CellHAlignment","Center")
	
	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","PO","CellForeColor","Blue")

	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","Qty_Rem","DisplayCustomNumeric","#,###,###,##0.00##")

	Gui.frmPO.GsGCSupply.SetColumnProperty("gvSupply","Date_Due","DisplayCustomDatetime","d")

	Gui.frmPO.GsGCSupply.ResumeLayout()
	Gui.frmPO.GsGCSupply.MainView("gvSupply")
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadSupply.End

Program.Sub.GetVendorQuotes.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSQL.Declare
	V.Local.sSQL2.Declare
	V.Local.sCaption.Declare
	V.Local.iCnt.Declare
	
	F.Intrinsic.Control.If(V.DataTable.dtGetVendQtes.Exists)
		F.Data.DataTable.Close("dtGetVendQtes")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.String.Build("Select '' As Plus,A.Part,A.Vendor,RTrim(B.Name_Vendor) As Name_Vendor,A.Seq,A.Quote_Date,A.Expiration_Date From V_Vend_Qte_Header A Left Join V_Vendor_Master B On A.Vendor = B.Vendor Where Part = '{0}' Order By Expiration_Date;",V.Args.Part,V.Local.sSQL)
	F.Data.DataTable.CreateFromSQL("dtGetVendQtes","con",V.Local.sSQL,True)
	F.Data.DataView.Create("dtGetVendQtes","dvGetVendQtes")
	
	F.Intrinsic.String.Build("Select Part,Seq,Line,Quantity,Unit_Price From V_Vend_Qte_Lines Where Part = '{0}' Order By Seq,Line;",V.Args.Part,V.Local.sSQL2)
	F.Data.DataTable.CreateFromSQL("dtGetVendQtes$dtGetVendQtesLines","con",V.Local.sSQL2,True)

	F.Data.DataTable.AddRelation("dtGetVendQtes","Part*!*Seq","dtGetVendQtes$dtGetVendQtesLines","Part*!*Seq")
	
	F.Intrinsic.String.Build("Vendor Quotes || Part: {0}",V.Args.Part.Trim,V.Local.sCaption)
	Gui.frmPO.lblVendQte.Caption(V.Local.sCaption)
	
	Gui.frmPO.GsGCVendQte.AddGridviewFromDataview("gvVendQte","dtGetVendQtes","dvGetVendQtes")
	Gui.frmPO.GsGCVendQte.ResumeLayout()
	Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","MultiSelect",True)
	Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","Editable",False)
	Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","ReadOnly",True)
	Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","AllowSort",True)
	Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","AllowFilter",True)
	Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","ShowGroupPanel",True)
	Gui.frmPO.GsGCVendQte.SetGridViewProperty("gvVendQte","OptionsSelectionEnableAppearanceFocusedRow",False)
		
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Part","Visible",False)
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Vendor","Visible",False)
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Seq","Visible",False)
	
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Plus","ShowCaption",False)
	
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Part","Caption","Part")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Vendor","Caption","Vendor No")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Name_Vendor","Caption","Vendor")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Seq","Caption","Seq")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Quote_Date","Caption","Quoted")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Expiration_Date","Caption","Expiration")

	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Part","MinWidth","45")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Vendor","MinWidth","45")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Name_Vendor","MinWidth","150")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Seq","MinWidth","45")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Quote_Date","MinWidth","65")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Expiration_Date","MinWidth","65")

	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Part","HeaderFontBold",True)
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Vendor","HeaderFontBold",True)
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Name_Vendor","HeaderFontBold",True)
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Seq","HeaderFontBold",True)
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Quote_Date","HeaderFontBold",True)
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Expiration_Date","HeaderFontBold",True)

	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Part","HeaderHAlignment","Center")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Vendor","HeaderHAlignment","Center")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Name_Vendor","HeaderHAlignment","Center")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Seq","HeaderHAlignment","Center")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Quote_Date","HeaderHAlignment","Center")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Expiration_Date","HeaderHAlignment","Center")

	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Part","CellHAlignment","Center")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Vendor","CellHAlignment","Center")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Name_Vendor","CellHAlignment","Center")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Seq","CellHAlignment","Center")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Quote_Date","CellHAlignment","Center")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Expiration_Date","CellHAlignment","Center")
	
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Vendor","CellForeColor","Blue")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Name_Vendor","CellForeColor","Blue")
	
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Quote_Date","DisplayCustomDatetime","d")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQte","Expiration_Date","DisplayCustomDatetime","d")
	
	Gui.frmPO.GsGCVendQte.ResumeLayout()
	Gui.frmPO.GsGCVendQte.MainView("gvVendQte")
	
	'SubTable
	F.Data.DataView.Create("dtGetVendQtes$dtGetVendQtesLines","dvGetVendQtesLines")
	Gui.frmPO.GsGCVendQte.AddGridviewFromDataview("gvVendQteLines","dtGetVendQtes","dvGetVendQtesLines")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Part","Visible",False)
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Seq","Visible",False)
	
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Line","Caption","Line")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Quantity","Caption","Qty")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Unit_Price","Caption","Unit Price")
	
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Line","MinWidth","45")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Quantity","MinWidth","85")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Unit_Price","MinWidth","85")
	
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Line","HeaderFontBold",True)
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Quantity","HeaderFontBold",True)
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Unit_Price","HeaderFontBold",True)
	
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Line","HeaderHAlignment","Center")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Quantity","HeaderHAlignment","Center")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Unit_Price","HeaderHAlignment","Center")
	
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Line","CellHAlignment","Center")
	
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Quantity","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.frmPO.GsGCVendQte.SetColumnProperty("gvVendQteLines","Unit_Price","DisplayCustomNumeric","#,###,###,##0.00")
	
	F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtGetVendQtes.RowCount--,1)
		Gui.frmPO.GsGCVendQte.ExpandMasterRow("gvVendQte",V.Local.iCnt)
	F.Intrinsic.Control.Next(V.Local.iCnt)
	
	F.Intrinsic.Control.CatchWhen(122000)
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GetVendorQuotes.End

Program.Sub.LoadGVMRP.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sCaption.Declare
	V.Local.fOnHand.Declare
	V.Local.sExp.Declare
	V.Local.sValue.Declare
	V.Local.sSQL.Declare
	V.Local.sRet.Declare
	V.Local.sPart.Declare
	V.Local.sLoc.Declare


	F.Intrinsic.String.Replace(V.Args.Part,"''","'",V.Local.sPart)
	F.Intrinsic.String.Build("Part : {0}",V.Local.sPart,V.Local.sCaption)
	Gui.frmMRP.lblPart.Caption(V.Local.sCaption)
	F.Intrinsic.String.Replace(V.Args.Loc,"''","'",V.Local.sLoc)
	F.Intrinsic.String.Build("Loc : {0}",V.Local.sLoc,V.Local.sCaption)
	Gui.frmMRP.lblLoc.Caption(V.Local.sCaption)

	F.Intrinsic.String.Build("SELECT QTY_ORDER,QTY_REORDER FROM V_INVENTORY_MSTR WHERE PART = '{0}' AND LOCATION = '{1}';",V.Args.Part,V.Args.Loc,V.Local.sSQL)
	F.ODBC.Connection!con.ExecuteAndReturn(V.Local.sSQL,V.Local.sRet)
	F.Intrinsic.String.Split(V.Local.sRet,"*!*",V.Local.sRet)

	F.Intrinsic.String.Format(V.Local.sRet(0),"#,###,###,##0.00##",V.Local.sValue)
	F.Intrinsic.String.Build("Order Qty : {0}",V.Local.sValue,V.Local.sCaption)
	Gui.frmMRP.lblOrderQty.Caption(V.Local.sCaption)
	F.Intrinsic.String.Format(V.Local.sRet(1),"#,###,###,##0.00##",V.Local.sValue)
	F.Intrinsic.String.Build("Reorder Point : {0}",V.Local.sValue,V.Local.sCaption)
	Gui.frmMRP.lblROP.Caption(V.Local.sCaption)

'	F.Intrinsic.Math.Add(V.DataView.dtPO$dtMRP!dvMRP(0).CurOnHand!FieldValFloat,V.DataView.dtPO$dtMRP!dvMRP(0).QUANTITY!FieldValFloat,V.Local.fOnHand)
'	F.Intrinsic.String.Format(V.Local.fOnHand,"#,###,###,##0.00##",V.Local.sValue)
'	F.Intrinsic.String.Build("Initial On Hand Qty : {0}",V.Local.sValue,V.Local.sCaption)
'	Gui.frmMRP.lblCurOnHand.Caption(V.Local.sCaption)

	Gui.frmMRP.GsGCMRP.AddGridViewFromDataView("gvMRP","dtPO$dtMRP","dvMRP")
	Gui.frmMRP.GsGCMRP.SuspendLayout()
	Gui.frmMRP.GsGCMRP.SetGridViewProperty("gvMRP","MultiSelect",True)
	Gui.frmMRP.GsGCMRP.SetGridViewProperty("gvMRP","AllowSort",False)
	Gui.frmMRP.GsGCMRP.SetGridViewProperty("gvMRP","AllowFilter",True)
	Gui.frmMRP.GsGCMRP.SetGridViewProperty("gvMRP","Editable",False)
	Gui.frmMRP.GsGCMRP.SetGridViewProperty("gvMRP","ReadOnly",True)
	Gui.frmMRP.GsGCMRP.SetGridViewProperty("gvMRP","OptionsDetailShowDetailTabs",False)
	Gui.frmMRP.GsGCMRP.SetGridViewProperty("gvMRP","OptionsViewShowGroupPanel",False)
	
	
	'Part*!*Location*!*FID*!*KEEP*!*DATE_DUE*!*PID*!*TypeDesc*!*QUANTITY*!*DateStart

	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","PART","Visible",False)
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","LOCATION","Visible",False)
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","FID","Visible",False)
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","KEEP","Visible",False)
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","DATE_DUE","Visible",False)
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","PID","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","PL","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","SortCode","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","LeadTime","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","CurOnHand2","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","Vendor","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","OrderQty","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","OnHandQty","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","ReqdQty","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","NetAvail","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","OnOrder","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","ReOrderPt","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","UM","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","UMPurch","Visible",False)
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","Conversion","Visible",False)

	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","TypeDesc","VisibleIndex","0")
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","DateStart","VisibleIndex","1")
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","QUANTITY","VisibleIndex","2")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","CurOnHand","VisibleIndex","3")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","Purchase","VisibleIndex","4")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","PostOnHand","VisibleIndex","5")

	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","TypeDesc","Caption","Source ")
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","DateStart","Caption","Required Date")
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","QUANTITY","Caption","Quantity")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","CurOnHand","Caption","Current On Hand")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","Purchase","Caption","Proposed PO Amt.")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","PostOnHand","Caption","On Hand After PO")

	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","TypeDesc","HeaderHAlignment","Center")
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","DateStart","HeaderHAlignment","Center")
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","QUANTITY","HeaderHAlignment","Far")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","CurOnHand","HeaderHAlignment","Far")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","Purchase","HeaderHAlignment","Far")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","PostOnHand","HeaderHAlignment","Far")

	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","TypeDesc","CellHAlignment","Center")
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","DateStart","CellHAlignment","Center")
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","QUANTITY","CellHAlignment","Far")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","CurOnHand","CellHAlignment","Far")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","Purchase","CellHAlignment","Far")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","PostOnHand","CellHAlignment","Far")

	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","QUANTITY","DisplayCustomNumeric","#,###,###,##0.00##")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","CurOnHand","DisplayCustomNumeric","#,###,###,##0.00##")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","Purchase","DisplayCustomNumeric","#,###,###,##0.00##")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","PostOnHand","DisplayCustomNumeric","#,###,###,##0.00##")

	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","TypeDesc","CellBackColor","WhiteSmoke")
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","DateStart","CellBackColor","WhiteSmoke")
	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","QUANTITY","CellBackColor","WhiteSmoke")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","CurOnHand","CellBackColor","WhiteSmoke")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","Purchase","CellBackColor","WhiteSmoke")
'	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","PostOnHand","CellBackColor","WhiteSmoke")

	Gui.frmMRP.GsGCMRP.SetColumnProperty("gvMRP","DateStart","DisplayCustomDatetime","d")

	Gui.frmMRP.GsGCMRP.ResumeLayout()
	Gui.frmMRP.GsGCMRP.MainView("gvMRP")

	F.Data.DataView.Close("dtPO$dtMRP","dvMRP")
	Gui.frmMRP..Show
	
	F.Intrinsic.Control.CallSub(Deserialize)
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadGVMRP.End

Program.Sub.frmMRP_UnLoad.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	Gui.frmMRP..Visible(False)
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.frmMRP_UnLoad.End

Program.Sub.frmHistory_UnLoad.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	F.Intrinsic.Control.CallSub(Serialize)
	
	Gui.frmHistory..Visible(False)
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry

Program.Sub.frmHistory_UnLoad.End

Program.Sub.GsGCHistory_RowCellClick.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sParams.Declare
	
	F.Intrinsic.Control.If(v.Args.Column,=,"Purchase_Order")
		F.Intrinsic.String.Build("V!*!{0}!*!",V.Args.CellValue,V.Local.sParams)
		F.Global.General.CallWrapperAsync(175200,V.Local.sParams)
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GsGCHistory_RowCellClick.End

Program.Sub.LoadPOHistory.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sSQL.Declare
	
	F.Intrinsic.Control.If(v.DataTable.dtHist.Exists)
		F.Data.DataTable.Close("dtHist")
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.String.Build("Select A.Purchase_Order,Left(A.PO_Line,3) As PO_Line,B.Name_Vendor,A.Buyer,A.Qty_Order,A.Qty_Recd_Not_Insp,A.Qty_Received,A.Qty_Reject,A.Qty_Order - A.Qty_Received as Remaining,A.Cost,A.Date_PO,A.Date_Due,A.Date_Received,A.UM_Inventory,A.Product_Line,A.Job,A.Suffix,RTrim(A.GL_Account) As GL_Account,A.Receiver_No From V_PO_History A Left Join V_Vendor_Master B ON A.Vendor = B.Vendor Where A.Part = '{0}' and A.Location = '{1}' Order By A.Date_Received Desc,A.PO_TIME Desc;",V.Args.Part,V.Args.Loc,v.Local.sSQL)
	
	F.Data.DataTable.CreateFromSQL("dtHist","con",V.Local.sSQL,true)		
	
	F.Intrinsic.Control.CallSub(LoadGvHistory)
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadPOHistory.End

Program.Sub.LoadGvHistory.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sTemp.Declare
	
	Gui.frmHistory.GsGCHistory.AddGridviewFromDataTable("gvHist","dtHist")
	Gui.frmHistory.GsGCHistory.SuspendLayout()
	Gui.frmHistory.GsGCHistory.SetGridviewProperty("gvHist","MultiSelect",True)
	Gui.frmHistory.GsGCHistory.SetGridviewProperty("gvHist","Editable",False)
	Gui.frmHistory.GsGCHistory.SetGridviewProperty("gvHist","AllowSort",True)
	Gui.frmHistory.GsGCHistory.SetGridviewProperty("gvHist","AllowFilter",True)
	Gui.frmHistory.GsGCHistory.setGridViewProperty("gvHist","OptionsDetailShowDetailTabs",False)
	Gui.frmHistory.GsGCHistory.SetGridViewProperty("gvHist","OptionsMenuShowAutoFilterRowItem",False)
	Gui.frmHistory.GsGCHistory.SetGridviewProperty("gvHist","OptionsViewShowGroupPanel",True)
	Gui.frmHistory.GsGCHistory.SetGridViewProperty("gvHist","EnableAppearanceOddRow",True)
	
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Purchase_Order","Caption","PO Number")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","PO_Line","Caption","PO Line")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Name_Vendor","Caption","Vendor")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Buyer","Caption","Buyer")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Order","Caption","Order Qty")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Recd_Not_Insp","Caption","Not Insp")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Received","Caption","Received")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Reject","Caption","Rejected")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Remaining","Caption","Open")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Cost","Caption","Unit Cost")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_PO","Caption","Order Date")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_Due","Caption","Due Date")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_Received","Caption","Received Date")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","UM_Inventory","Caption","UM Inv")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Product_Line","Caption","PL")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Job","Caption","Job")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Suffix","Caption","Suffix")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","GL_Account","Caption","GL Account")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Receiver_No","Caption","Receiver Number")
	
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Purchase_Order","MinWidth","80")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","PO_Line","MinWidth","50")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Name_Vendor","MinWidth","180")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Buyer","MinWidth","55")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Order","MinWidth","80")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Recd_Not_Insp","MinWidth","80")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Received","MinWidth","80")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Reject","MinWidth","80")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Remaining","MinWidth","80")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Cost","MinWidth","80")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_PO","MinWidth","80")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_Due","MinWidth","80")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_Received","MinWidth","95")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","UM_Inventory","MinWidth","65")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Product_Line","MinWidth","35")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Job","MinWidth","80")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Suffix","MinWidth","80")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","GL_Account","MinWidth","85")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Receiver_No","MinWidth","120")
	
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Purchase_Order","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","PO_Line","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Name_Vendor","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Buyer","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Order","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Recd_Not_Insp","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Received","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Reject","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Remaining","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Cost","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_PO","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_Due","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_Received","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","UM_Inventory","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Product_Line","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Job","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Suffix","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","GL_Account","HeaderFontBold",True)
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Receiver_No","HeaderFontBold",True)
	
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Purchase_Order","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","PO_Line","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Name_Vendor","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Buyer","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Order","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Recd_Not_Insp","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Received","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Reject","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Remaining","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Cost","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_PO","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_Due","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_Received","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","UM_Inventory","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Product_Line","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Job","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Suffix","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","GL_Account","HeaderHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Receiver_No","HeaderHAlignment","Center")
	
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Purchase_Order","CellHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","PO_Line","CellHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Buyer","CellHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","UM_Inventory","CellHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Product_Line","CellHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Receiver_No","CellHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_PO","CellHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_Due","CellHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_Received","CellHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Job","CellHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Suffix","CellHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","GL_Account","CellHAlignment","Center")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Receiver_No","CellHAlignment","Center")
	
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_PO","DisplayCustomDateTime","d")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_Due","DisplayCustomDateTime","d")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Date_Received","DisplayCustomDateTime","d")
	
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Order","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Recd_Not_Insp","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Received","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Qty_Reject","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Remaining","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.frmHistory.GsGCHistory.SetColumnProperty("gvHist","Cost","DisplayCustomNumeric","#,###,###,##0.00")
	
	Gui.frmHistory.GsGCHistory.ResumeLayout()
	Gui.frmHistory.GsGCHistory.MainView("gvHist")
	
	Gui.frmHistory..Show
	
	F.Intrinsic.Control.CallSub(Deserialize)
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadGvHistory.End

Program.Sub.Serialize.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSerialize.Declare

	'GvHist
	Gui.frmHistory.GsGCHistory.Serialize("gvHist",V.Local.sSerialize)
	F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"GVHIST",4936,1000,False,"Serialize",False,0,-999.0,1/1/1980,12:00:00 AM,V.Local.sSerialize)
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End
	F.Intrinsic.Control.EndTry
	
Program.Sub.Serialize.End

Program.Sub.Deserialize.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sSerialize.Declare
	
	'GvHist
	F.Global.Registry.ReadValue(V.Caller.User,V.Caller.CompanyCode,"GVHIST",4936,1000,6,"",V.Local.sSerialize)
	F.Intrinsic.Control.If(V.Local.sSerialize.Trim,<>,"")
		Gui.frmHistory.GsGCHistory.Deserialize(V.Local.sSerialize)
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End
	F.Intrinsic.Control.EndTry
Program.Sub.Deserialize.End

Program.Sub.cmdNewVendQte_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.iRet.Declare
	
	F.Global.General.LaunchMenuTask(271,2,V.Local.iRet)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.cmdNewVendQte_Click.End

Program.Sub.cmdViewVendQte_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Intrinsic.Control.If(V.Global.sPart,<>,"")
		F.Global.General.CallWrapperAsync(175000,V.Global.sPart)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.cmdViewVendQte_Click.End

Program.Sub.chkCutoff_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Intrinsic.Control.If(V.Screen.frmPO!chkCutoff.Value,=,1)
		Gui.frmPO.dtpCutoff.Enabled(True)
	F.Intrinsic.Control.Else
		Gui.frmPO.dtpCutoff.Enabled(False)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.chkCutoff_Click.End

Program.Sub.Hyperlinks.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sRecord.Declare
	V.Local.sPO.Declare
	V.Local.sSO.Declare
	V.Local.sParams.Declare
	
	F.Intrinsic.Control.BlockEvents
	
	F.Intrinsic.Control.SelectCase(V.Args.Column)
		F.Intrinsic.Control.CaseAny("Record","RECORD")
			F.Intrinsic.Control.If(V.DataTable.dtDemand(V.Args.RowIndex).Source!FieldVal,=,"Work Order")
				F.Intrinsic.String.Split(V.DataTable.dtDemand(V.Args.RowIndex).Record!FieldVal,"-",V.Local.sRecord)
				F.Intrinsic.String.ConcatCallWrapperArgs("7",V.Local.sRecord(0).Trim,V.Local.sRecord(1).Trim,"A",V.Local.sParams)
				F.Global.General.CallWrapperSync(450000,V.Local.sParams)
'			F.Intrinsic.Control.Else
'				F.Intrinsic.String.Split(V.DataTable.dtDemand(V.Args.RowIndex).Record!FieldVal,"-",V.Local.sRecord)
'				F.Intrinsic.String.ConcatCallWrapperArgs(V.Local.sRecord(0).Trim,"V","*!*ZDR*!*",V.Local.sParams)
'				F.Global.General.CallWrapperAsync(200000,V.Local.sParams)
			F.Intrinsic.Control.EndIf
			
		F.Intrinsic.Control.Case("PO")
			F.Intrinsic.String.Split(V.DataTable.dtSupply(V.Args.RowIndex).PO!FieldVal,"-",V.Local.sRecord)
			f.Intrinsic.Control.If(v.Local.sRecord(0).LEFT1,<>,"P")
				F.Intrinsic.String.ConcatCallWrapperArgs("V",V.Local.sRecord(0).Trim,"",V.Local.sParams)
				F.Global.General.CallWrapperASync(175200,V.Local.sParams)
			f.Intrinsic.Control.EndIf
		
	F.Intrinsic.Control.EndSelect
	
	F.Intrinsic.Control.UnBlockEvents
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.Hyperlinks.End

Program.Sub.GsGCVendQte_RowCellClick.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.iCallType.Declare
	V.Local.iReturnCode.Declare
	V.Local.fReturnCost.Declare
	V.Local.sReturnVendor.Declare
	V.Local.sVendor.Declare
	
	F.Intrinsic.Control.If(V.DataTable.dtPO.Exists,=,False)
		F.Intrinsic.Control.ExitSub
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.If(V.Global.sPart,=,"")
		F.Intrinsic.Control.ExitSub
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.SelectCase(V.Args.Column)
		F.Intrinsic.Control.CaseAny("Name_Vendor","Vendor")
			F.Data.DataTable.SetValue(V.Global.sDt,V.Global.iRowIndex,"Vendor",V.DataTable.dtGetVendQtes(V.Args.RowIndex).Vendor!FieldVal,"VendorName",V.DataTable.dtGetVendQtes(V.Args.RowIndex).Name_Vendor!FieldVal)
			F.Intrinsic.Control.If(V.Global.bVendQte)
				F.Intrinsic.Control.CallSub(LoadVendorQuote,"Part",V.Global.sPart,"Vendor",V.DataTable.dtGetVendQtes(V.Args.RowIndex).Vendor!FieldVal)
			F.Intrinsic.Control.EndIf
			'CostType
			F.Intrinsic.Control.If(V.Screen.frmPO!ddlCost.Text,=,"PO History Cost")
				F.Intrinsic.Control.SelectCase(V.DataTable.dtPO(V.Global.iRowIndex).Status!FieldVal)
					F.Intrinsic.Control.Case(0)
						V.Local.iCallType.Set(1)
						V.Local.sVendor.Set("")
					F.Intrinsic.Control.CaseAny(1,2)
						V.Local.iCallType.Set(3)
						V.Local.sVendor.Set("")
				F.Intrinsic.Control.EndSelect
			F.Intrinsic.Control.Else
				F.Intrinsic.Control.SelectCase(V.DataTable.dtPO(V.Global.iRowIndex).Status!FieldVal)
					F.Intrinsic.Control.Case(0)
						V.Local.iCallType.Set(1)
						V.Local.sVendor.Set("")
					F.Intrinsic.Control.Case(1)
						V.Local.iCallType.Set(2)
						V.Local.sVendor.Set(V.DataTable.dtGetVendQtes(V.Args.RowIndex).Vendor!FieldVal)
					F.Intrinsic.Control.Case(2)
						V.Local.iCallType.Set(3)
						V.Local.sVendor.Set("")
				F.Intrinsic.Control.EndSelect
			F.Intrinsic.Control.EndIf				
			'Cost
			F.Global.Callwrapper.New("LoadCost","Purchasing.GetPartPurchaseCost")
			F.Global.Callwrapper.SetProperty("LoadCost","CallType",V.Local.iCallType)
			F.Global.Callwrapper.SetProperty("LoadCost","Part",V.Global.sPart)
			F.Global.Callwrapper.SetProperty("LoadCost","Location",V.Global.sLoc)
			F.Global.Callwrapper.SetProperty("LoadCost","Vendor",V.Local.sVendor)
			F.Global.Callwrapper.SetProperty("LoadCost","Quantity",V.Global.fQty)
			F.Global.CallWrapper.Run("LoadCost")
			'Returns
			F.Global.CallWrapper.GetProperty("LoadCost","ReturnCode",V.Local.iReturnCode)
			F.Global.CallWrapper.GetProperty("LoadCost","ReturnCost",V.Local.fReturnCost)
			F.Global.CallWrapper.GetProperty("LoadCost","ReturnVendor",V.Local.sReturnVendor)
			'Set Value
			F.Data.DataTable.SetValue("dtPO",V.Global.iRowIndex,"Cost",V.Local.fReturnCost)
	F.Intrinsic.Control.EndSelect

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GsGCVendQte_RowCellClick.End

Program.Sub.LoadCost.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.iCallType.Declare
	V.Local.iCnt.Declare
	V.Local.iReturnCode.Declare
	V.Local.fReturnCost.Declare
	V.Local.sReturnVendor.Declare
	V.Local.sVendor.Declare
	
	'1-Default
	'2-Vendor Quote
	'3-Purchase Order History
	
	'PO Tab
	F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtPO.RowCount--,1)
		f.Intrinsic.Math.Add(v.Global.iLoop,1,v.Global.iLoop)
		
		F.Intrinsic.Control.If(V.Screen.frmPO!ddlCost.Text,=,"PO History Cost")
			F.Intrinsic.Control.SelectCase(V.DataTable.dtPO(V.Local.iCnt).Status!FieldVal)
				F.Intrinsic.Control.Case(0)
					V.Local.iCallType.Set(1)
					V.Local.sVendor.Set("")
				F.Intrinsic.Control.CaseAny(1,2)
					V.Local.iCallType.Set(3)
					V.Local.sVendor.Set("")
			F.Intrinsic.Control.EndSelect
		F.Intrinsic.Control.Else
			F.Intrinsic.Control.SelectCase(V.DataTable.dtPO(V.Local.iCnt).Status!FieldVal)
				F.Intrinsic.Control.Case(0)
					V.Local.iCallType.Set(1)
					V.Local.sVendor.Set("")
				F.Intrinsic.Control.Case(1)
					V.Local.iCallType.Set(2)
					V.Local.sVendor.Set(V.DataTable.dtPO(V.Local.iCnt).Vendor!FieldVal)
				F.Intrinsic.Control.Case(2)
					V.Local.iCallType.Set(3)
					V.Local.sVendor.Set("")
			F.Intrinsic.Control.EndSelect
		F.Intrinsic.Control.EndIf
		
		F.Global.Callwrapper.New("LoadCost","Purchasing.GetPartPurchaseCost")
		F.Global.Callwrapper.SetProperty("LoadCost","CallType",V.Local.iCallType)
		F.Global.Callwrapper.SetProperty("LoadCost","Part",V.DataTable.dtPO(V.Local.iCnt).Part!FieldVal)
		F.Global.Callwrapper.SetProperty("LoadCost","Location",V.DataTable.dtPO(V.Local.iCnt).Location!FieldVal)
		F.Global.Callwrapper.SetProperty("LoadCost","Vendor",V.Local.sVendor)
		F.Global.Callwrapper.SetProperty("LoadCost","Quantity",V.DataTable.dtPO(V.Local.iCnt).Purchase!FieldVal)
		F.Global.CallWrapper.Run("LoadCost")
		
		'Returns
		F.Global.CallWrapper.GetProperty("LoadCost","ReturnCode",V.Local.iReturnCode)
		F.Global.CallWrapper.GetProperty("LoadCost","ReturnCost",V.Local.fReturnCost)
		F.Global.CallWrapper.GetProperty("LoadCost","ReturnVendor",V.Local.sReturnVendor)
		
		'Set Value
		F.Data.DataTable.SetValue("dtPO",V.Local.iCnt,"Cost",V.Local.fReturnCost)
	F.Intrinsic.Control.Next(V.Local.iCnt)
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadCost.End

Program.Sub.GenerateEmail.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sSelect.Declare
	V.Local.iCnt.Declare
	V.Local.iUserID.Declare
	V.Local.sSenderName.Declare
	V.Local.sSenderEmail.Declare
	V.Local.sParams.Declare
	V.Local.iBIRunID.Declare
	V.Local.iLogID.Declare
	V.Local.sAttach.Declare
	V.Local.sParamName.Declare
	V.Local.sParamVal.Declare
	V.Local.iRet.Declare
	V.Local.sRecipient.Declare
	V.Local.sRecipientEmail.Declare
	V.Local.sSubject.Declare
	V.Local.sBody.Declare
	v.Local.sSig.Declare
	V.Local.sDir.Declare
	V.Local.bFile.Declare
	V.Local.sSQL.Declare
	V.Local.sCallingProgram.Declare
	v.Local.sPOList.Declare
	v.Local.sRet.Declare
	v.Local.sMsg.Declare
	
'Preview Email
'Auto Email
'Do Not Email
	F.Intrinsic.Control.If(V.DataTable.dtEmails.Exists)
		F.Data.DataTable.Close("dtEmails")
	F.Intrinsic.Control.EndIf
	

	'Check Subject and Body Txt File
	F.Intrinsic.String.Build("{0}\EmailText\PO.txt",V.Dictionary.mrpsettings!PROGRAMDIR,V.Local.sSubject)
	F.Intrinsic.File.Exists(V.Local.sSubject,V.Local.bFile)
	F.Intrinsic.Control.If(V.Local.bFile)
		F.Intrinsic.File.File2String(V.Local.sSubject,V.Local.sDir)
		F.Intrinsic.String.Split(V.Local.sDir,"*!*",V.Local.sDir)
		V.Local.sSubject.Set(V.Local.sDir(0))
		V.Local.sBody.Set(V.Local.sDir(1))
	F.Intrinsic.Control.EndIf

	
	'check for user signature file
	f.Intrinsic.String.Build("{0}\EmailText\{1}.txt",V.Dictionary.mrpsettings!PROGRAMDIR,v.Caller.User.Trim,V.Local.sDir)
	f.Intrinsic.File.Exists(v.Local.sDir,v.Local.bFile)
	f.Intrinsic.Control.If(v.Local.bFile)
		f.Intrinsic.File.File2String(v.Local.sDir,v.Local.sSig)
	f.Intrinsic.Control.Else
		f.Intrinsic.String.Build("The signature file {1}.txt doesn't exist.{0}Would you like to create one before generating emails?{0}{0}If you click yes, the program will continue after the signature file has been saved.{0}IMPORTANT!! Be sure to save the file as {1}.txt in the ..\Global\custom\4176\{2}\EmailText\  folder.",v.Ambient.NewLine,v.Caller.User.Trim,v.Caller.CompanyCode,v.Local.sMsg)
		f.Intrinsic.UI.Msgbox(v.Local.sMsg,"Signature File Missng!",4,v.Local.iRet)
		
		f.Intrinsic.Control.If(v.Local.iRet,=,6)
			f.Intrinsic.String.Build("{0}\EmailText\Example sig.txt",V.Dictionary.mrpsettings!PROGRAMDIR,v.Local.sDir)
			f.Intrinsic.Task.ShellExecSync(0,"OPEN",V.Local.sDir,"","",0)

			f.Intrinsic.String.Build("{0}\EmailText\{1}.txt",V.Dictionary.mrpsettings!PROGRAMDIR,v.Caller.User.Trim,V.Local.sDir)
			f.Intrinsic.File.Exists(v.Local.sDir,v.Local.bFile)
			f.Intrinsic.Control.If(v.Local.bFile)
				f.Intrinsic.File.File2String(v.Local.sDir,v.Local.sSig)
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf

	
	'F.Intrinsic.String.Build("Select A.Purchase_Order,RTrim(B.Name_Vendor) As Name_Vendor,Case When C.Name_Preferred <> '' Then RTrim(C.Name_Preferred)+' '+RTrim(C.Name_Last) Else RTrim(C.Name_Preferred)+' '+RTrim(C.Name_Last) End As Contact_Name,RTrim(C.Email1) As Contact_Email From V_PO_Header A Join V_Vendor_Master B On A.Vendor = B.Vendor Join Contact C On A.Vendor = C.Cust Where C.Pri_Cntct = 1 And A.Purchase_Order In ({0}) And C.Email1 <> '';",V.Args.EmailList,V.Local.sSQL)
	F.Intrinsic.String.Build("Select A.Purchase_Order,RTrim(B.Name_Vendor) As Name_Vendor,'' As Contact_Name,RTrim(C.Email) As Contact_Email From V_PO_Header A Join V_Vendor_Master B On A.Vendor = B.Vendor Join V_Vendor_Addl C On A.Vendor = C.Vendor Where A.Purchase_Order In ({0});",V.Args.EmailList,V.Local.sSQL)
	F.Data.DataTable.CreateFromSQL("dtEmails","con",V.Local.sSQL,True)


	F.Global.Security.GetUserId(V.Caller.User,V.Caller.CompanyCode,V.Local.iUserID)
	F.Global.Security.GetFullName(V.Caller.User,V.Local.sSenderName)
	F.Global.Security.GetUserEmail(V.Caller.User,V.Local.sSenderEmail)
	F.Intrinsic.Control.If(V.Local.sSenderEmail,=,"")
		F.Intrinsic.UI.Msgbox("Error in email procedure. The GS User does not have an email address associated with it in User Security Maintenance.")
		F.Intrinsic.Control.End
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.If(V.Screen.FrmPO!ddlEmail.Text,=,"Preview Email")
		F.Intrinsic.Control.If(V.DataTable.dtEmails.RowCount,=,0)
			F.Data.DataTable.Close("dtEmails")
			'F.Intrinsic.String.Build("Select A.Purchase_Order,RTrim(B.Name_Vendor) As Name_Vendor,'' As Contact_Name,'' As Contact_Email From V_PO_Header A Join V_Vendor_Master B On A.Vendor = B.Vendor Where A.Purchase_Order In ({0});",V.Args.EmailList,V.Local.sSQL)
			F.Intrinsic.String.Build("Select A.Purchase_Order,RTrim(B.Name_Vendor) As Name_Vendor,'' As Contact_Name,RTrim(C.Email) As Contact_Email From V_PO_Header A Join V_Vendor_Master B On A.Vendor = B.Vendor Join V_Vendor_Addl C On A.Vendor = C.Vendor Where A.Purchase_Order In ({0});",V.Args.EmailList,V.Local.sSQL)
			F.Data.DataTable.CreateFromSQL("dtEmails","con",v.Local.sSQL,True)
		F.Intrinsic.Control.EndIf
		F.Data.Datatable.AddColumn("dtEmails","SenderName",String,V.Local.sSenderName)
		F.Data.Datatable.AddColumn("dtEmails","SenderEmail",String,V.Local.sSenderEmail)

		'Modify DataTable
		F.Data.Datatable.AddColumn("dtEmails","Subject",String,V.Local.sSubject)
		F.Data.Datatable.AddColumn("dtEmails","Body",String,V.Local.sBody)
		F.Data.Datatable.AddColumn("dtEmails","AttachmentFiles",String)
		F.Data.Datatable.AddColumn("dtEmails","Attachments",Boolean,False)
		F.Data.Datatable.AddColumn("dtEmails","Preview",String,"Preview")
		F.Intrinsic.Control.CallSub(LoadPreviewEmails)
		Gui.FrmPO.lblStatus.Visible(False)
		Gui.FrmPO.progBarStatus.Visible(False)
		F.Intrinsic.Control.ExitSub
	F.Intrinsic.Control.EndIf
		
	F.Intrinsic.Control.If(V.DataTable.dtEmails.RowCount,<>,0)
		Gui.FrmPO.lblStatus.Caption("Sending Emails....")
		Gui.FrmPO.lblStatus.Visible(True)
		'Gui.FrmPO.progBarStatus.Visible(True)
		Gui.FrmPO.tabPO.Enabled(False)
		Gui.FrmPO.progBarStatus.Min(0)
		F.Intrinsic.Control.If(V.Local.sSelect.UBound,<>,0)
			Gui.FrmPO.progBarStatus.Max(V.Local.sSelect.UBound)
		F.Intrinsic.Control.Else
			Gui.FrmPO.progBarStatus.Max(1)
		F.Intrinsic.Control.EndIf
		
		F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtEmails.RowCount--,1)
			Gui.FrmPO.progBarStatus.Value(V.Local.iCnt)
			F.Intrinsic.Control.If(V.DataTable.dtEmails(V.Local.iCnt).Contact_Email!FieldValTrim,<>,"")
				'Populate BI Table
				F.Intrinsic.String.Build("{0}!*!S!*! !*!N!*!N",V.DataTable.dtEmails(V.Local.iCnt).Purchase_Order!FieldValTrim,V.Local.sParams)	
				F.Global.General.CallWrapperSyncBio(915000,V.Local.sParams)
				'Export File
				F.Global.BI.GetRunID(V.Local.iBIRunID)
				F.Global.BI.StartLogging(V.Local.iBIRunID,002801,-1,"",V.Local.iLogID)
				F.Intrinsic.String.Build("{0}\Orders\{1}.pdf",V.Dictionary.mrpsettings!PROGRAMDIR,V.DataTable.dtEmails(V.Local.iCnt).Purchase_Order!FieldValTrim,V.Local.sAttach)
				V.Local.sParamName.Set("Terminal*!*ReportID*!*UseVendorCurr*!*PRTCNFRM*!*PROGRAM*!*PRTHIST*!*QTYDEC")
				F.Intrinsic.String.Build("{0}*!*002801*!* *!* *!* *!* *!*{1}*!* *!*",V.Caller.Terminal,0,V.Local.sParamVal)
				F.Global.BI.RunReportPreProcessor(V.Local.iBIRUNID,V.Local.iLogID,V.Local.sParamName,V.Local.sParamVal,"",4,True,"",-1,"",0,V.Local.sAttach,"",V.Local.iRet)
				F.Global.BI.StopLogging(V.Local.iLogID)
				'Prepare Email
				F.Intrinsic.String.Replace(V.DataTable.dtEmails(V.Local.iCnt).Contact_Email!FieldValTrim,";",",",V.Local.sRecipientEmail)
				F.Intrinsic.String.Build("{0}*!*{0}",V.Local.sRecipientEmail,V.Local.sRecipient)
				F.Intrinsic.String.Build("{0}*!*{1}",V.Local.sSenderEmail,V.Local.sSenderName,V.Local.sSenderEmail)
				F.Intrinsic.String.Build("{0}.pdf*!*{1}\Orders\",V.DataTable.dtEmails(V.Local.iCnt).Purchase_Order!FieldValTrim,V.Dictionary.mrpsettings!PROGRAMDIR,V.Local.sAttach)
				'Subject

				F.Intrinsic.String.Replace(V.Local.sSubject,"%PO%",V.DataTable.dtEmails(V.Local.iCnt).Purchase_Order!FieldValTrim,V.Local.sSubject)
				'Body
				F.Intrinsic.String.Replace(V.Local.sBody,"%PO%",V.DataTable.dtEmails(V.Local.iCnt).Purchase_Order!FieldValTrim,V.Local.sBody)
				F.Intrinsic.String.Replace(V.Local.sBody,"%USER%",V.Local.sSenderName,V.Local.sBody)
				f.Intrinsic.String.Replace(v.Local.sBody,"%SIG%",V.Local.sSig,V.Local.sBody)
				'Calling Program
				F.Intrinsic.String.Build("Email PO-{0}",V.DataTable.dtEmails(V.Local.iCnt).Purchase_Order!FieldValTrim,V.Local.sCallingProgram)
				'Send Email				
				F.Global.Messaging.QueueMessage(V.Caller.CompanyCode,0,V.Local.sCallingProgram,V.Local.sSubject,V.Local.sSenderEmail,V.Local.sRecipient,V.Local.sBody,5,"",False,"","","","","","","",V.Local.sAttach,False)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.Next(V.Local.iCnt)
	F.Intrinsic.Control.EndIf
	
	Gui.FrmPO.lblStatus.Visible(False)
	Gui.FrmPO.progBarStatus.Visible(False)
	Gui.FrmPO.tabPO.Enabled(True)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GenerateEmail.End

Program.Sub.frmPrevEmail_UnLoad.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.iRet.Declare
	
	F.Intrinsic.UI.Msgbox("Emails will not be sent out. Continue?","Continue?",4,V.Local.iRet)
	F.Intrinsic.Control.If(V.Local.iRet,=,6)
		Gui.frmPrevEmail..Visible(False)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.frmPrevEmail_UnLoad.End

Program.Sub.LoadPreviewEmails.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	Gui.frmPrevEmail.GsGCPrevEml.AddGridviewFromDatatable("gvEmails","dtEmails")
	Gui.frmPrevEmail.GsGCPrevEml.SuspendLayout()
	Gui.frmPrevEmail.GsGCPrevEml.SetGridViewProperty("gvEmails","MultiSelect",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetGridViewProperty("gvEmails","AllowSort",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetGridViewProperty("gvEmails","AllowFilter",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetGridViewProperty("gvEmails","Editable",False)
	Gui.frmPrevEmail.GsGCPrevEml.SetGridViewProperty("gvEmails","ReadOnly",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetGridViewProperty("gvEmails","ShowGroupPanel",False)
	Gui.frmPrevEmail.GsGCPrevEml.SetGridViewProperty("gvEmails","Enableappearanceoddrow",True)
	
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Subject","Visible",False)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Body","Visible",False)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","SenderName","Visible",False)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","SenderEmail","Visible",False)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","AttachmentFiles","Visible",False)
	
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Preview","ShowCaption",False)
	
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Purchase_Order","Caption","PO")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Name_Vendor","Caption","Vendor")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Contact_Name","Caption","Name")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Contact_Email","Caption","Email")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","SenderName","Caption","Sender Name")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","SenderEmail","Caption","Sender Email")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Subject","Caption","Subject")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Body","Caption","Body")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","AttachmentFiles","Caption","Files")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Attachments","Caption","Attachments")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Preview","Caption","Preview")
	
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Purchase_Order","MinWidth","85")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Name_Vendor","MinWidth","85")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Contact_Name","MinWidth","85")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Contact_Email","MinWidth","85")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","SenderName","MinWidth","85")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","SenderEmail","MinWidth","85")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Subject","MinWidth","85")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","AttachmentFiles","MinWidth","85")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Attachments","MinWidth","85")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Body","MinWidth","85")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Preview","MinWidth","85")
	
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Purchase_Order","HeaderFontBold",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Name_Vendor","HeaderFontBold",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Contact_Name","HeaderFontBold",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Contact_Email","HeaderFontBold",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","SenderName","HeaderFontBold",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","SenderEmail","HeaderFontBold",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Subject","HeaderFontBold",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","AttachmentFiles","HeaderFontBold",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Attachments","HeaderFontBold",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Body","HeaderFontBold",True)
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Preview","HeaderFontBold",True)
	
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Purchase_Order","HeaderHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Name_Vendor","HeaderHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Contact_Name","HeaderHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Contact_Email","HeaderHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","SenderName","HeaderHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","SenderEmail","HeaderHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Subject","HeaderHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","AttachmentFiles","HeaderHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Attachments","HeaderHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Body","HeaderHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Preview","HeaderHAlignment","Center")
	
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Purchase_Order","CellHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","AttachmentFiles","CellHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Attachments","CellHAlignment","Center")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Preview","CellHAlignment","Center")
	
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Preview","CellBackColor","Gray")
	Gui.frmPrevEmail.GsGCPrevEml.SetColumnProperty("gvEmails","Preview","CellForeColor","White")
	
	Gui.frmPrevEmail.GsGCPrevEml.ResumeLayout()
	Gui.frmPrevEmail.GsGCPrevEml.MainView("gvEmails")
	
	Gui.frmPrevEmail..Show

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadPreviewEmails.End

Program.Sub.GsGCPrevEml_RowCellClick.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sFilePath.Declare
	V.Local.sSubject.Declare
	V.Local.sBody.Declare
	
	F.Intrinsic.Control.SelectCase(V.Args.Column)
		F.Intrinsic.Control.Case("Preview")
			Gui.frmEmail..Caption("Edit Email")
			Gui.frmEmail.txtSName.Text(V.DataTable.dtEmails(V.Args.RowIndex).SenderName!FieldValTrim)
			Gui.frmEmail.txtSEmail.Text(V.DataTable.dtEmails(V.Args.RowIndex).SenderEmail!FieldValTrim)
			Gui.frmEmail.txtRName.Text(V.DataTable.dtEmails(V.Args.RowIndex).Contact_Name!FieldValTrim)
			Gui.frmEmail.txtREmail.Text(V.DataTable.dtEmails(V.Args.RowIndex).Contact_Email!FieldValTrim)
			F.Intrinsic.String.Replace(V.DataTable.dtEmails(V.Args.RowIndex).Subject!FieldValTrim,"%PO%",V.DataTable.dtEmails(V.Args.RowIndex).Purchase_Order!FieldValTrim,V.Local.sSubject)
			Gui.frmEmail.txtSubject.Text(V.Local.sSubject)
			F.Intrinsic.String.Replace(V.DataTable.dtEmails(V.Args.RowIndex).Body!FieldValTrim,"%PO%",V.DataTable.dtEmails(V.Args.RowIndex).Purchase_Order!FieldValTrim,V.Local.sBody)
			F.Intrinsic.String.Replace(V.Local.sBody,"%USER%",V.DataTable.dtEmails(V.Args.RowIndex).SenderName!FieldValTrim,V.Local.sBody)
			Gui.frmEmail.txtBody.Text(V.Local.sBody)
			Gui.frmEmail.txtAttach.Text(V.DataTable.dtEmails(V.Args.RowIndex).AttachmentFiles!FieldValTrim)
			Gui.frmEmail.txtRow.Text(V.Args.RowIndex)
			Gui.frmEmail..Show
			Gui.frmEmail.txtSName.SetFocus
	F.Intrinsic.Control.EndSelect
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GsGCPrevEml_RowCellClick.End

Program.Sub.cmdSend_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.iCnt.Declare
	V.Local.iCnt2.Declare
	V.Local.sSender.Declare
	V.Local.sRecipient.Declare
	V.Local.sRecipientEmail.Declare
	V.Local.sSubject.Declare
	V.Local.sBody.Declare
	V.Local.sAttachments.Declare
	V.Local.sFiles.Declare
	V.Local.sFilePath.Declare
	V.Local.sFileName.Declare
	V.Local.sParams.Declare
	V.Local.iBIRunID.Declare
	V.Local.iLogID.Declare
	V.Local.sParamName.Declare
	V.Local.sParamVal.Declare
	V.Local.iRet.Declare
	V.Local.sCallingProgram.Declare
	
	Gui.frmPrevEmail.lblStatus.Visible(True)
	Gui.frmPrevEmail.pbStatus.Visible(True)
	Gui.frmPrevEmail.pbStatus.Min(0)
	F.Intrinsic.Control.If(V.DataTable.dtEmails.RowCount,<>,0)
		Gui.frmPrevEmail.pbStatus.Max(V.DataTable.dtEmails.RowCount)
	F.Intrinsic.Control.Else
		Gui.frmPrevEmail.pbStatus.Max(100)
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtEmails.RowCount--,1)
		Gui.frmPrevEmail.pbStatus.Value(V.Local.iCnt)
		F.Intrinsic.Control.If(V.DataTable.dtEmails(V.Local.iCnt).Contact_Email!FieldValTrim,<>,"")
			'Populate BI Table
			F.Intrinsic.String.Build("{0}!*!S!*! !*!N!*!N",V.DataTable.dtEmails(V.Local.iCnt).Purchase_Order!FieldValTrim,V.Local.sParams)	
			F.Global.General.CallWrapperSyncBio(915000,V.Local.sParams)
			'Export File
			F.Global.BI.GetRunID(V.Local.iBIRunID)
			F.Global.BI.StartLogging(V.Local.iBIRunID,002801,-1,"",V.Local.iLogID)
			F.Intrinsic.String.Build("{0}\Orders\{1}.pdf",V.Dictionary.mrpsettings!PROGRAMDIR,V.DataTable.dtEmails(V.Local.iCnt).Purchase_Order!FieldValTrim,V.Local.sAttachments)
			V.Local.sParamName.Set("Terminal*!*ReportID*!*UseVendorCurr*!*PRTCNFRM*!*PROGRAM*!*PRTHIST*!*QTYDEC")
			F.Intrinsic.String.Build("{0}*!*002801*!* *!* *!* *!* *!*{1}*!* *!*",V.Caller.Terminal,0,V.Local.sParamVal)
			F.Global.BI.RunReportPreProcessor(V.Local.iBIRUNID,V.Local.iLogID,V.Local.sParamName,V.Local.sParamVal,"",4,True,"",-1,"",0,V.Local.sAttachments,"",V.Local.iRet)
			F.Global.BI.StopLogging(V.Local.iLogID)
			'Recipient
			F.Intrinsic.String.Replace(V.DataTable.dtEmails(V.Local.iCnt).Contact_Email!FieldValTrim,";",",",V.Local.sRecipientEmail)
			F.Intrinsic.String.Build("{0}*!*{1}",V.DataTable.dtEmails(V.Local.iCnt).Contact_Name!FieldValTrim,V.Local.sRecipientEmail,V.Local.sRecipient)
			'Sender
			F.Intrinsic.String.Build("{0}*!*{1}",V.DataTable.dtEmails(V.Local.iCnt).SenderEmail!FieldValTrim,V.DataTable.dtEmails(V.Local.iCnt).SenderName!FieldValTrim,V.Local.sSender)
			'PO Attachments
			F.Intrinsic.String.Build("{0}.pdf*!*{1}\Orders\",V.DataTable.dtEmails(V.Local.iCnt).Purchase_Order!FieldValTrim,V.Dictionary.mrpsettings!PROGRAMDIR,V.Local.sAttachments)
			'Additional Attachments
			F.Intrinsic.Control.If(V.DataTable.dtEmails(V.Local.iCnt).Attachments!FieldVal)
				F.Intrinsic.String.Split(V.DataTable.dtEmails(V.Local.iCnt).AttachmentFiles!FieldVal,V.Ambient.NewLine,V.Local.sFiles)
				F.Intrinsic.Control.For(V.Local.iCnt2,0,V.Local.sFiles.UBound,1)
					F.Intrinsic.String.Split(V.Local.sFiles(V.Local.iCnt2),"\",V.Local.sFileName)
					V.Local.sFileName.Set(V.Local.sFileName(V.Local.sFileName.UBound))
					F.Intrinsic.String.Replace(V.Local.sFiles(V.Local.iCnt2),V.Local.sFileName,"",V.Local.sFilePath)
					F.Intrinsic.String.Build("{0}@!@{1}*!*{2}",V.Local.sAttachments,V.Local.sFileName,V.Local.sFilePath,V.Local.sAttachments)
				F.Intrinsic.Control.Next(V.Local.iCnt2)
			F.Intrinsic.Control.EndIf
			'Subject
			F.Intrinsic.String.Replace(V.DataTable.dtEmails(V.Local.iCnt).Subject!FieldValTrim,"%PO%",V.DataTable.dtEmails(V.Local.iCnt).Purchase_Order!FieldValTrim,V.Local.sSubject)
			'Body
			F.Intrinsic.String.Replace(V.DataTable.dtEmails(V.Local.iCnt).Body!FieldValTrim,"%PO%",V.DataTable.dtEmails(V.Local.iCnt).Purchase_Order!FieldValTrim,V.Local.sBody)
			F.Intrinsic.String.Replace(V.Local.sBody,"%USER%",V.DataTable.dtEmails(V.Local.iCnt).SenderName!FieldValTrim,V.Local.sBody)
			'Calling Program
			F.Intrinsic.String.Build("Email PO-{0}",V.DataTable.dtEmails(V.Local.iCnt).Purchase_Order!FieldValTrim,V.Local.sCallingProgram)
			'Send Email	
			F.Global.Messaging.QueueMessage(V.Caller.CompanyCode,0,V.Local.sCallingProgram,V.Local.sSubject,V.Local.sSender,V.Local.sRecipient,V.Local.sBody,5,"",False,"","","","","","","",V.Local.sAttachments,False)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Next(V.Local.iCnt)
	
	F.Intrinsic.Control.If(V.DataTable.dtEmails.RowCount,<>,0)
		Gui.frmPrevEmail.pbStatus.Value(V.DataTable.dtEmails.RowCount)
	F.Intrinsic.Control.Else
		Gui.frmPrevEmail.pbStatus.Value(100)
	F.Intrinsic.Control.EndIf
	
	Gui.frmPrevEmail.lblStatus.Visible(False)
	Gui.frmPrevEmail.pbStatus.Visible(False)
	Gui.frmPrevEmail..Visible(False)
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.cmdSend_Click.End

Program.Sub.frmEmail_UnLoad.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	Gui.frmEmail..Visible(False)
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.frmEmail_UnLoad.End

Program.Sub.cmdSavePreview_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	
	V.Local.sAttach.Declare
	V.Local.bAttach.Declare
	
	V.Local.sAttach.Set(V.Screen.frmEmail!txtAttach.Text)
	F.Intrinsic.Control.If(V.Local.sAttach.Trim,<>,"")
		V.Local.bAttach.Set(True)
	F.Intrinsic.Control.EndIf
	
	F.Data.DataTable.SetValue("dtEmails",V.Screen.frmEmail!txtRow.Text,"SenderName",V.Screen.frmEmail!txtSName.Text,"SenderEmail",V.Screen.frmEmail!txtSEmail.Text,"Contact_Name",V.Screen.frmEmail!txtRName.Text,"Contact_Email",V.Screen.frmEmail!txtREmail.Text,"Subject",V.Screen.frmEmail!txtSubject.Text,"Body",V.Screen.frmEmail!txtBody.Text,"AttachmentFiles",V.Screen.frmEmail!txtAttach.Text,"Attachments",V.Local.bAttach)
	Gui.frmEmail..Visible(False)
	
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.cmdSavePreview_Click.End

Program.Sub.DragDrop.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.iCnt.Declare
	V.Local.sFiles.Declare
	V.Local.sAttach.Declare
	
	F.Intrinsic.String.Split(V.Args.Files,"*!*",V.Local.sFiles)
	F.Intrinsic.Control.For(V.Local.iCnt,0,V.Local.sFiles.UBound,1)
		F.Intrinsic.Control.If(V.Local.iCnt,=,0)
			V.Local.sAttach.Set(V.Local.sFiles(V.Local.iCnt))
		F.Intrinsic.Control.Else
			F.Intrinsic.String.Build("{0}{1}{2}",V.Local.sAttach,V.Ambient.NewLine,V.Local.sFiles(V.Local.iCnt),V.Local.sAttach)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Next(V.Local.iCnt)
	
	F.Intrinsic.Control.If(V.Screen.frmEmail!txtAttach.Text,<>,"")
		F.Intrinsic.String.Build("{0}{1}{2}",V.Screen.frmEmail!txtAttach.Text,V.Ambient.NewLine,V.Local.sAttach,V.Local.sAttach)
	F.Intrinsic.Control.EndIf
	
	Gui.frmEmail.txtAttach.Text(V.Local.sAttach)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.DragDrop.End

Program.Sub.GetCompanyShipTo.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Data.DataTable.CreateFromSQL("dtCompany","con","Select NAME_COMPANY, ADDRESS1, ADDRESS2, CITY, STATE, CODE_ZIP, COUNTRY, COUNTY, ATTENTION From V_COMPANY;",True)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GetCompanyShipTo.End

Program.Sub.picGSSLogo_Click.Start
f.Intrinsic.Control.If(v.Args.BUTTON.UCase,=,"RIGHT")
	Function.Intrinsic.Debug.InvokeDebugger
	Function.Intrinsic.Debug.Stop
	
f.Intrinsic.Control.EndIf

Program.Sub.picGSSLogo_Click.End

Program.Sub.format_MRPChild_grid.Start
F.Intrinsic.Control.Try
V.Local.sError.Declare
v.Local.iCount.Declare


'SELECTED
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","KEEP","HeaderFontBold",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","KEEP","Visible",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","KEEP","AllowEdit",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","KEEP","ReadOnly",False)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","KEEP","HeaderHAlignment","Center")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","KEEP","CellHAlignment","Center")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","KEEP","Caption","SELECTED")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","KEEP","VisibleIndex","0")
'FID
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","FID","HeaderFontBold",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","FID","Visible",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","FID","AllowEdit",False)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","FID","ReadOnly",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","FID","HeaderHAlignment","Center")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","FID","CellHAlignment","Center")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","FID","Caption","FID")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","FID","VisibleIndex","1")
'PART
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PART","HeaderFontBold",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PART","Visible",False)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PART","AllowEdit",False)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PART","ReadOnly",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PART","HeaderHAlignment","Near")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PART","CellHAlignment","Near")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PART","Caption","PART")
'LOCATION
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","LOCATION","HeaderFontBold",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","LOCATION","Visible",False)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","LOCATION","AllowEdit",False)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","LOCATION","ReadOnly",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","LOCATION","HeaderHAlignment","Near")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","LOCATION","CellHAlignment","Near")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","LOCATION","Caption","LOCATION")
'TYPEDESC
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","TYPEDESC","HeaderFontBold",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","TYPEDESC","Visible",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","TYPEDESC","AllowEdit",False)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","TYPEDESC","ReadOnly",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","TYPEDESC","HeaderHAlignment","Near")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","TYPEDESC","CellHAlignment","Near")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","TYPEDESC","Caption","SOURCE DESCRIPTION")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","TYPEDESC","MinWidth","20")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","TYPEDESC","VisibleIndex","2")
'QUANTITY
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","QUANTITY","HeaderFontBold",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","QUANTITY","Visible",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","QUANTITY","AllowEdit",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","QUANTITY","ReadOnly",False)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","QUANTITY","HeaderHAlignment","Far")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","QUANTITY","CellHAlignment","Far")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","QUANTITY","DisplayCustomNumeric","#.00")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","QUANTITY","Caption","QUANTITY")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","QUANTITY","MinWidth","20")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","QUANTITY","VisibleIndex","5")
'DATESTART
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATESTART","HeaderFontBold",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATESTART","Visible",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATESTART","AllowEdit",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATESTART","ReadOnly",False)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATESTART","HeaderHAlignment","Center")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATESTART","CellHAlignment","Center")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATESTART","DisplayCustomDateTime","d")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATESTART","Caption","START DATE")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATESTART","MinWidth","20")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATESTART","VisibleIndex","3")
'DATE_DUE
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATE_DUE","HeaderFontBold",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATE_DUE","Visible",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATE_DUE","AllowEdit",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATE_DUE","ReadOnly",False)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATE_DUE","HeaderHAlignment","Center")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATE_DUE","CellHAlignment","Center")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATE_DUE","DisplayCustomDateTime","d")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATE_DUE","Caption","DUE DATE")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATE_DUE","MinWidth","20")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","DATE_DUE","VisibleIndex","4")
'PID
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PID","HeaderFontBold",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PID","Visible",False)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PID","AllowEdit",False)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PID","ReadOnly",True)
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PID","HeaderHAlignment","Center")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PID","CellHAlignment","Center")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PID","Caption","PID")
gui.frmPO.GsGCPO.SetColumnProperty("gvMRPChild","PID","VisibleIndex","1")


f.Data.DataTable.SetValue("dtPO$dtMRP",-1,"KEEP",False)


	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.format_MRPChild_grid.End

Program.Sub.GsGCPO_MouseCellEnter.Start
f.Intrinsic.Control.Try
v.Local.sError.Declare
v.Local.sPart.Declare
v.Local.sLoc.Declare
V.Local.sFilter.Declare
v.Local.fQty.Declare


f.Intrinsic.Control.If(v.Args.COLUMN.UCase,=,"KEEP")
	f.Data.DataTable.SetValue("dtPO$dtMRP",v.Args.RowIndex,"KEEP",V.DataTable.dtPO$dtMRP(v.Args.RowIndex).KEEP!FIELDVALNOT)
	v.Local.sPart.Set(v.DataTable.dtPO$dtMRP(v.Args.RowIndex).PART!FIELDVALSTRING)
	V.Local.sLoc.Set(V.DataTable.dtPO$dtMRP(v.Args.RowIndex).Location!FIELDVALSTRING)
	f.Intrinsic.String.Build("PART = '{0}' AND LOCATION = '{1}' AND KEEP = 'True'",v.Local.sPart,v.Local.sLoc,v.Local.sFilter)
	F.Data.DataTable.Compute("dtPO$dtMRP","sum(QUANTITY)",v.Local.sFilter,v.Local.fQty)
	F.Intrinsic.Control.If(V.DataView.dtPO!dvUpdate.Exists,=,False)
		f.Data.DataView.Create("dtPO","dvUpdate",22)
	F.Intrinsic.Control.EndIf
	f.Intrinsic.String.Replace(V.Local.sFilter,"AND KEEP = 'True'","",v.Local.sFilter)
	f.Data.DataView.SetFilter("dtPO","dvUpdate",v.Local.sFilter)
	f.Intrinsic.Control.If(v.DataView.dtPO!dvUpdate.RowCount,=,1)
		F.Intrinsic.Control.If(V.Local.fQty,>,0)
			f.Data.DataView.SetValue("dtPO","dvUpdate",0,"Purchase",v.Local.fQty,"SELECT",True)
		f.Intrinsic.Control.Else
			f.Data.DataView.SetValue("dtPO","dvUpdate",0,"Purchase",v.Local.fQty,"SELECT",False)
		f.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf
f.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GsGCPO_MouseCellEnter.End

Program.Sub.update_mrp_planning.Start
f.Intrinsic.Control.Try
v.Local.sError.Declare
V.Local.sTable.Declare
v.Local.sSql.Declare
v.Local.sFilter.Declare
v.Local.iCount.Declare
V.Local.iC.Declare
v.Local.sRet.Declare

f.ODBC.Connection!coredb.opencompanyconnection

F.Intrinsic.Control.If(V.DataTable.UPDATELINES.RowCount,>,0,AND,V.DataTable.MRPUPDATE.RowCount,>,0)
	F.Data.DataView.Create("UpdateLines","dvUpdate",22)
	F.Intrinsic.Control.For(V.Local.iCount,0,v.DataTable.MRPUPDATE.RowCount--,1)
		f.Intrinsic.String.Build("PART = '{0}' AND DATE_DUE = #{1}#",V.DataTable.MRPUPDATE(V.Local.iCount).PART!FIELDVALSTRING,v.DataTable.MRPUPDATE(v.Local.iCount).DATE_DUE!FIELDVALSTRING,V.Local.sFilter)
		F.Data.DataView.SetFilter("updateLines","dvUpdate",v.Local.sFilter)
		f.Intrinsic.Control.For(v.Local.iC,0,v.DataView.updatelines!dvUpdate.RowCount--,1)
			f.Intrinsic.String.Build("update mrp_planning set purchase_order = '{0}', po_line = '{1}' where FID = '{2}'",v.DataTable.MRPUPDATE(V.Local.iCount).PONumber!fieldvaltrim,v.DataTable.MRPUPDATE(V.Local.iCount).LineNumber!fieldvaltrim,v.DataView.updatelines!dvUpdate(v.Local.iC).FID!FIELDVALLONG,V.Local.sSql)
			f.ODBC.Connection!coredb.execute(v.Local.ssql)
		f.Intrinsic.Control.Next(v.Local.iC)
	F.Intrinsic.Control.Next(V.Local.iCount)
	f.Data.DataTable.Close("UpdateLines")
	f.Data.DataTable.Close("MRPUpdate")
F.Intrinsic.Control.EndIf

f.ODBC.Connection!coredb.close

f.Intrinsic.Control.ExitSub

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.update_mrp_planning.End

Program.Sub.GsGCPO_RowClick.Start
f.Intrinsic.Control.Try
v.Local.sError.Declare


f.Intrinsic.Control.ExitSub

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GsGCPO_RowClick.End

Program.Sub.load_mrp_dictionary.Start
F.Intrinsic.Control.Try
V.Local.sError.Declare

f.ODBC.Connection!coredb.opencompanyconnection

f.Data.Dictionary.CreateFromSQL("mrpsettings","coredb","select * from mrp_settings",20)

F.ODBC.Connection!coredb.close

F.Intrinsic.Control.ExitSub

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.load_mrp_dictionary.End

Program.Sub.custom_globals.Start
F.Intrinsic.Control.Try
V.Local.sError.Declare
v.Local.sSql.Declare
v.Local.bTable.Declare
V.Local.sUser.Declare


f.ODBC.Connection!custom.opencompanyconnection

f.ODBC.Connection!custom.TableExists("GAB_IV_ADDL_INFO",v.Global.bCustom)

f.Intrinsic.Control.BlockEvents

f.Intrinsic.Control.If(v.Global.bCustom)
	f.Data.Dictionary.CreateFromSQL("BuyerID","custom","select PART, BUYER_ID FROM GAB_IV_ADDL_INFO",4)
	F.Data.Dictionary.SetDefaultReturn("BUYERID","")
	'make the buyer dropdown visible and add the values
	gui.frmPO.ddlBuyer.Visible(True)
	f.Data.Dictionary.CreateFromSQL("BUYER","CUSTOM","SELECT RTRIM(GS_USER), NAME FROM GAB_IV_BUYER_ID",4)
	gui.frmPO.ddlBuyer.additems("Dictionary","BUYER")
	gui.frmPO.ddlBuyer.Text(v.dictionary.buyer![v.Caller.User])
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.UnBlockEvents

f.ODBC.Connection!custom.Close

F.Intrinsic.Control.ExitSub

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.custom_globals.End

Program.Sub.ddlBuyer_Click.Start
F.Intrinsic.Control.Try
V.Local.sError.Declare
v.Local.sFilter.Declare

'bCustom means they have the custom table developed by Miller for associating Buyers (planners) to inventory items.
f.Intrinsic.Control.If(v.DataTable.dtPO.Exists)
	f.Intrinsic.Control.If(v.Global.bCustom)
		F.Data.Dictionary.ReturnKeyFromValue("BUYER",V.Screen.frmPO!ddlBuyer.TEXT,V.Local.sFilter)
		F.Intrinsic.String.Build("BUYERID = '{0}'",v.Local.sFilter,v.Local.sFilter)
		f.Data.DataView.SetFilter("dtPO","dvPO",v.Local.sFilter)
	f.Intrinsic.Control.EndIf
	
	f.Intrinsic.Control.If(v.DataView.dtPO!dvPO.RowCount,=,0)
		f.Intrinsic.UI.Msgbox("No action items for current user","Auto Work Order")
	f.Intrinsic.Control.EndIf
	
	Gui.frmWO.GsGCWO.ResumeLayout()
	Gui.frmWO.GsGCWO.MainView("gvPO")
f.Intrinsic.Control.EndIf

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	F.Intrinsic.Control.End 
F.Intrinsic.Control.EndTry

Program.Sub.ddlBuyer_Click.End



Program.Sub.Comments.Start
Program.Sub.Comments.End
